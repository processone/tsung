<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>Tsung User's manual
</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<META name="GENERATOR" content="hevea 1.10">
<STYLE type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
DIV TABLE{margin-left:inherit;margin-right:inherit;}
PRE{text-align:left;margin-left:0ex;margin-right:auto;}
BLOCKQUOTE{margin-left:4ex;margin-right:4ex;text-align:left;}
TD P{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px;width:auto; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px;width:auto; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
</STYLE>

<style type="text/css">
<!--
body        {font-size: 90%; margin-right:40px; margin-left:40px; font-family:Sans-Serif; color:#000000; background-color:#ffffff;}
p, .n       {font-size: 90%; font-family:Sans-Serif; color:#000000; background-color:#ffffff;}
h1          {font-size: 200%; color:#800000; background-color:#ffffff;}
h2          {font-size:150%; color:#000080; background-color:#ffffff;}
h3          {font-family:Sans-Serif; font-size: 120%; font-weight:bold; color:#000080; background-color:#ffffff;}
h4          {font-family:Sans-Serif; font-size:100%; font-weight:bold; color:#000080; background-color:#ffffff;}
h5          {font-family:Sans-Serif; font-size:100%; font-weight:bold; color:#000000;  background-color:#ffffff; margin-bottom: 0;}
form        {margin-bottom:-5px;}
textarea    {color:#333333;  background-color:#ffffff; width:90%;}
table       {font-size:90%;}
dl,ul,ol    {margin-top: 2pt; margin-bottom: 2pt;}
tt, pre     {font-family:monospace; color:#666666; background-color:#ffffff;}
pre {
    background-color: #ffffee;
    white-space:pre;
    border-style:solid;
    border-width:thin;
    border-color:#999999;
    color:#333333;
//    padding:3px;
	margin-bottom: -1pt;
    width:100%;
}

a:link      {color:#800000; background-color: #ffffff;}
a:visited   {color:#006600; background-color: #ffffff;}
a:active    {color:green; background-color: #ffffff;}
a:hover     {background:#ffffaa;}

.piedpage, .entete {
    font-family:Sans-Serif; font-size:90%; font-style:italic; color:#0000ff; background-color: #ffffff;
        text-align: center;
}
-->
</style>
</HEAD>
<BODY >
<!--HEVEA command line is: hevea -fix -I ./styles -exec xxdate.exe -pedantic TSUNG.hva user_manual.tex -->
<!--HTMLHEAD-->


  <DIV class="entete">
  &nbsp;<A href="http://tsung.erlang-projects.org/">http://tsung.erlang-projects.org/</A>
  </DIV>
  <HR>
<!--ENDHTML-->
<!--CUT DEF section 1 --><H1 ALIGN=center>Tsung User’s manual</H1><DIV CLASS="center">

<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD ALIGN=left NOWRAP bgcolor="#F2F2F2"> Version:</TD><TD ALIGN=left NOWRAP>1.5.0</TD></TR>
<TR><TD ALIGN=left NOWRAP bgcolor="#F2F2F2"> Date :</TD><TD ALIGN=left NOWRAP>January 7, 2013</TD></TR>
</TABLE>
</DIV><!--TOC section Contents-->
<H2 CLASS="section"><!--SEC ANCHOR -->Contents</H2><!--SEC END --><UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc1">1  Introduction</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc2">1.1  What is Tsung ?</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc3">1.2  What is Erlang and why is it important for Tsung ?</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc4">1.3  Tsung background</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc5">2  Features</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc6">2.1  Tsung main features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc7">2.2  HTTP related features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc8">2.3  WEBDAV related features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc9">2.4  Jabber/XMPP related features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc10">2.5  PostgreSQL related features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc11">2.6  MySQL related features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc12">2.7  Websocket related features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc13">2.8  LDAP related features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc14">2.9  Complete reports set</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc15">2.10  Highlights</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc16">3  Installation</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc17">3.1  Dependencies</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc18">3.2  Compilation</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc19">3.3  Configuration</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc20">3.4  Running</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc21">3.5  Feedback</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc22">4  Benchmark approach</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc23">4.1  HTTP/WebDAV benchmark approach</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc24">4.1.1  Benchmarking a Web server</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc25">4.1.2  WEBDAV </A>
</LI><LI CLASS="li-toc"><A HREF="#htoc26">4.1.3  Benchmarking a proxy server</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc27">4.2  LDAP benchmark approach</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc28">4.3  PostgreSQL benchmark approach</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc29">4.4  MySQL benchmark approach</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc30">4.5  Jabber/XMPP benchmark approach</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc31">4.5.1  Overview</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc32">4.5.2  Acknowledgments of messages</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc33">4.5.3  Status: Offline, Connected and Online</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc34">4.5.4  Authentication</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc35">4.5.5  Privacy list testing</A>
</LI></UL>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc36">5  Using the proxy recorder</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc37">5.1  PostgreSQL</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc38">5.2  HTTP and WEBDAV</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc39">6  Understanding tsung.xml configuration file</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc40">6.1  File structure</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc41">6.2  Clients and server</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc42">6.2.1  Basic setup</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc43">6.2.2  Advanced setup</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc44">6.2.3  Running Tsung with a job scheduler</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc45">6.3  Monitoring</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc46">6.3.1  Erlang</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc47">6.3.2  SNMP</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc48">6.3.3  Munin</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc49">6.4  Defining the load progression</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc50">6.4.1  Randomly generated users</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc51">6.4.2  Statically generated users</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc52">6.4.3  Duration of the load test</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc53">6.5  Setting options</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc54">6.5.1  XMPP/Jabber options</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc55">6.5.2  HTTP options</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc56">6.6  Sessions</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc57">6.6.1  Thinktimes</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc58">6.6.2  HTTP</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc59">6.6.3  Jabber/XMPP</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc60">6.6.4  PostgreSQL</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc61">6.6.5  MySQL</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc62">6.6.6  Websocket</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc63">6.6.7  LDAP</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc64">6.6.8  Mixing session type</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc65">6.7  Advanced features</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc66">6.7.1  Dynamic substitutions</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc67">6.7.2  Reading external file</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc68">6.7.3  Dynamic variables</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc69">6.7.4  Checking the server’s response</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc70">6.7.5  Loops, If, Foreach</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc71">6.7.6  Rate limiting</A>
</LI></UL>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc72">7  Statistics and reports</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc73">7.1  File format</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc74">7.2  Available stats</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc75">7.3  Design</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc76">7.4  Generating the report</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc77">7.5  Tsung summary</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc78">7.6  Graphical overview</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc79">7.7  Tsung Plotter</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc80">7.8  RRD</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc81">8  References</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc82">9  Acknowledgments</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc83">A  Frequently Asked Questions</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc84">A.1  Can’t start distributed clients: timeout error </A>
</LI><LI CLASS="li-toc"><A HREF="#htoc85">A.2  Tsung crashes when I start it </A>
</LI><LI CLASS="li-toc"><A HREF="#htoc86">A.3  Why do i have error_connect_emfile errors ?</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc87">A.4  Tsung still crashes/fails when I start it !</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc88">A.5  Can I dynamically follow redirect with HTTP ?</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc89">A.6  What is the format of the stats file tsung.log ?</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc90">A.7  How can I compute percentile/quartiles/median for transactions or requests
response time ?</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc91">A.8  How can I specify the number of concurrent users ?</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc92">A.9  SNMP monitoring doesn’t work ?!</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc93">A.10  How can i simulate a fix number of users ?</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc94">B  Errors list</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc95">C  CHANGELOG</A>
</LI></UL><!--TOC section Introduction-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc1">1</A>  Introduction</H2><!--SEC END --><!--TOC subsection What is Tsung ?-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc2">1.1</A>  What is Tsung ?</H3><!--SEC END --><P><EM>Tsung</EM> (formerly IDX-Tsunami) is a distributed load testing tool. It is
protocol-independent and can currently be used to stress HTTP, WebDAV, SOAP,
PostgreSQL, MySQL, LDAP, and Jabber/XMPP servers.</P><P>It is distributed under the GNU General Public License version 2.</P><!--TOC subsection What is Erlang and why is it important for Tsung ?-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc3">1.2</A>  What is Erlang and why is it important for Tsung ?</H3><!--SEC END --><P><EM>Tsung’s</EM> main strength is its ability to simulate a huge number of
simultaneous user from a single machine. When used on cluster, you can
generate a really impressive load on a server with a modest cluster,
easy to set-up and to maintain. You can also use Tsung on a cloud like EC2.</P><P><EM>Tsung</EM> is developed in Erlang and this is where the power
of <EM>Tsung</EM> resides.</P><P>Erlang is a <EM>concurrency-oriented</EM> programming language.
Tsung is based on the Erlang OTP (Open Transaction Platform) and
inherits several characteristics from Erlang:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Performance</EM>: Erlang has been made to support hundred thousands
of lightweight processes in a single virtual machine.
</LI><LI CLASS="li-itemize"><EM>Scalability</EM>: Erlang runtime environment is naturally
distributed, promoting the idea of process’s location transparency.
</LI><LI CLASS="li-itemize"><EM>Fault-tolerance</EM>:Erlang has been built to develop robust,
fault-tolerant systems. As such, wrong answer sent from the server
to <EM>Tsung</EM> does not make the whole running benchmark crash.
</LI></UL><P>More information on Erlang on <A HREF="http://www.erlang.org"><TT>http://www.erlang.org</TT></A> and
<A HREF="http://www.erlang-projects.org/"><TT>http://www.erlang-projects.org/</TT></A></P><!--TOC subsection Tsung background-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc4">1.3</A>  Tsung background</H3><!--SEC END --><P>History:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Tsung</EM> development was started by Nicolas Niclausse in
2001 as a distributed jabber load stress tool for internal use at
<A HREF="http://IDEALX.com/"><TT>http://IDEALX.com/</TT></A> (now OpenTrust). It has evolved as an open-source
multi-protocol load testing tool several months later. The HTTP
support was added in 2003, and this tool has been used for several
industrial projects. It is now hosted by Erlang-projects, and
supported by <A HREF="http://process-one.net/"><TT>http://process-one.net/</TT></A>. The list of contributors
is available in the source archive
(<A HREF="https://git.process-one.net/tsung/mainline/blobs/master/CONTRIBUTORS"><TT>https://git.process-one.net/tsung/mainline/blobs/master/CONTRIBUTORS</TT></A>).</LI><LI CLASS="li-itemize">It is an industrial strength implementation of a <EM>stochastic model</EM>
for real users simulation. User events distribution is based on a
Poisson Process. More information on this topic in:<P>Z. Liu, N. Niclausse, and C. Jalpa-Villanueva. <B>Traffic Model
and Performance Evaluation of Web Servers</B>. <EM>Performance Evaluation,
Volume 46, Issue 2-3, October 2001</EM>.</P></LI><LI CLASS="li-itemize">This model has already been tested in the INRIA <EM>WAGON</EM>
research prototype (Web trAffic GeneratOr and beNchmark). WAGON was
used in the <A HREF="http://www.vthd.org/"><TT>http://www.vthd.org/</TT></A> project (Very High Broadband
IP/WDM test platform for new generation Internet applications, 2000-2004).</LI></UL><P><EM>Tsung</EM> has been used for very high load tests:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Jabber/XMPP</EM> protocol:
<UL CLASS="itemize"><LI CLASS="li-itemize">
90 000 simultaneous jabber users on a
4-node Tsung cluster (3xSun V240 + 1 Sun V440)
</LI><LI CLASS="li-itemize">10 000 simultaneous users.
<EM>Tsung</EM> was running on a 3-computers cluster (CPU
800MHz)
</LI></UL>
</LI><LI CLASS="li-itemize"><EM>HTTP and HTTPS</EM> protocol:
<UL CLASS="itemize"><LI CLASS="li-itemize">
12 000 simultaneous users.
<EM>Tsung</EM> were running on a 4-computers cluster (in 2003). The
tested platform reached 3 000 requests per second.
</LI><LI CLASS="li-itemize">10 million simultaneous users running on a 75-computers cluster,
generating more than one million requests per second.
</LI></UL>
</LI></UL><P><EM>Tsung</EM> has been used at:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>DGI</EM> (Direction Générale des impôts): French finance ministry
</LI><LI CLASS="li-itemize"><EM>Cap Gemini Ernst &amp; Young</EM>
</LI><LI CLASS="li-itemize"><EM>IFP</EM> (Institut Français du Pétrole): French Research Organization
for Petroleum
</LI><LI CLASS="li-itemize"><EM>LibertySurf</EM>
</LI><LI CLASS="li-itemize">Sun™for their Mooddlerooms platform on Niagara processors:
<A HREF="http://blogs.sun.com/kevinr/resource/Moodle-Sun-RA.pdf"><TT>http://blogs.sun.com/kevinr/resource/Moodle-Sun-RA.pdf</TT></A>
</LI></UL><!--TOC section Features-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc5">2</A>  Features</H2><!--SEC END --><!--TOC subsection Tsung main features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc6">2.1</A>  Tsung main features</H3><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>High Performance</EM>: <EM>Tsung</EM> can simulate a
huge number of simultaneous users per physical computer: It can
simulates thousands of users on a single CPU (Note: a simulated user
is not always active: it can be idle during a <TT>thinktime</TT>
period). Traditional injection tools can hardly go further than a
few hundreds (Hint: if all you want to do is requesting a single URL
in a loop, use <EM>ab</EM>; but if you want to build complex
scenarios with extended reports, <EM>Tsung</EM> is for you).
</LI><LI CLASS="li-itemize"><EM>Distributed</EM>: the load can be distributed on a cluster of
client machines
</LI><LI CLASS="li-itemize"><EM>Multi-Protocols</EM> using a plug-in system: HTTP (both standard
web traffic and SOAP), WebDAV, Jabber/XMPP and PostgreSQL are currently
supported. LDAP and MySQL plugins were first included in the 1.3.0 release.
</LI><LI CLASS="li-itemize"><EM>SSL</EM> support
</LI><LI CLASS="li-itemize"><EM>Several IP addresses</EM> can be used on a single machine using
the underlying OS IP Aliasing
</LI><LI CLASS="li-itemize"><EM>OS monitoring</EM> (CPU, memory and network traffic) using Erlang
agents on remote servers or <EM>SNMP</EM>
</LI><LI CLASS="li-itemize"><EM>XML configuration system</EM>: complex user’s scenarios are written
in XML. Scenarios can be written with a simple browser using the
Tsung recorder (HTTP and PostgreSQL only).
</LI><LI CLASS="li-itemize"><EM>Dynamic scenarios</EM>: You can get dynamic data from the
server under load (without writing any code) and re-inject it in
subsequent requests. You can also loop, restart or stop a
session when a string (or regexp) matches the server response.
</LI><LI CLASS="li-itemize"><EM>Mixed behaviours</EM>: several sessions can be used to simulate
different type of users during the same benchmark. You can define
the proportion of the various behaviours in the benchmark scenario.
</LI><LI CLASS="li-itemize"><EM>Stochastic processes</EM>: in order to generate a realistic traffic,
user thinktimes and the arrival rate can be randomized using a probability
distribution (currently exponential)
</LI></UL><!--TOC subsection HTTP related features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc7">2.2</A>  HTTP related features</H3><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
HTTP/1.0 and HTTP/1.1 support
</LI><LI CLASS="li-itemize">GET, POST, PUT, DELETE and HEAD requests
</LI><LI CLASS="li-itemize">Cookies: Automatic cookies management( but you can also manually
add more cookies)
</LI><LI CLASS="li-itemize"><CODE>'</CODE>GET If-modified since<CODE>'</CODE> type of request
</LI><LI CLASS="li-itemize">WWW-authentication Basic and Digest. OAuth 1.0
</LI><LI CLASS="li-itemize">User Agent support
</LI><LI CLASS="li-itemize">Any HTTP Headers can be added
</LI><LI CLASS="li-itemize">Proxy mode to record sessions using a Web browser
</LI><LI CLASS="li-itemize">SOAP support using the HTTP mode (the SOAPAction HTTP header is
handled).
</LI><LI CLASS="li-itemize">HTTP server or proxy server load testing.
</LI></UL><!--TOC subsection WEBDAV related features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc8">2.3</A>  WEBDAV related features</H3><!--SEC END --><P>The WebDAV (RFC 4918) plugin is a superset of the HTTP plugin. It adds the
following features (some versionning extensions to WebDAV (RFC 3253)
are also supported):</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Methods implemented: DELETE, CONNECT, PROPFIND, PROPPATCH, COPY,
MOVE, LOCK, UNLOCK, MKCOL, REPORT, OPTIONS, MKACTIVITY, CHECKOUT, MERGE
</LI><LI CLASS="li-itemize">Recording of DEPTH, IF, TIMEOUT OVERWRITE, DESTINATION, URL and
LOCK-TOKEN Headers.
</LI></UL><!--TOC subsection Jabber/XMPP related features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc9">2.4</A>  Jabber/XMPP related features</H3><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
Authentication (plain-text, digest and sip-digest). STARTTLS
</LI><LI CLASS="li-itemize">presence and register messages
</LI><LI CLASS="li-itemize">Chat messages to online or offline users
</LI><LI CLASS="li-itemize">MUC: join room, send message in room, change nickname
</LI><LI CLASS="li-itemize">Roster set and get requests
</LI><LI CLASS="li-itemize">Global users<CODE>'</CODE> synchronization can be set on specific actions
</LI><LI CLASS="li-itemize">BOSH &amp; XMPP over Websocket
</LI><LI CLASS="li-itemize">raw XML messages
</LI><LI CLASS="li-itemize">PubSub
</LI><LI CLASS="li-itemize">Multiple vhost instances supported
</LI><LI CLASS="li-itemize">privacy lists: get all privacy list names, set list as active
</LI></UL><!--TOC subsection PostgreSQL related features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc10">2.5</A>  PostgreSQL related features</H3><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
Basic and MD5 Authentication
</LI><LI CLASS="li-itemize">Simple Protocol
</LI><LI CLASS="li-itemize">Extended Protocol (new in version <B>1.4.0</B> )
</LI><LI CLASS="li-itemize">Proxy mode to record sessions
</LI></UL><!--TOC subsection MySQL related features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc11">2.6</A>  MySQL related features</H3><!--SEC END --><P>
This plugin is experimental. It works only with MySQL version 4.1 and higher.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Secured Authentication method only (MySQL &gt;= 4.1)
</LI><LI CLASS="li-itemize">Basic Queries
</LI></UL><!--TOC subsection Websocket related features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc12">2.7</A>  Websocket related features</H3><!--SEC END --><P>
This plugin is experimental. It only support rfc6455 currently.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Both as a server type and session type
</LI></UL><!--TOC subsection LDAP related features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc13">2.8</A>  LDAP related features</H3><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
bind
</LI><LI CLASS="li-itemize">add, modify and search queries
</LI><LI CLASS="li-itemize">starttls
</LI></UL><!--TOC subsection Complete reports set-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc14">2.9</A>  Complete reports set</H3><!--SEC END --><P>Measures and statistics produced by Tsung are extremely feature-full.
They are all represented as a graphic. <EM>Tsung</EM> produces
statistics regarding:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Performance</EM>: response time, connection time, decomposition of the user scenario based on request grouping instruction (called <I>transactions</I>), requests per second
</LI><LI CLASS="li-itemize"><EM>Errors</EM>: Statistics on page return code to trace errors
</LI><LI CLASS="li-itemize"><EM>Target server behaviour</EM>: An Erlang agent can gather information
from the target server(s). Tsung produces graphs for CPU and memory
consumption and network traffic. SNMP and munin is also supported to
monitor remote servers.
</LI></UL><P>Note that <EM>Tsung</EM> takes care of the synchronization process
by itself. Gathered statistics are «synchronized».</P><P>It is possible to generate graphs during the benchmark as statistics
are gathered in real-time.</P><!--TOC subsection Highlights-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc15">2.10</A>  Highlights</H3><!--SEC END --><P><EM>Tsung</EM> has several advantages over other injection tools:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>High performance</EM> and <EM>distributed benchmark</EM>: You
can use Tsung to simulate tens of thousands of virtual users.
</LI><LI CLASS="li-itemize"><EM>Ease of use</EM>: The hard work is already done for all supported
protocol. No need to write complex scripts. Dynamic scenarios only
requires small trivial piece of code.
</LI><LI CLASS="li-itemize"><EM>Multi-protocol support</EM>: <EM>Tsung</EM> is for example one of
the only tool to benchmark SOAP applications
</LI><LI CLASS="li-itemize"><EM>Monitoring</EM> of the target server(s) to analyze the behaviour
and find bottlenecks. For example, it has been used to analyze cluster
symmetry (is the load properly balanced ?) and to determine the best
combination of machines on the three cluster tiers (Web engine, EJB
engine and database)
</LI></UL><!--TOC section Installation-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc16">3</A>  Installation</H2><!--SEC END --><P>This package has been tested on Linux, FreeBSD and Solaris. A port is
available on MacOS X. It should
work on Erlang supported platforms (Linux, Solaris, *BSD, Win32 and
MacOS-X).</P><!--TOC subsection Dependencies-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc17">3.1</A>  Dependencies</H3><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
Erlang/OTP R13B and up
(<A HREF="http://www.erlang.org/download.html"><TT>http://www.erlang.org/download.html</TT></A>). Erlang is now
part of fedora and debian/ubuntu repositories.
</LI><LI CLASS="li-itemize">pgsql module made by Christian Sunesson (for the PostgreSQL plugin):
sources available at
<A HREF="http://jungerl.sourceforge.net/"><TT>http://jungerl.sourceforge.net/</TT></A> . The module is
included in the source and binary distribution of <EM>Tsung</EM>. It
is released under the EPL License.
</LI><LI CLASS="li-itemize">mysql module made by Magnus Ahltorp &amp; Fredrik Thulin (for the mysql plugin):
sources available at
<A HREF="http://www.stacken.kth.se/projekt/yxa/"><TT>http://www.stacken.kth.se/projekt/yxa/</TT></A> . The modified module is
included in the source and binary distribution of <EM>Tsung</EM>. It
is released under the three-clause BSD License.
</LI><LI CLASS="li-itemize">eldap module (for the LDAP plugin):
sources available at
<A HREF="http://jungerl.sourceforge.net/"><TT>http://jungerl.sourceforge.net/</TT></A> . The module is
included in the source and binary distribution of <EM>Tsung</EM>. It
is released under the GPL License.
</LI><LI CLASS="li-itemize">mochiweb libs (for xpath parsing, optionally used for dynamic variables in
the HTTP plugin):
sources available at
<A HREF="http://code.google.com/p/mochiweb/"><TT>http://code.google.com/p/mochiweb/</TT></A> . The module is
included in the source and binary distribution of <EM>Tsung</EM>. It
is released under the MIT License.
</LI><LI CLASS="li-itemize">gnuplot and perl5 (optional; for graphical output with
<TT>tsung_stats.pl</TT> script). The Template Toolkit is used for HTML
reports (see <A HREF="http://template-toolkit.org/"><TT>http://template-toolkit.org/</TT></A>)
</LI><LI CLASS="li-itemize">python and mathplotlib (optional; for graphical output with
<TT>tsung-plotter</TT>).
</LI><LI CLASS="li-itemize">for distributed tests, you need an ssh access to remote
machines without password (use a RSA/DSA key without pass-phrase or
ssh-agent) (rsh is also supported)
</LI><LI CLASS="li-itemize">bash
</LI></UL><!--TOC subsection Compilation-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc18">3.2</A>  Compilation</H3><!--SEC END --><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">./configure
 make
 make install
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>If you want to download the development version, use git:</P><P><TT>git clone git://git.process-one.net/tsung/mainline.git</TT></P><P>(see also <A HREF="https://git.process-one.net/tsung"><TT>https://git.process-one.net/tsung</TT></A> and the github
mirror: <A HREF="https://github.com/processone/tsung"><TT>https://github.com/processone/tsung</TT></A>).</P><P>You can also build packages with <TT>make deb</TT> (on debian and
ubuntu) and <TT>make rpm</TT> (on fedora, rhel, and other rpm based distribution)</P><!--TOC subsection Configuration-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc19">3.3</A>  Configuration</H3><!--SEC END --><P>The default configuration file is <TT>~/.tsung/tsung.xml</TT> (
there are several sample files in
<TT>/usr/share/doc/tsung/examples</TT>).</P><P>Log files are saved in <TT>~/.tsung/log/</TT> . A new sub-directory
is created for each test using the current date as name
(<TT>~/.tsung/log/20040217-0940</TT> for ex.)</P><!--TOC subsection Running-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc20">3.4</A>  Running</H3><!--SEC END --><P>Two commands are installed in the directory <TT>$PREFIX/bin</TT>:
<TT>tsung</TT> and <TT>tsung-recorder</TT>. A man page is available
for both commands.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&gt;tsung -h
Usage: tsung &lt;options&gt; start|stop|debug|status
Options:
    -f &lt;file&gt;     set configuration file (default is ~/.tsung/tsung.xml)
                    (use - for standard input)
    -l &lt;logdir&gt;   set log directory (default is ~/.tsung/log/YYYYMMDD-HHMM/)
    -i &lt;id&gt;       set controller id (default is empty)
    -r &lt;command&gt;  set remote connector (default is ssh)
    -s            enable erlang smp on client nodes
    -m &lt;file&gt;     write monitoring output on this file (default is tsung.log)
                   (use - for standard output)
    -F            use long names (FQDN) for erlang nodes
    -w            warm-up delay (default is 10 sec)
    -v            print version information and exit
    -6            use IPv6 for tsung internal communications
    -h            display this help and exit
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>A typical way of using tsung is to run:
<TT>tsung -f myconfigfile.xml start</TT>.</P><P>The command will print the current log directory created for the test, and wait until the test is
over.</P><!--TOC subsection Feedback-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc21">3.5</A>  Feedback</H3><!--SEC END --><P>Use the Tsung mailing list (see
<A HREF="https://lists.process-one.net/mailman/listinfo/tsung-users"><TT>https://lists.process-one.net/mailman/listinfo/tsung-users</TT></A>) if you have
suggestions or questions about <EM>Tsung</EM>. You can also use the
bug-tracker available at <A HREF="https://support.process-one.net/browse/TSUN"><TT>https://support.process-one.net/browse/TSUN</TT></A>.
You can also try the #tsung IRC channel on Freenode.</P><!--TOC section Benchmark approach-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc22">4</A>  Benchmark approach</H2><!--SEC END --><!--TOC subsection HTTP/WebDAV benchmark approach-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc23">4.1</A>  HTTP/WebDAV benchmark approach</H3><!--SEC END --><!--TOC subsubsection Benchmarking a Web server-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc24">4.1.1</A>  Benchmarking a Web server</H4><!--SEC END --><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Record one or more sessions: start the recorder with:
<TT>tsung-recorder start</TT>, and then configure your browser to use Tsung
proxy recorder (the listen port is 8090). A session file will be
created. For HTTPS recording, use <FONT COLOR=purple>http://-</FONT> instead of
<FONT COLOR=purple>https://</FONT> in your browser.
</LI><LI CLASS="li-enumerate">Edit / organize scenario, by adding recorded sessions in the
configuration file.
</LI><LI CLASS="li-enumerate">Write small code for dynamic parts if needed and place dynamic mark-up
in the scenario.
</LI><LI CLASS="li-enumerate">Test and adjust scenario to have a nice progression of the load. This
is highly dependent of the application and of the size of the target
server(s). Calculate the normal duration of the scenario and use the
interarrival time between users and the duration of the phase to estimate
the number of simultaneous users for each given phase.
</LI><LI CLASS="li-enumerate">Launch benchmark with your first application parameters set-up:
<TT>tsung start</TT> (run <TT>man tsung</TT> for more options)
</LI><LI CLASS="li-enumerate">Wait for the end of the test or stop by hand with
<TT>tsung stop</TT> (reports can also be generated during the
test (see § <A HREF="#sec:statistics-reports">7</A>) : the statistics are
updated every 10 seconds). For a brief summary of the current
activity, use <TT>tsung status</TT>
</LI><LI CLASS="li-enumerate">Analyze results, change parameters and relaunch another benchmark
</LI></OL><!--TOC subsubsection WEBDAV -->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc25">4.1.2</A>  WEBDAV </H4><!--SEC END --><P>It’s the same approach as HTTP: first you start to record one or more
sessions with the recorder:
<TT>tsung-recorder -p webdav start</TT></P><!--TOC subsubsection Benchmarking a proxy server-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc26">4.1.3</A>  Benchmarking a proxy server</H4><!--SEC END --><P>By default, the HTTP plugin is used to benchmark HTTP servers. But you
can also benchmark HTTP Proxy servers. To do that, you must add in the
<TT>options</TT> section:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option type="ts_http" name="http_use_server_as_proxy" value="true"&gt;&lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection LDAP benchmark approach-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc27">4.2</A>  LDAP benchmark approach</H3><!--SEC END --><P>An LDAP plugin for the recorder is not yet implemented, so you have to
write the session by yourself; see section <A HREF="#sec:session:ldap">6.6.7</A> for
more information.</P><!--TOC subsection PostgreSQL benchmark approach-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc28">4.3</A>  PostgreSQL benchmark approach</H3><!--SEC END --><P>It’s the same approach as HTTP: first you start to record one or more
sessions with the recorder:
<TT>tsung-recorder -p pgsql start</TT></P><P>This will start a proxy listening to port 8090 and will proxy requests
to 127.0.0.0:5432.</P><P>To choose another port and/or address:
<TT>tsung-recorder -L 5432 -I 10.6.1.1 -P 5433 -p pgsql start</TT></P><P>This will start a proxy listening to port 5432 and will proxy requests
to 10.6.1.1:5433.</P><!--TOC subsection MySQL benchmark approach-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc29">4.4</A>  MySQL benchmark approach</H3><!--SEC END --><P>A MySQL plugin for the recorder is not yet implemented, so you have to
write the session by yourself; see section <A HREF="#sec:session:mysql">6.6.5</A> for
more information.</P><!--TOC subsection Jabber/XMPP benchmark approach-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc30">4.5</A>  Jabber/XMPP benchmark approach</H3><!--SEC END --><!--TOC subsubsection Overview-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc31">4.5.1</A>  Overview</H4><!--SEC END --><P>This paragraph explains how to write a session for Jabber/XMPP.</P><P>There are two differences between HTTP and Jabber testing:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
There is no recorder for Jabber, so you have to write your
sessions by hand (an example is provided in
<A HREF="#sec:sessions:jabber">6.6.3</A>).
</LI><LI CLASS="li-enumerate">the jabber plugin does not parse XML; instead it uses packet
acknowledgments.
</LI></OL><!--TOC subsubsection Acknowledgments of messages-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc32">4.5.2</A>  Acknowledgments of messages</H4><!--SEC END --><P>Since the jabber plugin does not parse XML (historically, it was for
performance reasons), you must have a way to tell when a request is
finished. There are 3 possibilities:</P><DL CLASS="description"><DT CLASS="dt-description">
<B>ack=local</B></DT><DD CLASS="dd-description"> as soon as a packet is received from the server, the
request is considered as completed. Hence if you use a local ack with a request
that do not require a response from the server (presence for ex.), it
will wait forever (or until a timeout is reached).
</DD><DT CLASS="dt-description"><B>ack=no_ack</B></DT><DD CLASS="dd-description"> as soon as the request is send, it is considered as completed (do
not wait for incoming data)
</DD><DT CLASS="dt-description"><B>ack=global</B></DT><DD CLASS="dd-description"> synchronized users. its main use is for waiting for all
users to connect before sending messages. To do that, set a request
with global ack (it can be the first presence msg:<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">   &lt;request&gt; &lt;jabber type="presence" ack="global"/&gt; &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You also have to specify the number of users to be connected:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;option type="ts_jabber" name="global_number" value="100"&gt;&lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>To be sure that exactly <TT>global_number</TT> users are started, add the
<FONT COLOR=purple>’maxnumber’</FONT> attribute to <TT>’users’</TT></P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;users maxnumber="100" interarrival="1.0" unit="second"&gt;&lt;/users&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>If you do not specify <TT>maxnumber</TT>, the global ack will be reset every
<TT>global_number</TT> users
</P></DD></DL><P><A NAME="bidi:presence"></A>
<B>New in 1.2.2:</B> This version adds an new option for a
session. if you set the attribute <TT>bidi</TT> (for bidirectional)
in the <TT>session</TT> tag: <FONT COLOR=purple>&lt;session ... bidi=’true’&gt;</FONT>,
then incoming messages from the server will be analyzed. Currently,
only roster subscription requests are handled: if a user received a
subscription request (<FONT COLOR=purple>&lt;presence ... type=’subscribe’&gt;</FONT>), it
will respond with a <FONT COLOR=purple>&lt;presence ... type=’subscribed’&gt;</FONT>
message.</P><!--TOC subsubsection Status: Offline, Connected and Online-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc33">4.5.3</A>  Status: Offline, Connected and Online</H4><!--SEC END --><P>You can send messages to offline or online users. A user is considered
online when he has send a <FONT COLOR=purple>presence:initial</FONT> message (before
this message , the state of the user is <TT>connected</TT>).</P><P>If you want to switch back to <TT>connected</TT> before going
<TT>offline</TT>, you can use a <FONT COLOR=purple>presence:final</FONT> message:</P><P><FONT COLOR=purple>presence:final</FONT> does two things:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
It removes the client from the list of Online users, and moves
them into the list of Connected users.
</LI><LI CLASS="li-enumerate">It sends a broadcast presence update of type=’unavailable’.
</LI></OL><P><FONT COLOR=purple>presence:final</FONT> is optional.</P><P><EM>warn:</EM> this is new in <B>1.2.0</B>, in earlier version, only 2
status were available: online and offline; a user was considered
online as soon as it was connected.</P><!--TOC subsubsection Authentication-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc34">4.5.4</A>  Authentication</H4><!--SEC END --><P>Below are configuration examples for the possible authentication
methods. Note: the regular expressions used here are only examples -
they may need to be altered depending on how a particular server
implementation composes messages (see also  <A HREF="#sec:jabber-options">6.5.1</A>
for password settings).</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<B>plain authentication</B> - sends clear-text passwords:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;session probability="100" name="jabber-plain" type="ts_jabber"&gt;

    &lt;request&gt; &lt;jabber type="connect" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;

    &lt;thinktime value="2"&gt;&lt;/thinktime&gt;

    &lt;transaction name="auth_plain"&gt;
      &lt;request&gt; &lt;jabber type="auth_get" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
      &lt;request&gt; &lt;jabber type="auth_set_plain" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;
    ...
  &lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI><LI CLASS="li-itemize"><B>digest authentication</B> as described in XMPP JEP-0078: Non-SASL Authentication
<A HREF="http://www.jabber.org/jeps/jep-0078.html"><TT>http://www.jabber.org/jeps/jep-0078.html</TT></A>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;session probability="100" name="jabber-digest" type="ts_jabber"&gt;

    &lt;!-- regexp captures stream ID returned by server --&gt;
    &lt;request&gt;
      &lt;dyn_variable name="sid" re="&amp;lt;stream:stream id=&amp;quot;(.*)&amp;quot; xmlns:stream"/&gt;
      &lt;jabber type="connect" ack="local"&gt;&lt;/jabber&gt;
    &lt;/request&gt;

    &lt;thinktime value="2"&gt;&lt;/thinktime&gt;

    &lt;transaction name="auth_digest"&gt;
      &lt;request&gt; &lt;jabber type="auth_get" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
      &lt;request subst='true'&gt; &lt;jabber type="auth_set_digest" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;
    ...
  &lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI><LI CLASS="li-itemize"><B>sip-digest authentication</B>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;session probability="100" name="jabber-sipdigest" type="ts_jabber"&gt;

    &lt;request&gt; &lt;jabber type="connect" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;

    &lt;thinktime value="2"&gt;&lt;/thinktime&gt;

    &lt;transaction name="auth_sipdigest"&gt;
      &lt;!-- regexp captures nonce value returned by server --&gt;
      &lt;request&gt;
        &lt;dyn_variable name="nonce"
          re="&amp;lt;Nonce encoding=&amp;quot;hex&amp;quot;&amp;gt;(.*)&amp;lt;\/Nonce&amp;gt;"/&gt;
        &lt;jabber type="auth_get" ack="local"&gt;&lt;/jabber&gt;
      &lt;/request&gt;
      &lt;request subst='true'&gt; &lt;jabber type="auth_set_sip" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;
    ...
  &lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI></UL><!--TOC subsubsection Privacy list testing-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc35">4.5.5</A>  Privacy list testing</H4><!--SEC END --><P>There are two actions available to allow for rudimentary privacy lists
load testing:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<FONT COLOR=purple>privacy:get_names</FONT> - gets the list of all names
of privacy lists stored by the server for a given user
</LI><LI CLASS="li-itemize"><FONT COLOR=purple>privacy:set_active</FONT> - sets a list with a predefined
name as active. The list name is determined from the JID,
e.g. if the user’s JID is "john@average.com" then the list name
is "john@average.com_list". One should take care of properly seeding
the server database in order to ensure that such a list exists.
</LI></UL><!--TOC section Using the proxy recorder-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc36">5</A>  Using the proxy recorder</H2><!--SEC END --><P>The recorder has three plugins: for HTTP, WebDAV and for PostgreSQL.</P><P>To start it, run <TT>tsung-recorder -p &lt;PLUGIN&gt; start</TT>, where <TT>PLUGIN</TT> can be
<FONT COLOR=purple>http</FONT>, <FONT COLOR=purple>webdav</FONT> or <FONT COLOR=purple>pgsql</FONT> for PostgreSQL. The default plugin is <FONT COLOR=purple>http</FONT>.</P><P>The proxy is listening to port 8090. You can change the port with
<FONT COLOR=purple>-L portnumber</FONT>.</P><P>To stop it, use <TT>tsung-recorder stop</TT>.</P><P>The recorded session is created as
<TT>~/.tsung/tsung_recorderYYYMMDD-HH:MM.xml</TT>; if it doesn’t work,
take a look at <TT>~/.tsung/log/tsung.log-tsung_recorder@hostname</TT></P><P>During the recording, you can add custom tag in the XML file, this can
be useful to set transactions or comments:
<TT>tsung-recorder record_tag "&lt;transaction name=’login’&gt;’’</TT></P><P>Once a session has been created, you can insert it in your main configuration
file, either by editing by hand the file, or by using an ENTITY
declaration, like:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;!DOCTYPE tsung SYSTEM "/usr/share/tsung/tsung-1.0.dtd" [
 &lt;!ENTITY mysession1 SYSTEM "/home/nniclausse/.tsung/tsung_recorder20051217-13:11.xml"&gt;
]&gt;
...
&lt;sessions&gt;
  &amp;mysession1;
&lt;/sessions&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection PostgreSQL-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc37">5.1</A>  PostgreSQL</H3><!--SEC END --><P>For PostgreSQL, the proxy will connect to the server at IP 127.0.0.1
and port 5432. Use <FONT COLOR=purple>-I serverIP</FONT> to change the IP and
<FONT COLOR=purple>-P portnumber</FONT> to change the port.</P><!--TOC subsection HTTP and WEBDAV-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc38">5.2</A>  HTTP and WEBDAV</H3><!--SEC END --><P>For HTTPS recording, use <FONT COLOR=purple>http://-</FONT> instead of
<FONT COLOR=purple>https://</FONT> in your browser</P><P><B>New in 1.2.2</B>: For HTTP, you can configure the recorder to
use a parent proxy (but this will not work for https). Add the -u
option to enable parent proxy, and use <FONT COLOR=purple>-I serverIP</FONT> to set
the IP and <FONT COLOR=purple>-P portnumber</FONT> to set the port of the parent.</P><!--TOC section Understanding tsung.xml configuration file-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc39">6</A>  Understanding tsung.xml configuration file</H2><!--SEC END --><P>The default encoding is utf-8. You can use a different encoding, like in:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
 </PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection File structure-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc40">6.1</A>  File structure</H3><!--SEC END --><P>Scenarios are enclosed into Tsung tags:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE tsung SYSTEM "/usr/share/tsung/tsung-1.0.dtd" [] &gt;
&lt;tsung loglevel="info"&gt;
...
&lt;/tsung&gt;
 </PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>If you add the attribute <FONT COLOR=purple>dumptraffic="true"</FONT>, all the
traffic will be logged to a file. <EM>Warn:</EM> this will considerably
slow down Tsung, so use with care. It is useful for debugging
purpose. You can use the attribute <FONT COLOR=purple>dumptraffic="light"</FONT> to
dump only the first 44 bytes.</P><P>Since version <B>1.4.0</B>, you have also a specific logging per
protocol, using <FONT COLOR=purple>dumptraffic="protocol"</FONT>. It’s currently
only implemented for HTTP: this will log all requests in a CSV file,
with the following data:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">#date;pid;id;http method;host;URL;HTTP status;size;match;error
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>The <TT>loglevel</TT> can also have a great impact on performance:
For high load, <FONT COLOR=purple>warning</FONT> is recommended.
Possible values are:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
emergency
</LI><LI CLASS="li-itemize">critical
</LI><LI CLASS="li-itemize">error
</LI><LI CLASS="li-itemize">warning
</LI><LI CLASS="li-itemize">notice (default)
</LI><LI CLASS="li-itemize">info
</LI><LI CLASS="li-itemize">debug
</LI></UL><P>For REALLY verbose logging, recompile tsung with <TT>make debug</TT>
and set <TT>loglevel</TT> to <FONT COLOR=purple>debug</FONT>.</P><!--TOC subsection Clients and server-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc41">6.2</A>  Clients and server</H3><!--SEC END --><P>Scenarios start with clients (Tsung cluster) and server definitions:</P><!--TOC subsubsection Basic setup-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc42">6.2.1</A>  Basic setup</H4><!--SEC END --><P>
For non distributed load, you can use a basic setup like:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;clients&gt;
    &lt;client host="localhost" use_controller_vm="true"/&gt;
 &lt;/clients&gt;

 &lt;servers&gt;
    &lt;server host="192.168.1.1" port="80" type="tcp"&gt;&lt;/server&gt;
 &lt;/servers&gt;
 </PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>This will start the load on the same host and on the same Erlang
virtual machine as the controller.</P><P>The server is the entry point into the cluster (<B>New in 1.2.0:</B>
if several servers are defined, a round robin algorithm is used to
choose the server).</P><P><TT>Type</TT> can be <FONT COLOR=purple>tcp</FONT>, <FONT COLOR=purple>ssl</FONT> or
<FONT COLOR=purple>udp</FONT> (for IPv6, use <FONT COLOR=purple>tcp6</FONT>, <FONT COLOR=purple>ssl6</FONT> or
<FONT COLOR=purple>udp6</FONT> ; only available in version <B>1.4.2</B> and newer)</P><!--TOC subsubsection Advanced setup-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc43">6.2.2</A>  Advanced setup</H4><!--SEC END --><P>The next example is more complex, and use several features for
advanced distributed testing:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;clients&gt;
     &lt;client host="louxor" weight="1" maxusers="800"&gt;
         &lt;ip value="10.9.195.12"&gt;&lt;/ip&gt;
         &lt;ip value="10.9.195.13"&gt;&lt;/ip&gt;
     &lt;/client&gt;
     &lt;client host="memphis" weight="3" maxusers="600" cpu="2"/&gt;
  &lt;/clients&gt;

&lt;servers&gt;
  &lt;server host="10.9.195.1" port="8080" type="tcp"&gt;&lt;/server&gt;
&lt;/servers&gt;
 </PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Several virtual IP can be used to simulate more machines. This is
very useful when a load-balancer use the client<CODE>'</CODE>s IP to
distribute the traffic among a cluster of servers. <B>New in
1.1.1:</B> IP is no longer mandatory. If not specified, the default IP will
be used.</P><P><B>New in 1.4.0:</B> You can use <FONT COLOR=purple>&lt;ip scan="yes"
value="eth0"/&gt;</FONT> to scan for all the IP aliases on a given interface
(<FONT COLOR=purple>eth0</FONT> in this example).</P><P>In this example, a second machine is used in the Tsung cluster,
with a higher weight, and 2 cpus. Two Erlang virtual machines will be
used to take advantage of the number of CPU.</P><BLOCKQUOTE CLASS="quote">
<B>Note:</B> Even if an Erlang VM is now able to handle several CPUs
(erlang SMP), benchmarks shows that it’s more efficient to use one VM
per CPU (with SMP disabled) for tsung clients. Only the controller node is using SMP
erlang. Therefore, <TT>cpu</TT> should be equal to the number of cores of
your nodes. If you prefer to use erlang SMP, add the <FONT COLOR=purple>-s</FONT>
option when starting tsung (and don’t set <TT>cpu</TT> in the config
file).
</BLOCKQUOTE><P>By default, the load is distributed uniformly on all CPU (one CPU
per client by default). The weight parameter (integer) can be used to
take into account the speed of the client machine. For instance, if
one real client has a weight of 1 and the other client has a weight
of 2, the second one will start twice the number of users as the
first (the proportions will be 1/3 and 2/3). In the earlier example
where for the second client has 2 CPU and weight=3, the weight is
equal to 1.5 for each CPU.</P><P>The <TT>maxusers</TT> parameter is used to bypass the limit of
maximum number of sockets opened by a single process (1024 by
default on many OS)
and the lack of scalability of the <TT>select</TT> system call. When
the number of users is higher than the limit, a new erlang virtual
machine will be started to handle new users. The default value of
<TT>maxusers</TT> is 800 . Nowadays, with kernel polling enable, you
can and should use a very large value for <TT>maxusers</TT> (30000 for example) without
performance penalty (but don’t forget to raise the limit of the OS with
<TT>ulimit -n</TT>, see also FAQ <A HREF="#sec:faq:emfile">A.3</A>).</P><P><B>Note:</B> If you are using a tsung master with slaves, the master 
distributes sessions to slaves. If a session contains multiples requests, 
a slave will execute each of these requests in order.</P><!--TOC subsubsection Running Tsung with a job scheduler-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc44">6.2.3</A>  Running Tsung with a job scheduler</H4><!--SEC END --><P>Tsung is able to get its client node list from a batch/job
scheduler. It currently handle PBS/torque, LSF and OAR. To do this,
set the <TT>type</TT> attribute to <FONT COLOR=purple>batch</FONT>, e.g.:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;client type="batch" batch="torque" maxusers="30000"&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>If you need to scan IP aliases on nodes given by the batch scheduler,
use <TT>scan_intf</TT> like this:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;client type="batch" batch="torque" scan_intf='eth0'  maxusers="30000"&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection Monitoring-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc45">6.3</A>  Monitoring</H3><!--SEC END --><P>Tsung is able to monitor remote servers using several backends that
communicates with remote agent; This
is configured in the <TT>&lt;monitoring&gt;</TT> section. Available
statistics are: CPU activity, load average, memory usage.</P><P>Note that you can get the nodes to monitor from a job scheduler, like:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;monitor batch="true" host="torque" type="erlang"&gt;&lt;/monitor&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Several types of remote agents are supported (<FONT COLOR=purple>erlang</FONT> is the default) :</P><!--TOC subsubsection Erlang-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc46">6.3.1</A>  Erlang</H4><!--SEC END --><P>The remote agent is started by Tsung. It use erlang communications to
retrieve statistics of activity on the server. For example, here is a
cluster monitoring definition based on Erlang agents, for a cluster of
6 computers:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;monitoring&gt;
    &lt;monitor host="geronimo" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="bigfoot-1" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="bigfoot-2" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="f14-1" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="f14-2" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="db" type="erlang"&gt;&lt;/monitor&gt;
  &lt;/monitoring&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Note: monitored computers needs to be
accessible through the network, and erlang communications must be
allowed (no firewall is better ). SSH (or rsh) needs to be configured to
allow connection without password on. <B>You must use the same
version of Erlang/OTP on all nodes otherwise it may not work
properly !</B></P><P>If you can’t have erlang installed on remote servers, you can use one
of the other available agents:</P><!--TOC subsubsection SNMP-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc47">6.3.2</A>  SNMP</H4><!--SEC END --><P>
The type keyword <FONT COLOR=purple>snmp</FONT> can replace the erlang keyword, if SNMP monitoring
is preferred. They can be mixed. Since version 1.2.2, you can customize the SNMP version,
community and port number. It uses the MIB provided in
<EM>net-snmp</EM> (see also <A HREF="#sec:faq:snmp">A.9</A>).</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;monitoring&gt;
    &lt;monitor host="geronimo" type="snmp"/&gt;
    &lt;monitor host="f14-2" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="db" type="snmp"&gt;
      &lt;snmp version="v2" community="mycommunity" port="11161"/&gt;
    &lt;/monitor&gt;
  &lt;/monitoring&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>The default version is <FONT COLOR=purple>v1</FONT>, default community
<FONT COLOR=purple>public</FONT> and default port <FONT COLOR=purple>161</FONT>.</P><P>Since version <B>1.4.2</B>, you can also customize the OIDs
retrieved from the SNMP server, using one or several <FONT COLOR=purple>oid</FONT>
element:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">   &lt;monitor host="127.0.0.1" type="snmp"&gt;
     &lt;snmp version="v2"&gt;
       &lt;oid value="1.3.6.1.4.1.42.2.145.3.163.1.1.2.11.0"
            name="heapused" type="sample" eval="fun(X)-&gt; X/100 end."/&gt;
     &lt;/snmp&gt;
   &lt;/monitor&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P><TT>type</TT> can be <FONT COLOR=purple>sample</FONT>, <FONT COLOR=purple>counter</FONT> or
<FONT COLOR=purple>sum</FONT>, and optionally you can define a function (with erlang
syntax) to be applied to the value (<TT>eval</TT> attribute).</P><!--TOC subsubsection Munin-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc48">6.3.3</A>  Munin</H4><!--SEC END --><P>Since version <B>1.3.1</B>, Tsung is able to retrieve data from a munin-node agent
(see <A HREF="http://munin.projects.linpro.no/wiki/munin-node"><TT>http://munin.projects.linpro.no/wiki/munin-node</TT></A>). The <TT>type</TT>
keyword must be set to <FONT COLOR=purple>munin</FONT>, for example:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;monitoring&gt;
    &lt;monitor host="geronimo" type="munin"/&gt;
    &lt;monitor host="f14-2" type="erlang"&gt;&lt;/monitor&gt;
  &lt;/monitoring&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection Defining the load progression-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc49">6.4</A>  Defining the load progression</H3><!--SEC END --><!--TOC subsubsection Randomly generated users-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc50">6.4.1</A>  Randomly generated users</H4><!--SEC END --><P>The load progression is set-up by defining several arrival phases:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;load&gt;
  &lt;arrivalphase phase="1" duration="10" unit="minute"&gt;
    &lt;users interarrival="2" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;

  &lt;arrivalphase phase="2" duration="10" unit="minute"&gt;
    &lt;users interarrival="1" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;

  &lt;arrivalphase phase="3" duration="10" unit="minute"&gt;
    &lt;users interarrival="0.1" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
 &lt;/load&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>With this setup, during the first 10 minutes of the test, a new user
will be created every 2 seconds, then during the next 10 minutes, a
new user will be created every second, and for the last 10 minutes,
10 users will be generated every second. The test will finish when
all users have ended their session.</P><P>You can also use <TT>arrivalrate</TT> instead of
<TT>interarrival</TT>. For example, if you want 10 new users per
second, use:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;arrivalphase phase="1" duration="10" unit="minute"&gt;
    &lt;users arrivalrate="10" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You can limit the number of users started for each phase by using the
<TT>maxnumber</TT> attribute, just like this:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;arrivalphase phase="1" duration="10" unit="minute"&gt;
    &lt;users maxnumber="100" arrivalrate="10" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
  &lt;arrivalphase phase="2" duration="10" unit="minute"&gt;
    &lt;users maxnumber="200" arrivalrate="10" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>In this case, only 100 users will be created in the first phases, and
200 more during the second phase.</P><P>The complete sequence can be executed several times using the
<TT>loop</TT> attribute in the <TT>load</TT> tag
(<FONT COLOR=purple>loop=’2’</FONT> means the sequence will be looped twice, so the
complete load will be executed 3 times) (feature available since
version 1.2.2).</P><P>The load generated in terms of HTTP requests / seconds will also
depend on the mean number of requests within a session (if you have a
mean value of 100 requests per session and 10 new users per seconds,
the theoretical average throughput will be 1000 requests/ sec).</P><!--TOC subsubsection Statically generated users-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc51">6.4.2</A>  Statically generated users</H4><!--SEC END --><P>If you want to start a given session (see  <A HREF="#sec:sessions">6.6</A>) at a given time during the test,
it is possible since version <B>1.3.1</B>:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;load&gt;
  &lt;arrivalphase phase="1" duration="10" unit="minute"&gt;
    &lt;users interarrival="2" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
  &lt;user session="http-example" start_time="185" unit="second"&gt;&lt;/user&gt;
  &lt;user session="http-example" start_time="10" unit="minute"&gt;&lt;/user&gt;
  &lt;user session="foo" start_time="11" unit="minute"&gt;&lt;/user&gt;
&lt;/load&gt;
 &lt;sessions&gt;
   &lt;session name="http-example" probability="0" type="ts_http"&gt;
    &lt;request&gt; &lt;http url="/" method="GET"&gt;&lt;/http&gt; &lt;/request&gt;
   &lt;/session&gt;
   &lt;session name="foo" probability="100" type="ts_http"&gt;
    &lt;request&gt; &lt;http url="/" method="GET"&gt;&lt;/http&gt; &lt;/request&gt;
   &lt;/session&gt;
 &lt;sessions&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>In this example, we have two sessions, one has a "0" probability (and
therefore will not be used in the first phase), and the other
100%. We define 3 users starting respectively 3mn and 5 seconds
after the beginning of the test (using the <FONT COLOR=purple>http-example</FONT>
session), one starting after 10 minutes, and a last one starting after
11 minutes (using the <FONT COLOR=purple>foo</FONT> session this time)</P><!--TOC subsubsection Duration of the load test-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc52">6.4.3</A>  Duration of the load test</H4><!--SEC END --><P>By default, tsung will end when all started users have finished their
session. So it can be much longer than the duration of
arrivalphases. If you want to stop Tsung after a given duration
(even if phases are not finished or if some sessions are still actives),
you can do this with the <TT>duration</TT> attribute in
<TT>load</TT> (<B>feature added in 1.3.2</B>):</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;load duration="1" unit="hour"&gt;
  &lt;arrivalphase phase="1" duration="10" unit="minute"&gt;
    &lt;users interarrival="2" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
&lt;/load&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Currently, the maximum value for duration is a little bit less than 50
days. <TT>unit</TT> can be <FONT COLOR=purple>second</FONT>, <FONT COLOR=purple>minute</FONT> or
<FONT COLOR=purple>hour</FONT>.</P><!--TOC subsection Setting options-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc53">6.5</A>  Setting options</H3><!--SEC END --><P>
<A NAME="sec:options"></A></P><!--TOC paragraph Thinktimes, SSL, Buffers-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Thinktimes, SSL, Buffers</H5><!--SEC END --><P>Default values can be set-up globally: <TT>thinktime</TT> between requests
in the scenario, SSL cipher algorithms, TCP/UDP buffer sizes (the default
value is 32KB). These values overrides
those set in session configuration tags if override is true.
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option name="thinktime" value="3" random="false" override="true"/&gt;
  &lt;option name="ssl_ciphers"
           value="EXP1024-RC4-SHA,EDH-RSA-DES-CBC3-SHA"/&gt;
  &lt;option name="tcp_snd_buffer" value="16384"&gt;&lt;/option&gt;
  &lt;option name="tcp_rcv_buffer" value="16384"&gt;&lt;/option&gt;
  &lt;option name="udp_snd_buffer" value="16384"&gt;&lt;/option&gt;
  &lt;option name="udp_rcv_buffer" value="16384"&gt;&lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Timeout for acknowledgments of messages-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Timeout for acknowledgments of messages</H5><!--SEC END --><P>This is used to set the idle timeout(used for ’parse’ and ’local’ ack) and
global ack timeout(used for ’global’ ack). By default, idle timeout will be
10min(600000) and global ack timeout will be <FONT COLOR=purple>infinity</FONT>. This value
can be changed like this:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option name="idle_timeout" value="300000"&gt;&lt;/option&gt;
  &lt;option name="glocal_ack_timeout" value="6000000"&gt;&lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Hibernate-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Hibernate</H5><!--SEC END --><P>A new option is available in version <B>1.3.1</B>: <TT>hibernate</TT>. This
is used to reduced memory consumption of simulated users during
thinktimes. By default, hibernation will be activated for thinktimes
higher than 10sec. This value can be changed like this:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option name="hibernate" value="5"&gt;&lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>To disable hibernation, you must set the value to <FONT COLOR=purple>infinity</FONT>.</P><!--TOC paragraph Rate_limit-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Rate_limit</H5><!--SEC END --><P>A new option is available in version <B>1.4.0</B>:
<TT>rate_limit</TT>. This will limit the bandwidth of each client
(using a token bucket algorithm). The value is in KBytes per
second. You can also specify a maximum burst value
(eg. <FONT COLOR=purple>max=’2048’</FONT>). By default the burst size is the same as
the rate (1024KB in the following example). Currently, only incoming
traffic is rate limited.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option name="rate_limit" value="1024"&gt;&lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Ports_range-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Ports_range</H5><!--SEC END --><P>
If you need to open more than 30000 simultaneous connections on a
client machine, you will be limited by the number of TCP client ports,
even if you use several IPs (this is true at least on Linux). To
bypass this limit, Tsung must not delegate the selection of client
ports and together with using several IP for each client,
you have to defined a range for available clients ports, for ex:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option name="ports_range" min="1025" max="65535"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Setting the seed for random numbers-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Setting the seed for random numbers</H5><!--SEC END --><P>If you want to use a fixed seed for the random generator, you can use
the <TT>seed</TT> option, like this (by default, tsung will use the
current time to set the seed, therefore random numbers should be
different for every test).</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option name="seed" value="42"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Path for Websocket-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Path for Websocket</H5><!--SEC END --><P>When you use Websocket as a server type, you can set the connect path
for Websocket as following:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option name="websocket_path" value="/chat"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection XMPP/Jabber options-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc54">6.5.1</A>  XMPP/Jabber options</H4><!--SEC END --><P>
<A NAME="sec:jabber-options"></A></P><P>Default values for specific protocols can be defined. Here is an
example of option values for Jabber/XMPP:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option type="ts_jabber" name="global_number" value="5" /&gt;
  &lt;option type="ts_jabber" name="userid_max" value="100" /&gt;
  &lt;option type="ts_jabber" name="domain" value="jabber.org" /&gt;
  &lt;option type="ts_jabber" name="username" value="myuser" /&gt;
  &lt;option type="ts_jabber" name="passwd" value="mypasswd" /&gt;
  &lt;option type="ts_jabber" name="muc_service" value="conference.localhost"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Using these values, users will be <FONT COLOR=purple>myuserXXX</FONT> where XXX is an integer in
the interval [1:userid_max] and passwd <FONT COLOR=purple>mypasswdXXX</FONT></P><P>If not set in the configuration file, the values will be set to:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
global_number = 100
</LI><LI CLASS="li-itemize">userid_max = 10000
</LI><LI CLASS="li-itemize">domain = erlang-projects.org
</LI><LI CLASS="li-itemize">username = tsunguser
</LI><LI CLASS="li-itemize">passwd = sesame
</LI></UL><P>You can also set the <TT>muc_service</TT> here (see previous example).</P><!--TOC subsubsection HTTP options-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc55">6.5.2</A>  HTTP options</H4><!--SEC END --><P>For HTTP, you can set the <TT>UserAgent</TT> values
(<B>available since Tsung 1.1.0</B>), using a probability for each
value (the sum of all probabilities must be equal to 100)</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;option type="ts_http" name="user_agent"&gt;
    &lt;user_agent probability="80"&gt;
       Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.8) Gecko/20050513 Galeon/1.3.21
    &lt;/user_agent&gt;
    &lt;user_agent probability="20"&gt;
      Mozilla/5.0 (Windows; U; Windows NT 5.2; fr-FR; rv:1.7.8) Gecko/20050511 Firefox/1.0.4
    &lt;/user_agent&gt;
  &lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection Sessions-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc56">6.6</A>  Sessions</H3><!--SEC END --><P>
<A NAME="sec:sessions"></A></P><P>Sessions define the content of the scenario itself. They describe
the requests to execute.</P><P>Each session has a given probability. This is used to decide which
session a new user will execute. The sum of all session<CODE>'</CODE>s
probabilities must be 100.</P><P><B>Since Tsung 1.5.0</B>, you can use weights instead of
probabilities. In the following example, there will be twice as many
sessions of type s1 than s2.
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;session name="s1" weight="2" type="ts_http"&gt;
  &lt;session name="s2" weight="1" type="ts_http"&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>A transaction is just a way to have customized statistics. Say if you
want to know the response time of the login page of your website, you
just have to put all the requests of this page (HTML + embedded
pictures) within a transaction. In the example above, the transaction
called <TT>index_request</TT> will gives you in the
statistics/reports the mean response time to get
<FONT COLOR=purple>index.en.html + header.gif</FONT>. Be warn that If you have a
thinktime inside the transaction, the thinktime will be part of the
response time.</P><!--TOC subsubsection Thinktimes-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc57">6.6.1</A>  Thinktimes</H4><!--SEC END --><P>You can set static or random thinktimes to separate requests. By
default, a random thinktime will be a exponential distribution with
mean equals to <TT>value</TT>.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;thinktime value="20" random="true"&gt;&lt;/thinktime&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>In this case, the thinktime will be an exponential distribution with a
mean equals to 20 seconds.</P><P><B>Since version 1.3.0</B>, you can also use a range
<FONT COLOR=purple>[min:max]</FONT> instead of a mean for random thinktimes (the
distribution will be uniform in the interval):
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;thinktime min="2" max="10" random="true"&gt;&lt;/thinktime&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P><B>Since version 1.4.0</B>, you can use a dynamic variable to set
the thinktime value:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;thinktime value='%%_rndthink%%' random='true'&gt;&lt;/thinktime&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection HTTP-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc58">6.6.2</A>  HTTP</H4><!--SEC END --><P>This example shows several features of the HTTP protocol support in
Tsung: GET and POST request, basic authentication, transaction for
statistics definition, conditional request (IF MODIFIED SINCE), ...</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;sessions&gt;
  &lt;session name="http-example" probability="70" type="ts_http"&gt;

    &lt;request&gt; &lt;http url="/" method="GET" version="1.1"&gt;
                    &lt;/http&gt; &lt;/request&gt;
    &lt;request&gt; &lt;http url="/images/logo.gif"
               method="GET" version="1.1"
               if_modified_since="Fri, 14 Nov 2003 02:43:31 GMT"&gt;
              &lt;/http&gt;&lt;/request&gt;

    &lt;thinktime value="20" random="true"&gt;&lt;/thinktime&gt;

    &lt;transaction name="index_request"&gt;
     &lt;request&gt;&lt;http url="/index.en.html"
                          method="GET" version="1.1" &gt;
              &lt;/http&gt; &lt;/request&gt;
     &lt;request&gt;&lt;http url="/images/header.gif"
                          method="GET" version="1.1"&gt;
              &lt;/http&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;thinktime value="60" random="true"&gt;&lt;/thinktime&gt;
    &lt;request&gt;
      &lt;http url="/" method="POST" version="1.1"
               contents="bla=blu"&gt;
      &lt;/http&gt; &lt;/request&gt;
    &lt;request&gt;
       &lt;http url="/bla" method="POST" version="1.1"
             contents="bla=blu&amp;amp;name=glop"&gt;
       &lt;www_authenticate userid="Aladdin"
                         passwd="open sesame"/&gt;&lt;/http&gt;
    &lt;/request&gt;
  &lt;/session&gt;

  &lt;session name="backoffice" probability="30" ...&gt;
  ... &lt;/session&gt;
&lt;/sessions&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>If you use an absolute URL, the server used in the URL will override
the one specified in the <TT>&lt;server&gt;</TT> section. The following relative
requests in the session will also use this new server value (until a
new absolute URL is set).</P><P><B>New in 1.2.2:</B> You can add any HTTP header now, as in:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">   &lt;request&gt;
       &lt;http url="/bla" method="POST" contents="bla=blu&amp;amp;name=glop"&gt;
         &lt;www_authenticate userid="Aladdin" passwd="open sesame"/&gt;
         &lt;http_header name="Cache-Control" value="no-cache"/&gt;
         &lt;http_header name="Referer" value="http://www.w3.org/"/&gt;
      &lt;/http&gt;
   &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P><B>New in 1.3.0:</B> You can also read the content of a POST or PUT
request from an external file:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;http url='mypage' method='POST' contents_from_file='/tmp/myfile' /&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Since <B>1.3.1</B>, you can also manually set a cookie, though the
cookie is not persistent: you must add it in every <TT>&lt;requests&gt;</TT>:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;http url="/"&gt;
    &lt;add_cookie key="foo" value="bar"/&gt;
    &lt;add_cookie key="id"  value="123"/&gt;
  &lt;/http&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Authentication-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Authentication</H5><!--SEC END --><P>Until Tsung 1.5.0, only Basic authentication was implemented. You can
now use Digest Authentication and OAuth 1.0.</P><P>To use Digest authentication:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;!-- 1. First request return 401. We use dynvars to fetch nonce and realm --&gt;
 &lt;request&gt;
   &lt;dyn_variable name="nonce" header="www-authenticate/nonce"/&gt;
   &lt;dyn_variable name="realm" header="www-authenticate/realm"/&gt;
   &lt;http url="/digest" method="GET" version="1.1"/&gt;
 &lt;/request&gt;

  &lt;!--
  2. This request will be authenticated. Type="digest" is important.
  We use the nonce and realm values returned from the previous
  If the webserver returns the nextnonce we set it to the nonce dynvar
  for use with the next request.
  Else it stays set to the old value
  --&gt;
  &lt;request subst="true"&gt;
    &lt;dyn_variable name="nonce" header="authentication-info/nextnonce"/&gt;
    &lt;http url="/digest" method="GET" version="1.1"&gt;
      &lt;www_authenticate userid="user" passwd="passwd" type="digest" realm="%%_realm%%" nonce="%%_nonce%%"/&gt;
    &lt;/http&gt;
  &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>To use OAuth authentication:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">     &lt;!-- Getting a Request Token --&gt;

      &lt;request&gt;
        &lt;dyn_variable name="access_token" re="oauth_token=([^&amp;amp;]*)"/&gt;
        &lt;dyn_variable name="access_token_secret" re="oauth_token_secret=([^&amp;amp;]*)" /&gt;
        &lt;http url="/oauth/example/request_token.php" method="POST" version="1.1" contents="empty"&gt;
          &lt;oauth consumer_key="key" consumer_secret="secret"  method="HMAC-SHA1"/&gt;
        &lt;/http&gt;
      &lt;/request&gt;

      &lt;!-- Getting an Access Token --&gt;

      &lt;request subst='true'&gt;
        &lt;dyn_variable name="access_token" re="oauth_token=([^&amp;amp;]*)"/&gt;
        &lt;dyn_variable name="access_token_secret" re="oauth_token_secret=([^&amp;amp;]*)"/&gt;
          &lt;http url="/oauth/example/access_token.php" method="POST" version="1.1" contents="empty"&gt;
          &lt;oauth consumer_key="key" consumer_secret="secret"  method="HMAC-SHA1" access_token="%%_access_token%%" access_token_secret="%%_access_token_secret%%"/&gt;
        &lt;/http&gt;
      &lt;/request&gt;

      &lt;!-- Making Authenticated Calls --&gt;

      &lt;request subst="true"&gt;
        &lt;http url="/oauth/example/echo_api.php" method="GET" version="1.1"&gt;
         &lt;oauth consumer_key="key" consumer_secret="secret" access_token="%%_access_token%%" access_token_secret="%%_access_token_secret%%"/&gt;
        &lt;/http&gt;
      &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection Jabber/XMPP-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc59">6.6.3</A>  Jabber/XMPP</H4><!--SEC END --><P><A NAME="sec:sessions:jabber"></A>
</P><P>Here is an example of a session definition for the Jabber/XMPP protocol:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;sessions&gt;
 &lt;session probability="70" name="jabber-example" type="ts_jabber"&gt;

    &lt;request&gt; &lt;jabber type="connect" ack="local" /&gt; &lt;/request&gt;

    &lt;thinktime value="2"&gt;&lt;/thinktime&gt;

    &lt;transaction name="authenticate"&gt;
      &lt;request&gt; &lt;jabber type="auth_get" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
      &lt;request&gt; &lt;jabber type="auth_set_plain" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;request&gt; &lt;jabber type="presence:initial" ack="no_ack"/&gt; &lt;/request&gt;


    &lt;thinktime value="30"&gt;&lt;/thinktime&gt;

    &lt;transaction name="online"&gt;
    &lt;request&gt; &lt;jabber type="chat" ack="no_ack" size="16" destination="online"/&gt;&lt;/request&gt;
    &lt;/transaction&gt;
    &lt;thinktime value="30"&gt;&lt;/thinktime&gt;

    &lt;transaction name="offline"&gt;
      &lt;request&gt; &lt;jabber type="chat" ack="no_ack" size="56" destination="offline"/&gt;&lt;request&gt;
    &lt;/transaction&gt;

    &lt;thinktime value="30"&gt;&lt;/thinktime&gt;

    &lt;transaction name="close"&gt;
      &lt;request&gt; &lt;jabber type="close" ack="local"&gt; &lt;/jabber&gt;&lt;/request&gt;
    &lt;/transaction&gt;
  &lt;/session&gt;
&lt;/sessions&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Roster-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Roster</H5><!--SEC END --><P>What you can do with rosters using Tsung:</P><P>You can
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Add a new contact to their roster
- The new contact is added to the <FONT COLOR=purple>Tsung Group</FONT> group, and their name matches their JID
</LI><LI CLASS="li-enumerate">Send a <FONT COLOR=purple>subscribe</FONT> presence notification to the new contact’s JID
- This results in a <EM>pending</EM> subscription
</LI><LI CLASS="li-enumerate">Rename a roster contact
This changes the previously added contact’s name from the default JID, to <FONT COLOR=purple>Tsung Testuser</FONT>
</LI><LI CLASS="li-enumerate">Delete the previously added contact.
</LI></OL><P>Note that when you add a new contact, the contact JID is stored and used for the operations that follow. It is recommended that for each session which is configured to perform these operations, only do so once. In other words, you would NOT want to ADD more than one new contact per session. If you want to alter the rate that these roster functions are used during your test, it is best to use the session ’probability’ factor to shape this.</P><P>The nice thing about this is that when you test run is complete, your roster tables should look the same as before you started the test. So, if you set it up properly, you can have pre-loaded roster entries before the test, and then use these methods to dynamically add, modify, and remove roster entries during the test as well.</P><P>Example roster modification setup:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;session probability="100" name="jabber-rostermod" type="ts_jabber"&gt;

    &lt;!-- connect, authenticate, roster 'get', etc... --&gt;

    &lt;transaction name="rosteradd"&gt;
      &lt;request&gt;
        &lt;jabber type="iq:roster:add" ack="no_ack" destination="online"&gt;&lt;/jabber&gt;
      &lt;/request&gt;
      &lt;request&gt;
        &lt;jabber type="presence:subscribe" ack="no_ack"/&gt;
      &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;!-- ... --&gt;

    &lt;transaction name="rosterrename"&gt;
      &lt;request&gt; &lt;jabber type="iq:roster:rename" ack="no_ack"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;!-- ... --&gt;

    &lt;transaction name="rosterdelete"&gt;
      &lt;request&gt; &lt;jabber type="iq:roster:remove" ack="no_ack"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;!-- remainder of session... --&gt;

  &lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>See also <A HREF="#bidi:presence">4.5.2</A> for automatic handling of subscribing requests.</P><!--TOC paragraph SASL Anonymous-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->SASL Anonymous</H5><!--SEC END --><P>SASL Anonymous authentication example:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;session probability="100" name="sasl" type="ts_jabber"&gt;

    &lt;request&gt; &lt;jabber type="connect" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;

    &lt;thinktime value="10"&gt;&lt;/thinktime&gt;

    &lt;transaction name="authenticate"&gt;
     &lt;request&gt;
       &lt;jabber type="auth_sasl_anonymous" ack="local"&gt;&lt;/jabber&gt;&lt;/request&gt;

     &lt;request&gt;
       &lt;jabber type="connect" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;

    &lt;request&gt;
       &lt;jabber type="auth_sasl_bind" ack="local" &gt;&lt;/jabber&gt;&lt;/request&gt;
    &lt;request&gt;
       &lt;jabber type="auth_sasl_session" ack="local" &gt;&lt;/jabber&gt;&lt;/request&gt;

    &lt;/transaction&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Presence-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Presence</H5><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>type</TT> can be either <FONT COLOR=purple>presence:broadcast</FONT> or <FONT COLOR=purple>presence:directed</FONT>.
</LI><LI CLASS="li-itemize"><TT>show</TT> value must be either <FONT COLOR=purple>away</FONT>, <FONT COLOR=purple>chat</FONT>, <FONT COLOR=purple>dnd</FONT>, or <FONT COLOR=purple>xa</FONT>.
</LI><LI CLASS="li-itemize"><TT>status</TT> value can be any text.
</LI></UL><P>
For more info, see section 2.2 of RFC 3921.</P><P>If you omit the <TT>show</TT> or <TT>status</TT> attributes, they default to <FONT COLOR=purple>chat</FONT> and <FONT COLOR=purple>Available</FONT> respectively.</P><P>Example of broadcast presence (broadcast to members of your roster):
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;request&gt;
      &lt;jabber type="presence:broadcast" show="away" status="Be right back..." ack="no_ack"/&gt;
    &lt;/request&gt;

    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt;
      &lt;jabber type="presence:broadcast" show="chat" status="Available
      to chat" ack="no_ack"/&gt;
    &lt;/request&gt;

    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt;
      &lt;jabber type="presence:broadcast" show="dnd" status="Don't bother me!" ack="no_ack"/&gt;
    &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt;
     &lt;jabber type="presence:broadcast" show="xa" status="I may never come back..."
      ack="no_ack"/&gt;
    &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:broadcast" ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Example of directed presence (sent to random <FONT COLOR=purple>online</FONT> users):
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;request&gt;
      &lt;jabber type="presence:directed" show="away" status="Be right back..." ack="no_ack"/&gt;
    &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt;
      &lt;jabber type="presence:directed" show="chat" status="Available to chat" ack="no_ack"/&gt;
    &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt;
      &lt;jabber type="presence:directed" show="dnd" status="Don't bother me!" ack="no_ack"/&gt;
    &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt;
      &lt;jabber type="presence:directed" show="xa" status="I may never come back..."
        ack="no_ack"/&gt;
     &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt;
      &lt;jabber type="presence:directed" ack="no_ack"/&gt;
    &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph MUC-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->MUC</H5><!--SEC END --><P>Tsung supports three MUC operations:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Join a room (attribute <FONT COLOR=purple>type=’muc:join’</FONT>)
</LI><LI CLASS="li-enumerate">Send a message to a room (attribute <FONT COLOR=purple>type=’muc:chat’</FONT>)
</LI><LI CLASS="li-enumerate">Change nickname (attribute <FONT COLOR=purple>type=’muc:nick’</FONT>)
</LI><LI CLASS="li-enumerate">Exit a room (attribute <FONT COLOR=purple>type=’muc:exit</FONT>)
</LI></OL><P>Here’s an example:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;-- First, choose an random room and random nickname: --&gt;
&lt;setdynvars sourcetype="random_number" start="1" end="100"&gt;
 &lt;var name="room"/&gt;
&lt;/setdynvars&gt;
&lt;setdynvars sourcetype="random_string" length="10"&gt;
 &lt;var name="nick1"/&gt;
&lt;/setdynvars&gt;

&lt;request subst="true"&gt;
  &lt;jabber type='muc:join' ack = "local" room = "room%%_room%%" nick = "%%_nick1%%"/&gt;
&lt;/request&gt;

&lt;!-- use a for loop to send several messages to the room --&gt;
&lt;for from="1" to="6" var="i"&gt;
 &lt;thinktime value="30"/&gt;
 &lt;request subst="true"&gt;
   &lt;jabber type="muc:chat" ack="no_ack" size="16" room =
   "room%%_room%%"/&gt;
 &lt;/request&gt;
&lt;/for&gt;

&lt;!-- change nickname--&gt;
&lt;thinktime value="2"/&gt;
&lt;setdynvars sourcetype="random_string" length="10"&gt;
 &lt;var name="nick2"/&gt;
&lt;/setdynvars&gt;

&lt;request subst="true"&gt;
 &lt;jabber type="muc:nick" room="room%%_room%%" nick="%%_nick2%%"
         ack="no_ack"/&gt;
&lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>MUC support is available since version 1.3.1</P><!--TOC paragraph PubSub-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->PubSub</H5><!--SEC END --><P>Experimental support for PubSub is available in version 1.3.1</P><P>You can read the following entry: <A HREF="https://support.process-one.net/browse/TSUN-115"><TT>https://support.process-one.net/browse/TSUN-115</TT></A></P><!--TOC paragraph VHost-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->VHost</H5><!--SEC END --><P>VHost support is available since version 1.3.2</P><P>Tsung is able to bench multiple vhost instances by choosing a
vhost XMPP name from a list at connection time in the scenario.</P><P>The vhost list is read from a file:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;options&gt;
...
&lt;option name="file_server" value="domains.csv" id="vhostfileId"&gt;&lt;/option&gt;
...
&lt;option type="ts_jabber" name="vhost_file" value="vhostfileId"&gt;&lt;/option&gt;
...
&lt;/options&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>When each client starts a session, it chooses randomly a domain (each domain has the
same probability).</P><!--TOC paragraph Reading usernames and password from a CSV file-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Reading usernames and password from a CSV file</H5><!--SEC END --><P>Since version 1.4.0, you can now use a CSV file to store the usernames
and password.</P><P>Configure the CSV file:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;options&gt;
  &lt;option name="file_server" id='userdb' value="/home/foo/.tsung/users.csv"/&gt;
 &lt;/options&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>And then you have to defined two variables of type <FONT COLOR=purple>file</FONT>,
and the first jabber request (<FONT COLOR=purple>connect</FONT>) must include a
<TT>xmpp_authenticate</TT> tag:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">
&lt;session probability="100" name="jabber-example" type="ts_jabber"&gt;

  &lt;setdynvars sourcetype="file" fileid="userdb" delimiter=";" order="iter"&gt;
    &lt;var name="username" /&gt;
    &lt;var name="password" /&gt;
  &lt;/setdynvars&gt;

    &lt;request subst='true'&gt;
      &lt;jabber type="connect" ack="no_ack"&gt;
         &lt;xmpp_authenticate username="%%_username%%" passwd="%%_password%%"/&gt;
      &lt;/jabber&gt;
    &lt;/request&gt;

   &lt;thinktime value="2"&gt;&lt;/thinktime&gt;

   &lt;transaction name="authenticate"&gt;

   &lt;request&gt;
     &lt;jabber type="auth_get" ack="local"&gt; &lt;/jabber&gt;
   &lt;/request&gt;
   &lt;request&gt;
     &lt;jabber type="auth_set_plain" ack="local"&gt;&lt;/jabber&gt;
   &lt;/request&gt;

  &lt;/transaction&gt;
...
&lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Moreover (since <B>1.5.0</B>), when using chat messages to random or offline users, you
should disable the default users (not from CSV) by setting
<TT>userid_max</TT> to <FONT COLOR=purple>0</FONT> and by setting the fileid for
random users (also used for pubsub) server:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;options&gt;
  &lt;option type="ts_jabber" name="userid_max" value="0" /&gt;
  &lt;option type="ts_jabber" name="random_from_fileid" value='userdb'/&gt;
  &lt;option type="ts_jabber" name="delimiter" value=";"/&gt;
 &lt;/options&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>The username should be the first entry in the each CSV line (the
delimiter is by default <FONT COLOR=purple>";"</FONT> and can be overriden).</P><!--TOC paragraph raw XML-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->raw XML</H5><!--SEC END --><P>
You can send raw XML data to the server using the <TT>raw</TT> type:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;jabber type="raw" ack="no_ack" data="&amp;lt;stream&amp;gt;foo&amp;lt;/stream&amp;gt;"&gt;&lt;/jabber&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Beware: you must encode XML characters like <FONT COLOR=purple>&lt;</FONT>
,<FONT COLOR=purple>&gt;</FONT>, <FONT COLOR=purple>&amp;</FONT>, etc.</P><!--TOC paragraph resource-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->resource</H5><!--SEC END --><P>By default, the XMPP resource is set to <FONT COLOR=purple>tsung</FONT>. Since
version 1.5.0, you can override this (in all <TT>auth_*</TT> and
<TT>register</TT> requests) using the <TT>resource</TT> attribute.</P><!--TOC subsubsection PostgreSQL-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc60">6.6.4</A>  PostgreSQL</H4><!--SEC END --><P>For PostgreSQL, 4 types of requests are available:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
connect (to a given database with a given username
</LI><LI CLASS="li-enumerate">authenticate (with password or not)
</LI><LI CLASS="li-enumerate">sql (basic protocol)
</LI><LI CLASS="li-enumerate">close
</LI></OL><P>In addition, the following parts of the extended protocol is supported:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
copy, copydone and copyfail
</LI><LI CLASS="li-enumerate">parse, bind, execute, describe
</LI><LI CLASS="li-enumerate">sync, flush
</LI></OL><P>This example shows most of the features of a PostgreSQL session:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;session probability="100" name="pgsql-example" type="ts_pgsql"&gt;
    &lt;transaction name="connection"&gt;
      &lt;request&gt;
        &lt;pgsql type="connect" database="bench" username="bench" /&gt;
      &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;request&gt;&lt;pgsql type="authenticate" password="sesame"/&gt;&lt;/request&gt;

    &lt;thinktime value="12"/&gt;

    &lt;request&gt;&lt;pgsql type="sql"&gt;SELECT * from accounts;&lt;/pgsql&gt;&lt;/request&gt;

    &lt;thinktime value="20"/&gt;

    &lt;request&gt;&lt;pgsql type="sql"&gt;SELECT * from users;&lt;/pgsql&gt;&lt;/request&gt;

    &lt;request&gt;&lt;pgsql type='sql'&gt;&lt;![CDATA[SELECT n.nspname as "Schema",
  c.relname as "Name",
  CASE c.relkind WHEN 'r' THEN 'table' WHEN 'v' THEN 'view' WHEN 'i'
  THEN 'index' WHEN 'S' THEN 'sequence' WHEN 's' THEN '%_toto_% END as "Type",
  u.usename as "Owner"
FROM pg_catalog.pg_class c
     LEFT JOIN pg_catalog.pg_user u ON u.usesysid = c.relowner
     LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
WHERE c.relkind IN ('r','v','S','')
      AND n.nspname NOT IN ('pg_catalog', 'pg_toast')
      AND pg_catalog.pg_table_is_visible(c.oid)
ORDER BY 1,2;]]&gt;&lt;/pgsql&gt;&lt;/request&gt;

    &lt;request&gt;&lt;pgsql type="close"&gt;&lt;/pgsql&gt;&lt;/request&gt;

  &lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Example with the extended protocol:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;request&gt;&lt;pgsql type='parse' name_prepared='P0_7'&gt;&lt;![CDATA[BEGIN;]]&gt;&lt;/pgsql&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='sync'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='parse' name_prepared='P0_8'&gt;&lt;![CDATA[UPDATE pgbench_accounts
  SET abalance = abalance + $1 WHERE aid = $2;]]&gt;&lt;/pgsql&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='sync'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='parse' name_prepared='P0_9'&gt;&lt;![CDATA[SELECT
  abalance FROM pgbench_accounts
  WHERE aid = $1;]]&gt;&lt;/pgsql&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='sync'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='parse' name_prepared='P0_10'&gt;&lt;![CDATA[UPDATE pgbench_tellers
   SET tbalance = tbalance + $1 WHERE tid = $2;]]&gt;&lt;/pgsql&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='sync'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='parse' name_prepared='P0_11'&gt;&lt;![CDATA[UPDATE pgbench_branches
   SET bbalance = bbalance + $1 WHERE bid = $2;]]&gt;&lt;/pgsql&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='sync'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='parse' name_prepared='P0_12'&gt;&lt;![CDATA[INSERT
   INTO pgbench_history (tid, bid, aid, delta, mtime)
   VALUES ($1, $2, $3, $4, CURRENT_TIMESTAMP);]]&gt;&lt;/pgsql&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='sync'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='parse' name_prepared='P0_13'&gt;&lt;![CDATA[END;]]&gt;&lt;/pgsql&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='sync'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='bind' name_prepared='P0_7' formats='none' formats_results='text' /&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='describe' name_portal=''/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='execute'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='sync'/&gt;&lt;/request&gt;
&lt;request&gt;&lt;pgsql type='bind' name_portal='' name_prepared='P0_8'
   formats='none' formats_results='text'
   parameters='2924,37801'/&gt;&lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection MySQL-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc61">6.6.5</A>  MySQL</H4><!--SEC END --><P>
<A NAME="sec:session:mysql"></A>
For MySQL, 4 types of requests are available (same as PostgreSQL):
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
connect (to a given database with a given username
</LI><LI CLASS="li-enumerate">authenticate (with password or not)
</LI><LI CLASS="li-enumerate">sql
</LI><LI CLASS="li-enumerate">close
</LI></OL><P>This example shows most of the features of a MySQL session:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;session probability="100" name="mysql-example" type="ts_mysql"&gt;
 &lt;request&gt;
  &lt;mysql type="connect" /&gt;
 &lt;/request&gt;
 &lt;request&gt;
  &lt;mysql type="authenticate" database="test" username="test" password="test" /&gt;
 &lt;/request&gt;
 &lt;request&gt;
  &lt;mysql type="sql"&gt;SHOW TABLES&lt;/mysql&gt;
 &lt;/request&gt;
 &lt;request&gt;
  &lt;mysql type="sql"&gt;SELECT * FROM mytable&lt;/mysql&gt;
 &lt;/request&gt;
 &lt;request&gt;
  &lt;mysql type="close" /&gt;
 &lt;/request&gt;
&lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection Websocket-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc62">6.6.6</A>  Websocket</H4><!--SEC END --><P>
<A NAME="sec:session:websocket"></A>
For Websocket, 3 types of requests are available:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
connect (to a given path)
</LI><LI CLASS="li-enumerate">message (send message to server)
</LI><LI CLASS="li-enumerate">close
</LI></OL><P>Example with Websocket as a session type:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;session probability="100" name="mysql-example" type="ts_websocket"&gt;
 &lt;request&gt;
  &lt;websocket type="connect" path="/path/to/ws"&gt;&lt;/websocket&gt;
 &lt;/request&gt;
 &lt;request&gt;
  &lt;websocket type="message"&gt;Hello world!&lt;/websocket&gt;
 &lt;/request&gt;
 &lt;request&gt;
  &lt;websocket type="close"&gt;&lt;/websocket&gt;
 &lt;/request&gt; 
&lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection LDAP-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc63">6.6.7</A>  LDAP</H4><!--SEC END --><P>
<A NAME="sec:session:ldap"></A></P><!--TOC paragraph Authentication-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Authentication</H5><!--SEC END --><P>
The recommended mechanism used to authenticate users against a LDAP
repository requires two steps to follow. Given an username and
password, we:</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Search the user in the repository tree, using the username (so users can reside in different subtrees of the organization)
</LI><LI CLASS="li-enumerate">Try to bind as the user, with the distinguished name found in the first step and the user’s password
</LI></OL><P>If the bind is successful, the user is authenticated (this is the
scheme used, among others, by the LDAP authentication module for
Apache <A HREF="http://httpd.apache.org/docs/2.0/mod/mod_auth_ldap.html"><TT>http://httpd.apache.org/docs/2.0/mod/mod_auth_ldap.html</TT></A>)</P><!--TOC paragraph LDAP Setup-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->LDAP Setup</H5><!--SEC END --><P>
For this example we are going to use a simple repository with the following hierarchy:</P><BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<DIV CLASS="center">
<IMG SRC="images/ldap-hierarchy.png" ALT="images/ldap-hierarchy.png">
</DIV>
<DIV CLASS="caption"><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left>Figure 1: LDAP Hierarchy</TD></TR>
</TABLE></DIV>
<A NAME="fig:ldap:hierarchy"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></BLOCKQUOTE><P>the repository has users in two organizational units
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
users (with four members)
</LI><LI CLASS="li-enumerate">users2 (with tree members)
</LI></OL><P>For simplicity we set the password of each user to be the same as its common name (cn).
Tsung Setup
We will use a CSV file as input, containing the user:password pairs
for our test. So we start by writing it, in this case we name the file <TT>users.csv</TT></P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">user1;user1
user2;user2
user3;user3
user4;user4
jane;jane
mary;mary
paul;pablo
paul;paul
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>(the pair paul:pablo should fail to authenticate, we will note that in the Tsung report)
Then, in our Tsung scenario, we let Tsung know about this file</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;options&gt;
       &lt;option name="file_server" id="users" value="users.csv"/&gt;
    &lt;/options&gt;
We use two dynamic variables to hold the username and password
    &lt;setdynvars sourcetype="file" fileid="users" delimiter=";" order="iter"&gt;
               &lt;var name="username" /&gt;
               &lt;var name="password" /&gt;
     &lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>To start the authentication process we instruct Tsung to perform a search, to find the distinguished name of the user we are trying to authenticate</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;ldap type="search" base="dc=pablo-desktop" filter="(cn=%%_username%%)"
        result_var="search_result" scope="wholeSubtree"&gt;&lt;/ldap&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>As we need to access the search result, we specify it using the <TT>result_var</TT> attribute. This attribute tells Tsung in which dynamic variable we want to store the result (if the <TT>result_var</TT> attribute isn’t set, Tsung doesn’t store the search result in any place).
Finally, we try to bind as that user.
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;request subst="true"&gt;
&lt;ldap type="bind" user="%%ldap_auth:user_dn%%"
      password="%%_password%%"&gt;&lt;/ldap&gt;
&lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>The only thing that remains to do is to implement the <TT>ldap_auth:user_dn</TT> function, that extract the distinguished name from the search result.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">-module(ldap_auth).
-export([user_dn/1]).
user_dn({_Pid,DynVars}) -&gt;
      [SearchResultEntry] = proplists:get_value(search_result,DynVars),
      {_,DN,_} = SearchResultEntry,
      DN.
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>We aren’t covering errors here. supposing that there is always one (and only one) user found, that we extract from the <TT>search_result</TT> variable (as defined in the previous search operation).
Each entry in the result set is a SearchResultEntry record. The record definition can be found in <TT>&lt;TSUNG_DIR&gt;/include/ELDAPv3.hrl</TT>.</P><P>As we only need to access the distinguished name of the object, we index into the result tuple directly. But if you need to access other attributes you probably will want to include the appropriate .hrl and use the record syntax instead. One of the eight user:password pairs in our users file was wrong, so we expect 1/8 of the authentication attempts to fail.</P><P>Indeed, after running the scenario we can confirm this in the Tsung
report (see figure <A HREF="#fig:ldap:results">2</A>). The bind operation maintains two
counters: <TT>ldap_bind_ok</TT> and <TT>ldap_bind_error</TT>,
that counts successful and unsuccessful bind attempts.</P><BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<DIV CLASS="center">
<IMG SRC="images/ldap-results.png" ALT="images/ldap-results.png">
</DIV>
<DIV CLASS="caption"><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left>Figure 2: LDAP Results</TD></TR>
</TABLE></DIV>
<A NAME="fig:ldap:results"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></BLOCKQUOTE><!--TOC paragraph Other examples-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Other examples</H5><!--SEC END --><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;session probability="100" name="ldap-example" type="ts_ldap"&gt;
  &lt;request&gt;
     &lt;ldap type="bind" user="uid=foo" password="bar"/&gt;
  &lt;/request&gt;

   &lt;request&gt;
       &lt;ldap type="search" base="dc=pablo-desktop" filter="(cn=user2)"
       scope="wholeSubtree"&gt;&lt;/ldap&gt;
   &lt;/request&gt;

&lt;!-- Add. Adds a new entry to the directory* --&gt;
  &lt;request subst="true"&gt;
  &lt;ldap type="add" dn="%%_new_user_dn%%" &gt;
   &lt;attr type="objectClass"&gt;
    &lt;value&gt;organizationalPerson&lt;/value&gt;
    &lt;value&gt;inetOrgPerson&lt;/value&gt;
    &lt;value&gt;person&lt;/value&gt;
   &lt;/attr&gt;
   &lt;attr type="cn"&gt;&lt;value&gt;%%_new_user_cn%%&lt;/value&gt;&lt;/attr&gt;
   &lt;attr type="sn"&gt;&lt;value&gt;fffs&lt;/value&gt;&lt;/attr&gt;
 &lt;/ldap&gt;
&lt;/request&gt;

&lt;!-- Modify. Modifies an existing entry; type=add|delete|modify--&gt;
 &lt;request subst="false"&gt;
   &lt;ldap type="modify" dn="cn=u119843,dc=pablo-desktop" &gt;
    &lt;modification type="replace"&gt;
     &lt;attr type="sn"&gt;&lt;value&gt;SomeSN&lt;/value&gt;&lt;/attr&gt;
     &lt;attr type="mail"&gt;&lt;value&gt;some@mail.com&lt;/value&gt;&lt;/attr&gt;
    &lt;/modification&gt;
  &lt;/ldap&gt;
 &lt;/request&gt;
&lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection Mixing session type-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc64">6.6.8</A>  Mixing session type</H4><!--SEC END --><P>Since version <B>1.3.2</B>, a new tag <TT>change_type</TT> can be
used in a session to change it’s type.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;request&gt; &lt;jabber type="chat" ack="no_ack" size="16"
destination="offline"/&gt; &lt;/request&gt;

    &lt;thinktime value="3"/&gt;

    &lt;change_type new_type="ts_http" host="foo.bar" port="80"
server_type="tcp" store="true"/&gt;

    &lt;request&gt; &lt;http url="http://foo.bar/"/&gt; &lt;/request&gt;
    &lt;request&gt; &lt;http url="/favicon"/&gt; &lt;/request&gt;

    &lt;change_type new_type="ts_jabber" host="localhost" port="5222"
server_type="tcp" restore="true"/&gt;

    &lt;request&gt; &lt;jabber type="chat" ack="no_ack" size="16"
destination="previous"/&gt; &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P><FONT COLOR=purple>store=’true’</FONT> can be used to save the current state of the session (socket,
cookies for http, …) and <FONT COLOR=purple>restore=’true’</FONT> to reuse the previous state when
you switch back to the old protocol.</P><P>A dynamic variable set in the first part of the session will be
available after a <TT>change_type</TT>. There is currently one caveat: you have
to use a full URL in the first http request after a <TT>&lt;change_type&gt;</TT> (a
relative URL will fail).</P><!--TOC subsection Advanced features-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc65">6.7</A>  Advanced features</H3><!--SEC END --><!--TOC subsubsection Dynamic substitutions-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc66">6.7.1</A>  Dynamic substitutions</H4><!--SEC END --><P>Dynamic substitution are mark-up placed in element of the scenario.
For HTTP, this mark-up can be placed in basic authentication (www_authenticate
tag: userid and passwd attributes), URL (to change GET parameter)
and POST content.</P><P>Those mark-up are of the form <FONT COLOR=purple>%%Module:Function%%</FONT>.
Substitutions are executed on a request-by-request basis, only if the
request tag has the attribute <FONT COLOR=purple>subst="true"</FONT>.</P><P>When a substitution is requested, the substitution mark-up is replaced by
the result of the call to the Erlang function:
<FONT COLOR=purple>Module:Function({Pid, DynData})</FONT> where Pid is the Erlang process
id of the current virtual user and DynData the list of all Dynamic
variables (<B>Warn: before version 1.1.0, the argument was just the
Pid !</B>).</P><P>Here is an example of use of substitution in a Tsung scenario:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;session name="rec20040316-08:47" probability="100" type="ts_http"&gt;
 &lt;request subst="true"&gt;
  &lt;http url="/echo?symbol=%%symbol:new%%" method="GET"&gt;
  &lt;/http&gt;&lt;/request&gt;
&lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Here is the Erlang code of the module used for dynamic substitution:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">-module(symbol).
-export([new/1]).

new({Pid, DynData}) -&gt;
    case random:uniform(3) of
        1 -&gt; "IBM";
        2 -&gt; "MSFT";
        3 -&gt; "RHAT"
    end.
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>(use <TT>erlc</TT> to compiled the code, and put the resulting .beam
file in <TT>\$PREFIX/lib/erlang/lib/tsung-X.X.X/ebin/</TT> on all client
machines)</P><P>As you can see, writing scenario with dynamic substitution is
simple. It can be even simpler using dynamic variables (see later).</P><P>If you want to set unique id, you can use the built-in function
<TT>ts_user_server:get_unique_id</TT>.
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;session name="rec20040316-08:47" probability="100" type="ts_http"&gt;
 &lt;request subst="true"&gt;
  &lt;http url="/echo?id=%%ts_user_server:get_unique_id%%" method="GET"&gt;
  &lt;/http&gt;&lt;/request&gt;
&lt;/session&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection Reading external file-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc67">6.7.2</A>  Reading external file</H4><!--SEC END --><P>
<B>New in 1.0.3</B>: A new module <TT>ts_file_server</TT> is available. You
can use it to read external files. For example, if you need to read user
names and passwd from a CSV file, you can do it with it (currently,
you can read only a single file).</P><P>You have to add this in the XML configuration file:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;option name="file_server"  value="/tmp/userlist.csv"&gt;&lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P><B>New in 1.2.2</B>: You can read several files, using the <TT>id</TT>
attribute to identify each file:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;option name="file_server"  value="/tmp/userlist.csv"&gt;&lt;/option&gt;
 &lt;option name="file_server" id='random' value="/tmp/randomnumbers.csv"&gt;&lt;/option&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Now you can build you own function to use it, for example, create a
file called <TT>readcsv.erl</TT>:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">-module(readcsv).
-export([user/1]).

user({Pid,DynVar})-&gt;
    {ok,Line} = ts_file_server:get_next_line(),
    [Username, Passwd] = string:tokens(Line,";"),
    "username=" ++ Username ++"&amp;password=" ++ Passwd.
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>The output of the function will be a string <FONT COLOR=purple>username=USER&amp;password=PASSWORD</FONT></P><P>Then compile it with <TT>erlc readcsv.erl</TT> and put
<TT>readcsv.beam</TT> in
<TT>\$prefix/lib/erlang/lib/tsung-VERSION/ebin</TT> directory (if the
file has an id set to <FONT COLOR=purple>random</FONT>, change the call to:<BR>
<TT>ts_file_server:get_next_line(random)</TT>).</P><P>Then use something like this in your session:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;request subst="true"&gt;
    &lt;http url='/login.cgi' version='1.0' contents='%%readcsv:user%%&amp;amp;op=login'
    content_type='application/x-www-form-urlencoded' method='POST'&gt;
    &lt;/http&gt;
  &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Two functions are available: <TT>ts_file_server:get_next_line</TT>
and <TT>ts_file_server:get_random_line</TT>. For the
<TT>get_next_line</TT> function, when the end of file is reached, the
first line of the file will be the next line.</P><P><B>New in 1.3.0</B>: you no longer have to create an external
function to parse a simple csv file: you can use <TT>setdynvars</TT>
(see next section for detailed documentation):</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;setdynvars sourcetype="file" fileid="userlist.csv" delimiter=";" order="iter"&gt;
 &lt;var name="username" /&gt;
 &lt;var name="user_password" /&gt;
&lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>This defines two dynamic variables <TT>username</TT> and
<TT>user_password</TT> filled with the next entry from the csv
file. Using the previous example, the request is now:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;request subst="true"&gt;
    &lt;http url='/login.cgi' version='1.0'
      contents='username=%%_username%%&amp;amp;password=%%_user_password%%&amp;amp;op=login'
    content_type='application/x-www-form-urlencoded' method='POST'&gt;
    &lt;/http&gt;
  &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Much simpler than the old method !</P><P>In case you have several arrival phases programmed and if you use file with 
order="iter" the position in the file will not be reset between different 
arrival phase. You will not be returned to the first line when changing phase.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;arrivalphase phase="1" duration="10" unit="minute"&gt;
   &lt;users maxnumber="10" arrivalrate="100" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
  &lt;arrivalphase phase="2" duration="10" unit="minute"&gt;
   &lt;users maxnumber="20" arrivalrate="100" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>In this example phase 1 will read about 10 lines and phase 2 will read the next
20 lines.</P><!--TOC subsubsection Dynamic variables-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc68">6.7.3</A>  Dynamic variables</H4><!--SEC END --><P><A NAME="Dynamic variables"></A></P><P>In some cases, you may want to use a value given by the server in a
response later in the session, and this value is <B>dynamically
generated</B> by the server for each user. For this, you can use
<FONT COLOR=purple>&lt;dyn_variable&gt;</FONT> in the scenario</P><P>Let’s take an example with HTTP. You can easily grab a value in a HTML
form like:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;form action="go.cgi" method="POST"&gt;
&lt;hidden name="random_num" value="42"&gt;&lt;/form&gt;
&lt;/form&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>with:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;request&gt;
   &lt;dyn_variable name="random_num" &gt;&lt;/dyn_variable&gt;
   &lt;http url="/testtsung.html" method="GET" version="1.0"&gt;&lt;/http&gt;
 &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Now <TT>random_num</TT> will be set to 42 during the user’s session. It’s
value will be replace in all mark-up of the form
<FONT COLOR=purple>%%_random_num%%</FONT> if and only if the <TT>request</TT> tag has the
attribute <FONT COLOR=purple>subst="true"</FONT>, like:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;request subst="true"&gt;
      &lt;http url='/go.cgi' version='1.0'
      contents='username=nic&amp;amp;random_num=%%_random_num%%&amp;amp;op=login'
      content_type='application/x-www-form-urlencoded' method='POST'&gt;
      &lt;/http&gt;
    &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph Regexp-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->Regexp</H5><!--SEC END --><P>If the dynamic value is not a form variable, you can set a regexp by
hand, for example to get the title of a HTML page: the regexp engine
uses the <TT>re</TT> module, a Perl like regular expressions module
for Erlang.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;request&gt;
      &lt;dyn_variable name="mytitlevar"
                    re="&amp;lt;title&amp;gt;(.*)&amp;lt;/title&amp;gt;"/&gt;
      &lt;http url="/testtsung.html" method="GET" version="1.0"&gt;&lt;/http&gt;
    &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Previously (before 1.4.0), Tsung uses the old <TT>regexp</TT> module
from erlang. This is now deprecated. The syntax was:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;request&gt;
      &lt;dyn_variable name="mytitlevar"
                    regexp="&amp;lt;title&amp;gt;\(.*\)&amp;lt;/title&amp;gt;"/&gt;
      &lt;http url="/testtsung.html" method="GET" version="1.0"&gt;&lt;/http&gt;
    &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph XPath-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->XPath</H5><!--SEC END --><P>A new way to analyze the server response has been introduced in the
release <B>1.3.0</B>. It is available only for the HTTP and XMPP plugin since it is
based on XML/HTML parsing. This feature uses the mochiweb library
and <B>only works with erlang R12B and newer version</B>.</P><P>This give us some benefices:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
XPath is simple to write and to read, and match very well with
HTML/XML pages
</LI><LI CLASS="li-itemize">The parser works on binaries(), and doesn’t create any
string().
</LI><LI CLASS="li-itemize">The cost of parsing the HTML/XML and build the tree is amortized
between all the dyn_variables defined for a given request
</LI></UL><P>To utilize xpath expression, use a <TT>xpath</TT> attribute when
defining the dyn_variable, instead of <TT>re</TT>, like:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;dyn_variable name="field1_value" xpath="//input[@name='field1']/@value"/&gt;
&lt;dyn_variable name="title" xpath="/html/head/title/text()"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>There is a bug in the xpath engine, result nodes from "descendant-or-self" aren’t returned in document order. This isn’t a problem for the most common cases.
However, queries like <FONT COLOR=purple>//img[1]/@src</FONT> are not recommended, as the order of the <FONT COLOR=purple>&lt;img&gt;</FONT> elements returned from //img is not the expected.
The order is respected for paths without "descendant-or-self" axis, so this: <FONT COLOR=purple>/html/body/div[2]/img[3]/@src</FONT> is interpreted as expected and can be safely used.</P><P>It is possible to use Xpath to get a list of elements from an html page, allowing dynamic retrieval of objects. You can either create embedded erlang code to parse the list produced, or use foreach that was introduced in release <B>(</B>1.4.0).</P><P>For XMPP, you can get all the contacts in a dynamic variable:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;request subst="true"&gt;
    &lt;dyn_variable name="contactJids"
      xpath="//iq[@type='result']/query[@xmlns='jabber:iq:roster']//item[string-length(@wr:type)=0]/@jid"
    /&gt;
    &lt;jabber type="iq:roster:get" ack="local"/&gt;
&lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph JSONPath-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->JSONPath</H5><!--SEC END --><P>
<A NAME="sec:jsonpath"></A></P><P>Another way to analyze the server response has been introduced in the
release <B>1.3.2</B> when the server is sending JSON data. It is only for the HTTP plugin. This feature uses the mochiweb library
and <B>only works with erlang R13B and newer version</B>.</P><P>Tsung implements a (very) limited subset of JSONPath as defined here <A HREF="http://goessner.net/articles/JsonPath/"><TT>http://goessner.net/articles/JsonPath/</TT></A></P><P>To utilize jsonpath expression, use a <TT>jsonpath</TT> attribute when
defining the dyn_variable, instead of <TT>re</TT>, like:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;dyn_variable name="array3_value" jsonpath="field.array[3].value"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You can also use expressions <FONT COLOR=purple>Key=Val</FONT>, e.g.:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;dyn_variable name="myvar" jsonpath="field.array[?name=bar].value"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph PostgreSQL-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->PostgreSQL</H5><!--SEC END --><P>
<B>New in 1.3.2!</B></P><P>Since the PostgreSQL protocol is binary, regexp are not useful to
parse the output of the server. Instead, a specific parsing can be
done to extract content from the server’s response; to do this, use the
<TT>pgsql_expr</TT> attribute. Use <FONT COLOR=purple>data_row[L][C]</FONT> to
extract the column C of the line L of the data output. You can also use
the literal name of the column (<I>ie.</I> the field name of the
table). This example extract 3 dynamic variables from the server’s
response:</P><P>First one, extract the 3rd column of the fourth row, then the <TT>mtime</TT>
field from the second row, and then it extract some data of the
row_description.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;request&gt;
      &lt;dyn_variable name="myvar" pgsql_expr="data_row[4][3]"/&gt;
      &lt;dyn_variable name="mtime" pgsql_expr="data_row[2].mtime"/&gt;
      &lt;dyn_variable name="row" pgsql_expr="row_description[1][3][1]"/&gt;
      &lt;pgsql type="sql"&gt;SELECT * from pgbench_history LIMIT 20;&lt;/pgsql&gt;
     &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>A row description looks like this:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">=INFO REPORT==== 14-Apr-2010::11:03:22 ===
            ts_pgsql:(7:&lt;0.102.0&gt;) PGSQL: Pair={row_description,
                                                [{"tid",text,1,23,4,-1,16395},
                                                 {"bid",text,2,23,4,-1,16395},
                                                 {"aid",text,3,23,4,-1,16395},
                                                 {"delta",text,4,23,4,-1,
                                                  16395},
                                                 {"mtime",text,5,1114,8,-1,
                                                  16395},
                                                 {"filler",text,6,1042,-1,26,
                                                  16395}]}
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>So in the example, the <TT>row</TT> variable equals "aid".</P><!--TOC paragraph set_dynvars-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->set_dynvars</H5><!--SEC END --><P><B>Since version 1.3.0</B>, more powerful dynamic variables are implemented:</P><P>You can set dynamic variables not only while parsing server data, but
you can build them using external files or generate them with a function
or generate random numbers/strings:</P><P>Several types of dynamic variables are implemented (<TT>sourcetype</TT> tag):
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Dynamic variables defined by calling an erlang function:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">      &lt;setdynvars sourcetype="erlang" callback="ts_user_server:get_unique_id"&gt;
        &lt;var name="id1" /&gt;
      &lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI><LI CLASS="li-enumerate">Dynamic variables defined by parsing an external file:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">      &lt;setdynvars sourcetype="file" fileid="userdb" delimiter=";" order="iter"&gt;
        &lt;var name="user" /&gt;
        &lt;var name="user_password" /&gt;
      &lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><TT>delimiter</TT> can be any string, and <TT>order</TT> can be
<FONT COLOR=purple>iter</FONT> or <FONT COLOR=purple>random</FONT>
</LI><LI CLASS="li-enumerate">A dynamic variable can be a random number (uniform distribution)
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">      &lt;setdynvars sourcetype="random_number" start="3" end="32"&gt;
        &lt;var name="rndint" /&gt;
      &lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI><LI CLASS="li-enumerate">A dynamic variable can be a random string
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">      &lt;setdynvars sourcetype="random_string" length="13"&gt;
        &lt;var name="rndstring1" /&gt;
      &lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI><LI CLASS="li-enumerate">A dynamic variable can be a urandom string: this is much faster than
the random string, but the string is not really random: the same set
of characters is always used.
</LI><LI CLASS="li-enumerate">A dynamic variable can be generated by dynamic evaluation of
erlang code:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">      &lt;setdynvars sourcetype="eval"
                  code="fun({Pid,DynVars})-&gt;
                           {ok,Val}=ts_dynvars:lookup(md5data,DynVars),
                           ts_digest:md5hex(Val) end."&gt;
        &lt;var name="md5sum" /&gt;
      &lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>In this case, we use tsung function <TT>ts_dynvars:lookup</TT> to retrieve the
dynamic variable named <TT>md5data</TT>. This dyn_variable <TT>md5data</TT>
can be set in any of the ways described in the Dynamic variables
section <A HREF="#Dynamic variables">6.7.3</A>.
</P></LI><LI CLASS="li-enumerate">A dynamic variable can be generated by applying a JSONPath
specification (see <A HREF="#sec:jsonpath">6.7.3</A>) to an existing dynamic
variable:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;setdynvars sourcetype="jsonpath" from='notification' jsonpath="result[?state=OK].node"&gt;
      &lt;var name="deployed" /&gt;
  &lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI><LI CLASS="li-enumerate">You can create dynamic variables to get the hostname and port of
the current server
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">    &lt;setdynvars sourcetype="server"&gt;
      &lt;var name="host" /&gt;
      &lt;var name="port" /&gt;
    &lt;/setdynvars&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI></OL><P>A <TT>setdynvars</TT> can be defined anywhere in a session.</P><!--TOC subsubsection Checking the server’s response-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc69">6.7.4</A>  Checking the server’s response</H4><!--SEC END --><P>With the tag <TT>match</TT> in a <TT>request</TT> tag, you can check
the server’s response against a given string, and do some actions
depending on the result. In any case, if it matches, this will
increment the <TT>match</TT> counter, if it does not match, the
<TT>nomatch</TT> counter will be incremented.</P><P>For example, let’s say you want to test a login page. If the login is
ok, the server will respond with <FONT COLOR=purple>Welcome !</FONT> in the
HTML body, otherwise not. To check that:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;request&gt;
      &lt;match do="continue" when="match"&gt;Welcome !&lt;/match&gt;
      &lt;http url='/login.php' version='1.0' method='POST'
       contents='username=nic&amp;amp;user_password=sesame'
       content_type='application/x-www-form-urlencoded' &gt;
 &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You can use a regexp instead of a simple string.</P><P>The list of available actions to do is:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
continue: do nothing, continue (only update match or nomatch counters)
</LI><LI CLASS="li-itemize">log: log the request id, userid, sessionid, name in a file (in <TT>match.log</TT>)
</LI><LI CLASS="li-itemize">abort : abort the session
</LI><LI CLASS="li-itemize">restart: restart the session. The maximum number of
restarts is 3 by default.
</LI><LI CLASS="li-itemize">loop: repeat the request, after 5 seconds. The maximum number of
loops is 20 by default.
</LI><LI CLASS="li-itemize">dump: dump the content of the response in a file. The filename
is <TT>match-&lt;userid&gt;-&lt;sessionid&gt;-&lt;requestid&gt;-&lt;dumpid&gt;.dump</TT>
</LI></UL><P>You can mixed several match tag in a single request:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;request&gt;
      &lt;match do="loop" sleep_loop="5" max_loop="10" when="match"&gt;Retry&lt;/match&gt;
      &lt;match do="abort" when="match"&gt;Error&lt;/match&gt;
      &lt;http url='/index.php' method=GET'&gt;
 &lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You can also do the action on "nomatch" instead of "match".</P><P>If you want to skip the HTTP headers, and match only on the body, you
can use <FONT COLOR=purple>skip_headers=’http’</FONT>. Also, you can apply a
function to the content before matching; for example the following
example use both features to compute the md5sum on the body of a HTTP
response, and compares it to a given value:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;match do='log' when='nomatch' skip_headers='http'
  apply_to_content='ts_digest:md5hex'&gt;01441debe3d7cc65ba843eee1acff89d&lt;/match&gt;
&lt;http url="/" method="GET" version="1.1"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You can also use dynamic variables, using the <TT>subst</TT> attribute:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;match do='log' when='nomatch' subst='true' &gt;%%_myvar%%&lt;/match&gt;
&lt;http url="/" method="GET"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE>

<P><B>Since 1.5.0</B>, it's now possible to add <TT>name</TT> attribute in <TT>match</TT> tag to name a record printed in match.log as follow:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>

</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;match do='log' when='match' name='http_match_200ok'&gt;200OK&lt;/match&gt;
&lt;http url="/" method="GET"/&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE>

<!--TOC subsubsection Loops, If, Foreach-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc70">6.7.5</A>  Loops, If, Foreach</H4><!--SEC END --><P><B>Since 1.3.0</B>, it’s now possible to add conditional/unconditional loops in a session.</P><P><B>Since 1.4.0</B>, it is possible to loop through a list of dynamic variables thanks to foreach.</P><!--TOC paragraph &lt;for&gt;-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->&lt;for&gt;</H5><!--SEC END --><P>Repeat the enclosing actions a fixed number of times. A dynamic
variable is used as counter, so the current iteration could be used in
requests. List of attributes:</P><DL CLASS="description"><DT CLASS="dt-description">
<B>from</B></DT><DD CLASS="dd-description"> Initial Value
</DD><DT CLASS="dt-description"><B>to</B></DT><DD CLASS="dd-description"> Last value
</DD><DT CLASS="dt-description"><B>incr</B></DT><DD CLASS="dd-description"> Amount to increment in each iteration
</DD><DT CLASS="dt-description"><B>var</B></DT><DD CLASS="dd-description"> Name of the variable to hold the counter
</DD></DL><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"> &lt;for from="1" to="10" incr="1" var="counter"&gt;
  [...]
  &lt;request&gt; &lt;http url="/page?id=%%_counter%%"&gt;&lt;/http&gt; &lt;/request&gt;
  [...]
 &lt;/for&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC paragraph &lt;repeat&gt;-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->&lt;repeat&gt;</H5><!--SEC END --><P>
Repeat the enclosing action (while|until) some condition. This is
intended to be used together with <FONT COLOR=purple>dyn_variable</FONT> declarations. List of
attributes:</P><DL CLASS="description"><DT CLASS="dt-description">
<B>name</B></DT><DD CLASS="dd-description"> Name of the repeat
</DD><DT CLASS="dt-description"><B>max_repeat</B></DT><DD CLASS="dd-description"> Max number of loops (default value is 20)
</DD></DL><P>The last element of repeat must be either <FONT COLOR=purple>&lt;while&gt;</FONT> or <FONT COLOR=purple>&lt;until&gt;</FONT> example:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;repeat name="myloop" max_repeat="40"&gt;

   [...]

   &lt;request&gt;
     &lt;dyn_variable name="result" re="Result: (.*)"/&gt;
     &lt;http url="/random" method="GET" version="1.1"&gt;&lt;/http&gt;
   &lt;/request&gt;

   [...]

  &lt;until var="result" eq="5"/&gt; &lt;/repeat&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P><B>Since 1.3.1</B>, it’s also possible to add if statements based on
dynamic variables:
</P><!--TOC paragraph &lt;if&gt;-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->&lt;if&gt;</H5><!--SEC END --><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;if var="tsung_userid" eq="3"&gt;
  &lt;request&gt; &lt;http url="/foo"/&gt; &lt;/request&gt;
  &lt;request&gt; &lt;http url="/bar"/&gt; &lt;/request&gt;
&lt;/if&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You can use <TT>eq</TT> or <TT>neq</TT> to check the variable.</P><P>If the dynamic variable is a list (output from xpath for example), you
can access to the nth element of a list like this:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;if var="myvar[1]" eq="3"&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>(here we compare the first element of the list to 3)</P><!--TOC paragraph &lt;foreach&gt;-->
<H5 CLASS="paragraph"><!--SEC ANCHOR -->&lt;foreach&gt;</H5><!--SEC END --><P>Repeat the enclosing actions for all the elements contained in the list specified. The basic syntax is as follows:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;foreach name="element" in="list"&gt;
  &lt;request subst="true"&gt;
    &lt;http url="%%_element%%" method="GET" version="1.1"/&gt;
  &lt;/request&gt;
&lt;/foreach&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>It is possible to limit the list of elements you’re looping through, thanks to the use of the <FONT COLOR=purple>include</FONT> or <FONT COLOR=purple>exclude</FONT> attributes inside the foreach statement.</P><P>As an example, if you want to include only elements with a local path you can write:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;foreach name="element" in="list" include="^/.*$"&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>If you want to exclude all the elements from a specific URI, you would write:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;foreach name="element" in="list" exclude="http:\/\/.*\.tld\.com\/.*$"&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You can combine this with a xpath query. For instance the following scenario will retrieve all the images specified on a web page:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;request subst="true"&gt;
  &lt;dyn_variable name="img_list" xpath="//img/@src"/&gt;
  &lt;http url="/mypage.html" method="GET" version="1.1"/&gt;
&lt;/request&gt;
&lt;foreach name="img" in="img_list"&gt;
  &lt;request subst="true"&gt;
    &lt;http url="%%_img%%" method="GET" version="1.1"/&gt;
  &lt;/request&gt;
&lt;/foreach&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsubsection Rate limiting-->
<H4 CLASS="subsubsection"><!--SEC ANCHOR --><A NAME="htoc71">6.7.6</A>  Rate limiting</H4><!--SEC END --><P>Since version <B>1.4.0</B>, rate limiting can be enabled, either globally
(see <A HREF="#sec:options">6.5</A>), or for each session separately. </P><P>For example, to limit the rate to 64KB/sec for a given session:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;session name="http-example" probability="70" type="ts_http"&gt;
   &lt;set_option name="rate_limit" value="64"&gt;&lt;/option&gt;
   ...
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Only the incoming traffic is rate limited currently.</P><!--TOC section Statistics and reports-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc72">7</A>  Statistics and reports</H2><!--SEC END --><P>
<A NAME="sec:statistics-reports"></A>
</P><!--TOC subsection File format-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc73">7.1</A>  File format</H3><!--SEC END --><P>By default, tsung use it’s own format (see FAQ <A HREF="#sec:what-format-stats">A.6</A>).</P><P>Since version 1.4.2, you can configure tsung to use a JSON format;
however in this case, the tools <TT>tsung_stats.pl</TT> and
<TT>tsung_plotter</TT> will not work with the JSON files.</P><P>To enable JSON output, use:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;tsung backend='json' ...&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Example output file with JSON:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">{
 "stats": [
 {"timestamp": 1317413841,  "samples": []},
 {"timestamp": 1317413851,  "samples": [
   {"name": "users", "value": 0, "max": 0},
   {"name": "users_count", "value": 0, "total": 0},
   {"name": "finish_users_count", "value": 0, "total": 0}]},
 {"timestamp": 1317413861,  "samples": [
   {"name": "users", "value": 0, "max": 1},
   {"name": "load", "hostname": "requiem", "value": 1, "mean":
     0.0,"stddev": 0,"max": 0.0,"min": 0.0 ,"global_mean": 0
     ,"global_count": 0},
   {"name": "freemem", "hostname": "requiem", "value": 1, "mean":
     2249.32421875,"stddev": 0,"max": 2249.32421875,"min":
     2249.32421875 ,"global_mean": 0 ,"global_count": 0},
   {"name": "cpu", "hostname": "requiem", "value": 1, "mean":
     4.790419161676647,"stddev": 0,"max": 4.790419161676647,"min":
     4.790419161676647 ,"global_mean": 0 ,"global_count": 0},
   {"name": "session", "value": 1, "mean": 387.864990234375,"stddev":
     0,"max":  387.864990234375,"min": 387.864990234375
     ,"global_mean": 0 ,"global_count": 0},
   {"name": "users_count", "value": 1, "total": 1},
   {"name": "finish_users_count", "value": 1, "total": 1},
   {"name": "request", "value": 5, "mean": 75.331787109375,"stddev":
     46.689242405019954,"max":  168.708984375,"min": 51.744873046875
     ,"global_mean": 0 ,"global_count": 0},
   {"name": "page", "value": 1, "mean": 380.7548828125,"stddev":
     0.0,"max":  380.7548828125,"min": 380.7548828125 ,"global_mean":
     0 ,"global_count": 0},
   {"name": "connect", "value": 1, "mean": 116.70703125,"stddev":
     0.0,"max":  116.70703125,"min": 116.70703125 ,"global_mean": 0
     ,"global_count": 0},
   {"name": "size_rcv", "value": 703, "total": 703},
   {"name": "size_sent", "value": 1083, "total": 1083},
   {"name": "connected", "value": 0, "max": 0}, {"name": "http_304", "value": 5, "total": 5}]}]}
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection Available stats-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc74">7.2</A>  Available stats</H3><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>request</TT> Response time for each request.
</LI><LI CLASS="li-itemize"><TT>page</TT> Response time for each set of requests (a page is a group
of request not separated by a thinktime).
</LI><LI CLASS="li-itemize"><TT>connect</TT> Duration of the connection establishment.
</LI><LI CLASS="li-itemize"><TT>reconnect</TT> Number of reconnection.
</LI><LI CLASS="li-itemize"><TT>size_rcv</TT> Size of responses in bytes.
</LI><LI CLASS="li-itemize"><TT>size_sent</TT> Size of requests in bytes.
</LI><LI CLASS="li-itemize"><TT>session</TT> Duration of a user’s session.
</LI><LI CLASS="li-itemize"><TT>users</TT> Number of simultaneous users (it’s session has started, but not yet finished).
</LI><LI CLASS="li-itemize"><TT>connected</TT> number of users with an opened TCP/UDP connection (example: for
HTTP, during a think time, the TCP connection can be closed by the server,
and it won’t be reopened until the thinktime has expired). <B>new
in 1.2.2</B>.
</LI><LI CLASS="li-itemize">custom transactions
</LI></UL><P>The mean response time (for requests, page, etc.) is computed every 10
sec (and reset). That’s why you have the highest mean and lowest mean
values in the Stats report. <B>Since version 1.3.0</B>, the mean for
the whole test is also computed.</P><P>HTTP specific stats:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
counter for each response status (200, 404, etc.)
</LI></UL><P>Jabber specific stats:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>request_noack</TT> Counter of <TT>no_ack</TT> requests. Since
response time is meaningless with <TT>no_ack</TT>
requests, we keep a separate stats for this. <B>new in 1.2.2</B>.
</LI><LI CLASS="li-itemize"><TT>async_unknown_data_rcv</TT> Only if bidi is true for a
session. counter the number of messages received from the server
without doing anything. <B>new in 1.2.2</B>.
</LI><LI CLASS="li-itemize"><TT>async_data_sent</TT> Only if bidi is true for a
session. Count the number of messages sent to the server in response
of a message received from the server. <B>new in 1.2.2</B>.
</LI></UL><P>OS monitoring stats:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>{load,&lt;host&gt;}</TT> System load average during the last minute
</LI><LI CLASS="li-itemize"><TT>{cpu,&lt;host}</TT> CPU percentage (Maximum is 100%, ex: on dual core
system, 100% means: both cores are 100% used)
</LI><LI CLASS="li-itemize"><TT>{freemem,&lt;host&gt;}</TT> Free Memory
</LI></UL><!--TOC subsection Design-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc75">7.3</A>  Design</H3><!--SEC END --><P>A bit of explanation on the design and internals of the statistics engine:</P><P>Tsung was designed to handle thousands of requests/sec, for very
long period of times (several hours) so it do not write all data to
the disk (for performance reasons). Instead it computes on the fly an
estimation of the mean and standard variation for each type of data,
and writes these estimations every 10 seconds to the disk (and then
starts a new estimation for the next 10 sec). These computations are
done for two kinds of data:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>sample</TT>, for things like response time
</LI><LI CLASS="li-itemize"><TT>sample_counter</TT> when the input is a cumulative one (number of
packet sent for ex.).
</LI></UL><P>There are also two other types of useful data (no averaging is done for
those) :
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>counter</TT>: a simple counter, for HTTP status code for ex.
</LI><LI CLASS="li-itemize"><TT>sum</TT> for ex. the cumulative HTTP response’s size (it gives an
estimated bandwidth usage).
</LI></UL><!--TOC subsection Generating the report-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc76">7.4</A>  Generating the report</H3><!--SEC END --><P>cd to the log directory of your test (say
<TT>~/.tsung/log/20040325-16:33/</TT>) and use the script
<TT>tsung_stats.pl</TT>:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">/usr/lib/tsung/bin/tsung_stats.pl
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P><B>You can generate the statistics even when the test is running !</B></P><P>use <FONT COLOR=purple>–help</FONT> to view all available options:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">Available options:
        [--help] (this help text)
        [--verbose] (print all messages)
        [--debug] (print receive without send messages)
        [--dygraph] use dygraphs (http://danvk.org/dygraphs/) to render graphs
        [--noplot]  (don't make graphics)
        [--gnuplot &lt;command&gt;]  (path to the gnuplot binary)
        [--nohtml]  (don't create HTML reports)
        [--logy]  (logarithmic scale for Y axis)
        [--tdir &lt;template_dir&gt;] (Path to the HTML tsung templates)
        [--noextra  (don't generate graphics from extra data (os monitor, etc)
        [--rotate-xtics  (rotate legend of x axes)
        [--stats &lt;file&gt;] (stats file to analyse, default=tsung.log)
        [--img_format &lt;format&gt;] (output format for images, default=png
                                 available format: ps, svg, png, pdf)
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Version <B>1.4.0</B> adds a new graphical output based on
<A HREF="http://danvk.org/dygraphs/"><TT>http://danvk.org/dygraphs/</TT></A>.</P><!--TOC subsection Tsung summary-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc77">7.5</A>  Tsung summary</H3><!--SEC END --><P>
Figure <A HREF="#fig:report">3</A> shows an example of a summary report.
</P><BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<DIV CLASS="center">
<IMG SRC="images/tsung-report.png" ALT="images/tsung-report.png">
</DIV>
<DIV CLASS="caption"><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left>Figure 3: Report</TD></TR>
</TABLE></DIV>
<A NAME="fig:report"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></BLOCKQUOTE><!--TOC subsection Graphical overview-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc78">7.6</A>  Graphical overview</H3><!--SEC END --><P>Figure <A HREF="#fig:graph">4</A> shows an example of a graphical report.</P><BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<DIV CLASS="center">
<IMG SRC="images/tsung-graph.png" ALT="images/tsung-graph.png">
</DIV>
<DIV CLASS="caption"><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left>Figure 4: Graphical output</TD></TR>
</TABLE></DIV>
<A NAME="fig:graph"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></BLOCKQUOTE><!--TOC subsection Tsung Plotter-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc79">7.7</A>  Tsung Plotter</H3><!--SEC END --><P>
Tsung-Plotter (<TT>tsplot</TT> command) is an optional tool recently
added in the Tsung distribution (it is written in Python), useful to
compare different tests runned by Tsung. <TT>tsplot</TT> is able to
plot data from several <TT>tsung.log</TT> files onto the same charts,
for further comparisons and analyzes. You can easily customize the
plots you want to generate by editing simple configuration files. You
can get more information in the manual page of the tool (<TT>man
tsplot</TT>).</P><P>Example of use:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">tsplot "First test" firsttest/tsung.log "Second test" secondtest/tsung.log -d outputdir
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>Here’s an example of the charts generated by tsplot (figure <A HREF="#fig:graph:tsplot">5</A>):</P><BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
<DIV CLASS="center">
<IMG SRC="images/connected.png" ALT="images/connected.png">
</DIV>
<DIV CLASS="caption"><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left>Figure 5: Graphical output of tsplot</TD></TR>
</TABLE></DIV>
<A NAME="fig:graph:tsplot"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></BLOCKQUOTE><!--TOC subsection RRD-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc80">7.8</A>  RRD</H3><!--SEC END --><P>
A contributed perl script <TT>tsung-rrd.pl</TT> is able to create rrd
files from the tsung log files. It’s available in <TT>/usr/lib/tsung/bin/tsung-rrd.pl</TT></P><!--TOC section References-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc81">8</A>  References</H2><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Tsung</EM> home page: <A HREF="http://tsung.erlang-projects.org/"><TT>http://tsung.erlang-projects.org/</TT></A>
</LI><LI CLASS="li-itemize"><EM>Tsung</EM> description (French)<SUP><A NAME="text1" HREF="#note1">1</A></SUP>
</LI><LI CLASS="li-itemize">Erlang web site <A HREF="http://www.erlang.org/"><TT>http://www.erlang.org/</TT></A>
</LI><LI CLASS="li-itemize">Erlang programmation, Mickaël Rémond, Editions Eyrolles, 2003
<SUP><A NAME="text2" HREF="#note2">2</A></SUP>
</LI><LI CLASS="li-itemize"><EM>Making reliable system in presence of software errors</EM>, Doctoral Thesis,
Joe Armstrong, Stockholm, 2003 <SUP><A NAME="text3" HREF="#note3">3</A></SUP>
</LI><LI CLASS="li-itemize"><EM>Tutorial on How to write a Tsung plugin</EM>, written by t ty, <A HREF="http://www.process-one.net/en/wiki/Writing_a_Tsung_plugin/"><TT>http://www.process-one.net/en/wiki/Writing_a_Tsung_plugin/</TT></A>
</LI></UL><!--TOC section Acknowledgments-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc82">9</A>  Acknowledgments</H2><!--SEC END --><P>The first version of this document was based on a talk given by Mickael
Rémond<SUP><A NAME="text4" HREF="#note4">4</A></SUP> during an Object
Web benchmarking workshop in April 2004 (more info at
<A HREF="http://jmob.objectweb.org/"><TT>http://jmob.objectweb.org/</TT></A>).</P><!--TOC section Frequently Asked Questions-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc83">A</A>  Frequently Asked Questions</H2><!--SEC END --><!--TOC subsection Can’t start distributed clients: timeout error -->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc84">A.1</A>  Can’t start distributed clients: timeout error </H3><!--SEC END --><P>Most of the time, when a crash happened at startup without any traffic
generated, the problem arise because the main Erlang controller node cannot
create a "slave" Erlang virtual machine. The message looks like:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">Can't start newbeam on host 'XXXXX (reason: timeout) ! Aborting!
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>The problem is that the Erlang slave module cannot start a remote slave
node.</P><P>You can test this using this simple command on the controller node
(remotehost is the name of the client node)
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&gt;erl -rsh ssh -sname foo -setcookie mycookie

Eshell V5.4.3 (abort with ^G)
(foo@myhostname)1&gt;slave:start(remotehost,bar,"-setcookie mycookie").
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You should see this: <FONT COLOR=purple>{ok,bar@remotehost}</FONT></P><P>If you got <FONT COLOR=purple>{error,timeout}</FONT>, it can be caused by
several problems:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
ssh in not working (you must have a key without passphrase, or
use an agent)
</LI><LI CLASS="li-enumerate">Tsung and Erlang are not installed on all clients nodes
</LI><LI CLASS="li-enumerate">Erlang version or location (install path) is not the same on all clients nodes
</LI><LI CLASS="li-enumerate">A firewall is dropping erlang packets: indeed erlang virtual machines use
several TCP ports (dynamically generated) to communicate (if you are
using EC2, you may have to change the Security Group that is applied on the VMs used
for Tsung: open port-range “0 – 65535”)
</LI><LI CLASS="li-enumerate">SELinux: You should disable SELinux on all clients.
</LI><LI CLASS="li-enumerate">Bad <TT>/etc/hosts:</TT>
This one is wrong (real hostname should not refer to localhost/loopback):
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">127.0.0.1 localhost myhostname
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE>This one is good:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">127.0.0.1 localhost
192.168.3.2 myhostname
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE></LI><LI CLASS="li-enumerate">sshd configuration:
For example, for SuSE 9.2 sshd is compiled with restricted set of
paths (<I>ie.</I>  when you shell into the account you get the users shell,
when you execute a command via ssh you don’t) and this makes it
impossible to start an erlang node (if erlang is installed in
<TT>/usr/local</TT> for example).
Run:<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">ssh myhostname erl
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>If the erlang shell doesn’t start then check what paths sshd was compiled with
(in SuSE see <TT>/etc/ssh/sshd_config</TT>) and symlink from one of the approved paths
to the erlang executable (thanks to Gordon Guthrie for reporting this).
</P></LI><LI CLASS="li-enumerate">old beam processes (erlang virtual machines) running on client nodes: kill all
beam processes before starting tsung.
</LI></OL><P>Note that you do not need to use the 127.0.0.1 address in the configuration file.
It will not work if you use it as the injection interface. The shortname
of your client machine should not refer to this address.</P><P><EM>Warn:</EM>Tsung launches a new erlang virtual machine to do the actual injection
even when you have only one machine in the injection cluster (unless
<TT>’use_controller_vm’</TT> is set to true). This is because it
needs to by-pass some limit with the number of open socket from a
single process (1024 most of the time). The idea is to have several
system processes (Erl beam) that can handle only a small part of the
network connection from the given computer. When the
<TT>maxusers</TT> limit (simultaneous) is reach, a new Erlang beam
is launched and the newest connection can be handled by the new beam).</P><P><B>New in 1.1.0</B>: If you don’t use the distributed feature of
Tsung and have trouble to start a remote beam on a local machine,
you can set the <TT>’use_controller_vm’</TT> attribute to true, for ex.:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;client host="mymachine" use_controller_vm="true"&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection Tsung crashes when I start it -->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc85">A.2</A>  Tsung crashes when I start it </H3><!--SEC END --><P>Does your Erlang system has ssl support enabled ?</P><P>to test it:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &gt; erl
  Eshell V5.2  (abort with ^G)
  1&gt; ssl:start().
  you should see 'ok'
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection Why do i have error_connect_emfile errors ?-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc86">A.3</A>  Why do i have error_connect_emfile errors ?</H3><!--SEC END --><P>
<A NAME="sec:faq:emfile"></A>
emfile error means : <EM>too many open files</EM></P><P>This happens usually when you set a high value for <TT>maxusers</TT>
(<TT>in the &lt;client&gt;</TT> section) (the default value is 800).</P><P>The errors means that you are running out of file descriptors; you
must check that <TT>maxusers</TT> is less than the maximum number of
file descriptors per process in your system (see <TT>ulimit -n</TT>)</P><P>You can either raise the limit of your operating system ( see
<TT>/etc/security/limits.conf</TT> for Linux ) or decrease <TT>maxusers</TT>
(Tsung will have to start several virtual machine on the same host to
bypass the maxusers limit).</P><P>It could be good if you want to test a large number of users to make some
modifications to your system before launching tsung :
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Put the domain name into <TT>etc/hosts</TT> if you don’t want the DNS
overhead and you only want to test the target server
</LI><LI CLASS="li-itemize">Increase the maximum number of open files and customize tcp settings in
<TT>/etc/sysctl.conf</TT>. For example
</LI></UL><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  net.ipv4.tcp_tw_reuse = 1
  net.ipv4.tcp_tw_recycle = 1
  net.ipv4.ip_local_port_range = 1024 65000
  fs.file-max = 65000
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection Tsung still crashes/fails when I start it !-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc87">A.4</A>  Tsung still crashes/fails when I start it !</H3><!--SEC END --><P>
First look at the log file
<TT>~/.tsung/log/XXX/tsung_controller@yourhostname'</TT> to see
if there is a problem.</P><P>If the file is not created and a crashed dump file is present, maybe
you are using a binary installation of Tsung not compatible with the
version of erlang you used.</P><P>If you see nothing wrong, you can compile <EM>Tsung</EM> with full
debugging: recompile with <TT>make debug</TT> , and
don’t forget to set the loglevel to "debug" in the XML file.</P><P>To start the debugger or see what happen, start <EM>tsung</EM> with the
<FONT COLOR=purple>debug</FONT> argument instead of <FONT COLOR=purple>start</FONT>. You will have
an erlang shell on the <TT>tsung_controller</TT> node. Use
<TT>toolbar:start().</TT> to launch the graphical tools provided by
Erlang.</P><!--TOC subsection Can I dynamically follow redirect with HTTP ?-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc88">A.5</A>  Can I dynamically follow redirect with HTTP ?</H3><!--SEC END --><P>If your HTTP server sends 30X responses (redirect) with dynamic URLs,
you can handle this situation using a dynamic variable:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;request&gt;
  &lt;dyn_variable name="redirect" re="Location: (http://.*)\r"/&gt;
  &lt;http url="index.html" method="GET" &gt;&lt;/http&gt;
&lt;/request&gt;

&lt;request subst="true"&gt;
  &lt;http url="%%_redirect%%" method="GET"&gt;&lt;/http&gt;
&lt;/request&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You can even handle the case where the server use several redirections
successively using a repeat loop (this works only with version 1.3.0 and up):</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">  &lt;request&gt;
    &lt;dyn_variable name="redirect" re="Location: (http://.*)\r"/&gt;
    &lt;http url='/test/redirect.html' method='GET'&gt;&lt;/http&gt;
  &lt;/request&gt;

  &lt;repeat name="redirect_loop" max_repeat="5"&gt;
    &lt;request subst="true"&gt;
      &lt;dyn_variable name="redirect" re="Location: (http://.*)\r"/&gt;
      &lt;http url="%%_redirect%%" method="GET"&gt;&lt;/http&gt;
    &lt;/request&gt;
    &lt;until var="redirect" eq=""/&gt;
  &lt;/repeat&gt;
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection What is the format of the stats file tsung.log ?-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc89">A.6</A>  What is the format of the stats file tsung.log ?</H3><!--SEC END --><P>
<A NAME="sec:what-format-stats"></A>
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"># stats: dump at 1218093520
stats: users 247 247
stats: connected 184 247
stats: users_count 184 247
stats: page 187 98.324 579.441 5465.940 2.177 9.237 595 58
stats: request 1869 0.371 0.422 5.20703125 0.115 0.431 7444062 581
stats: connect 186 0.427 0.184 4.47216796875 0.174 0.894 88665254 59
stats: tr_login 187 100.848 579.742 5470.223 2.231 56.970 91567888 58
stats: size_rcv 2715777 3568647
stats: 200 1869 2450
stats: size_sent 264167 347870
# stats: dump at 1218093530
stats: users 356 356
stats: users_count 109 356
stats: connected -32 215
stats: page 110 3.346 0.408 5465.940 2.177 77.234 724492 245
stats: request 1100 0.305 0.284 5.207 0.115 0.385 26785716 2450
stats: connect 110 0.320 0.065 4.472 0.174 0.540 39158164 245
stats: tr_login 110 3.419 0.414 5470.223 2.231 90.461 548628831 245
stats: size_rcv 1602039 5170686
stats: 200 1100 3550
stats: size_sent 150660 498530
 ...
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>the format is, for <TT>request</TT>, <TT>page</TT>,
<TT>session</TT> and transactions (<TT>tr_XXX</TT>:</P><P><TT> # stats:’name’ 10sec_count, 10sec_mean, 10sec_stddev,
max, min, mean, count</TT></P><P>or for HTTP returns code, size ...</P><P><TT> # stats:’name’ count(during the last 10sec), totalcount(since the beginning)</TT></P><!--TOC subsection How can I compute percentile/quartiles/median for transactions or requests
response time ?-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc90">A.7</A>  How can I compute percentile/quartiles/median for transactions or requests
response time ?</H3><!--SEC END --><P>It’s not directly possible. But since <B>version 1.3.0</B>, you can
use a new experimental statistic backend: set <FONT COLOR=purple>backend="fullstats"</FONT> in the
<FONT COLOR=purple>&lt;tsung&gt;</FONT> section of your configuration file.</P><P>This will print every statistics data in a raw format in a file named
<TT>tsung-fullstats.log</TT>. <B>Warning</B>: this may impact the performance of
the controller node (a lot of data has to be written to disk).</P><P>The data looks like:
</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">{sum,connected,1}
{sum,connected,-1}
[{sample,request,214.635},
 {sum,size_rcv,268},
 {sample,page,831.189},
 {count,200},
 {sum,size_sent,182},
 {sample,connect,184.787},
 {sample,request,220.974},
 {sum,size_rcv,785},
 {count,200},
 {sum,size_sent,164},
 {sample,connect,185.482}]
{sum,connected,1}
[{count,200},{sum,size_sent,161},{sample,connect,180.812}]
[{sum,size_rcv,524288},{sum,size_rcv,524288}]
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>You will have to write your own script to analyze the output.
The format of the file may change in a future release.</P><!--TOC subsection How can I specify the number of concurrent users ?-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc91">A.8</A>  How can I specify the number of concurrent users ?</H3><!--SEC END --><P>You can’t. But it’s on purpose: the load generated by
<EM>Tsung</EM> is dependent on the arrival time between new
clients. Indeed, once a client has finished his session in
<EM>tsung</EM>, it stops. So the number of concurrent users is
a function of the arrival rate and the mean session duration.</P><P>For example, if your web site has 1000 visits/hour, the arrival rate
is 1000/3600 = 0.2778 visits/second. If you want to simulate the same
load, set the inter-arrival time is to 1/0.27778 = 3.6 <I>sec</I> (<TT>&lt;users
interarrival="3.6" unit="second"&gt;</TT> in the <TT>arrivalphase</TT> node in the
XML config file).</P><!--TOC subsection SNMP monitoring doesn’t work ?!-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc92">A.9</A>  SNMP monitoring doesn’t work ?!</H3><!--SEC END --><P>
<A NAME="sec:faq:snmp"></A>
It use SNMP v1 and the ’public’ community. It has been tested with
<A HREF="http://net-snmp.sourceforge.net/"><TT>http://net-snmp.sourceforge.net/</TT></A>.</P><P>You can try with <TT>snmpwalk</TT> to see if your snmpd config is ok:</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&gt;snmpwalk -v 1 -c public IP-OF-YOUR-SERVER .1.3.6.1.4.1.2021.4.5.0
UCD-SNMP-MIB::memTotalReal.0 = INTEGER: 1033436
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><P>SNMP doesn’t work with erlang R10B and Tsung older than 1.2.0.</P><P>There is a small bug in the <TT>snmp_mgr</TT> module in old Erlang
release (R9C-0). You have to apply this patch to make it
work. This is fixed in erlang R9C-1 and up.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">--- lib/snmp-3.4/src/snmp_mgr.erl.orig  2004-03-22 15:21:59.000000000 +0100
+++ lib/snmp-3.4/src/snmp_mgr.erl       2004-03-22 15:23:46.000000000 +0100
@@ -296,6 +296,10 @@
     end;
 is_options_ok([{recbuf,Sz}|Opts]) when 0 &lt; Sz, Sz =&lt; 65535 -&gt;
     is_options_ok(Opts);
+is_options_ok([{receive_type, msg}|Opts]) -&gt;
+    is_options_ok(Opts);
+is_options_ok([{receive_type, pdu}|Opts]) -&gt;
+    is_options_ok(Opts);
 is_options_ok([InvOpt|_]) -&gt;
     {error,{invalid_option,InvOpt}};
 is_options_ok([]) -&gt; true.
</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC subsection How can i simulate a fix number of users ?-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc93">A.10</A>  How can i simulate a fix number of users ?</H3><!--SEC END --><P>Use <TT>maxnumber</TT> to set the max number of concurrent users in a
phase, and if you want Tsung to behave like ab, you can use a loop
in a session (to send requests as fast as possible); you can also define a
max <TT>duration</TT> in <TT>&lt;load&gt;</TT>.</P><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim">&lt;load duration="5" unit="minute"&gt;
   &lt;arrivalphase phase="1" duration="10" unit="minute"&gt;
   &lt;users maxnumber="10" arrivalrate="100" unit="second"&gt;&lt;/users&gt;
&lt;/arrivalphase&gt;
&lt;/load&gt;
&lt;sessions&gt;
&lt;session probability="100" name="ab"&gt;
    &lt;for from="1" to="1000" var="i"&gt;
      &lt;request&gt;
        &lt;http url="http://myserver/index.html" method="GET"&gt;&lt;/http&gt;
      &lt;/request&gt;
    &lt;/for&gt;
&lt;/session&gt;
&lt;/sessions&gt;

</PRE></TD></TR>
</TABLE></TD><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--TOC section Errors list-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc94">B</A>  Errors list</H2><!--SEC END --><DL CLASS="description"><DT CLASS="dt-description">
<B>error_closed</B></DT><DD CLASS="dd-description"> Only for non persistent session (XMPP); the
server unexpectedly closed the connection; the session is aborted.
</DD><DT CLASS="dt-description"><B>error_inet_&lt;ERRORNAME&gt;</B></DT><DD CLASS="dd-description"> Network error; see
<A HREF="http://www.erlang.org/doc/man/inet.html"><TT>http://www.erlang.org/doc/man/inet.html</TT></A> for the list of all errors.
</DD><DT CLASS="dt-description"><B>error_unknown_data</B></DT><DD CLASS="dd-description"> Data received from the server during a
thinktime (not for unparsed protocol like XMPP). The session is
aborted.
</DD><DT CLASS="dt-description"><B>error_unknown_msg</B></DT><DD CLASS="dd-description"> Unknown message received (see the log
files for more information). The session is aborted.
</DD><DT CLASS="dt-description"><B>error_unknown</B></DT><DD CLASS="dd-description"> Abnormal termination of a session, see
log file for more information.
</DD><DT CLASS="dt-description"><B>error_repeat_&lt;REPEATNAME&gt;</B></DT><DD CLASS="dd-description"> Error in a repeat loop (undefined
dynamic variable usually).
</DD><DT CLASS="dt-description"><B>error_send_&lt;ERRORNAME&gt;</B></DT><DD CLASS="dd-description"> Error while sending data to the
server, see <A HREF="http://www.erlang.org/doc/man/inet.html"><TT>http://www.erlang.org/doc/man/inet.html</TT></A> for the list of all errors.
</DD><DT CLASS="dt-description"><B>error_send</B></DT><DD CLASS="dd-description"> Unexpected error while sending data to the server,
see the logfiles for more information.
</DD><DT CLASS="dt-description"><B>error_connect_&lt;ERRORNAME&gt;</B></DT><DD CLASS="dd-description"> Error while establishing a
connection to the server. See <A HREF="http://www.erlang.org/doc/man/inet.html"><TT>http://www.erlang.org/doc/man/inet.html</TT></A> for the list of all errors.
</DD><DT CLASS="dt-description"><B>error_no_online jabber</B></DT><DD CLASS="dd-description"> XMPP: No online user available (usually for a
chat message destinated to a online user)
</DD><DT CLASS="dt-description"><B>error_no_offline jabber</B></DT><DD CLASS="dd-description"> XMPP: No offline user available (usually for a
chat message destinated to a offline user)
</DD><DT CLASS="dt-description"><B>error_no_free_userid</B></DT><DD CLASS="dd-description"> For XMPP: all users Id are already used
(<TT>userid_max</TT> is too low ?)
</DD><DT CLASS="dt-description"><B>error_next_session</B></DT><DD CLASS="dd-description"> A clients fails to gets its session
parameter from the config_server; the controller may be overloaded ?
</DD><DT CLASS="dt-description"><B>error_mysql_&lt;ERRNO&gt;</B></DT><DD CLASS="dd-description"> Error reported by the mysql server (see <A HREF="http://dev.mysql.com/doc/refman/5.0/en/error-messages-server.html"><TT>http://dev.mysql.com/doc/refman/5.0/en/error-messages-server.html</TT></A>)
</DD><DT CLASS="dt-description"><B>error_mysql_badpacket</B></DT><DD CLASS="dd-description"> Bad packet received for mysql server while parsing data.
</DD><DT CLASS="dt-description"><B>error_pgsql</B></DT><DD CLASS="dd-description"> Error reported by the postgresql server.
</DD></DL><!--TOC section CHANGELOG-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc95">C</A>  CHANGELOG</H2><!--SEC END --><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0><TR><TD><TABLE BORDER=0 CELLPADDING=0
CELLSPACING=0><TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
<TR><TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0><TR><TD><PRE CLASS="verbatim"><I>1.4.1 -&gt; 1.4.2 Minor enhancements and bugfixes (4 Jan 2012)
Bugfix:
   * [TSUN-199] - computation of NUsers is wrong
   * [TSUN-206] - build failure with erlang R15B
Improvements:
   * [TSUN-202] - IPv6 support
   * [TSUN-203] - snmp oids should be customizable in the config file
   * [TSUN-205] - handle dyn_variables as array in test conditions (if/until/while)
New Features:
   * [TSUN-191] - allow outputting log to stdout
   * [TSUN-192] - structured log output (JSON)
   * [TSUN-193] - accept configuration from stdin
   * [TSUN-197] - Have bug and error message on stderr and not stdout.
1.4.0 -&gt; 1.4.1 Minor bugfixes (13 Sep 2011)
Bugfix:
   * [TSUN-188] - munin plugin is not working in 1.4.0
   * [TSUN-189] - the controller VM is not used in some case
   * [TSUN-190] - pgsql recorder can record a connect request in an already connected session
1.3.3 -&gt; 1.4.0 Major enhancements and bugfixes (5 Sep 2011)
Bugfix:
   * [TSUN-129] - regexp (defined in match or dynvars) can fail when chunk encoding is used.
   * [TSUN-150] - Munin monitoring broken by cpu stats config request
   * [TSUN-163] - Tsung doesn't detect subdomains.
   * [TSUN-166] - snmp monitoring does not work with erlang R14A
   * [TSUN-171] - maxnumber set in a phase is not always enforced
   * [TSUN-172] - auth sasl can't authenticate against ejabberd
   * [TSUN-178] - some characters can make url and headers rewriting fail in the recorder
   * [TSUN-179] - tsung generated message stanzas are not XMPP compliant
   * [TSUN-180] - file server crash if a dynamic substitution use it
   * [TSUN-182] - When many clients are configured with few static users, none of them are launched.
   * [TSUN-183] - tsung can stop too soon in some cases
   * [TSUN-184] - 'random_number' with start and end actually returns a number from start+1 to end
   * [TSUN-187] - Client IP scan is very slow on Linux; also uses obsolete "ifconfig"
Improvements:
   * [TSUN-54] - tsung is very slow when a lot of dynamic variables are set
   * [TSUN-96] - generating more than 64k connections from a single machine
   * [TSUN-106] - Add content-encoding support for dynvar extraction
   * [TSUN-123] - add option to read usernames from an external file for jabber
   * [TSUN-125] - use the new re module everywhere instead of regexp/gregexp
   * [TSUN-152] - Add "state_rcv" record as parameter to "get_message" function.
   * [TSUN-153] - dynvar used in match may contain regexp special characters
   * [TSUN-185] - handle postgresql extended protocol
New Features:
   * [TSUN-162] - add foreach tag (loop when a dyn_variable is a list)
   * [TSUN-164] - add a switch to allow light queries/replies logging
   * [TSUN-165] - add a way to synchronize users for all plugins.
   * [TSUN-167] - add do=dump option to matching
   * [TSUN-168] - thinktimes value could be dynamically generated with dyn_variable
   * [TSUN-181] - add option to simulate slow connections
1.3.2 -&gt; 1.3.3 Minor bugfixes (17 Aug 2010)
Bugfix:
    * [TSUN-154] - parent proxy doesn't work anymore in 1.3.x (tested with 1.3.2 and 1.3.0).
    * [TSUN-155] - url substitution is broken in some cases
    * [TSUN-156] - Tsung not using sessions with low probabilities
    * [TSUN-157] - ssl doesn't work with erlang R14A
    * [TSUN-158] - failure when a proxy is used and an URL substitution is set
    * [TSUN-159] - HTTP cookies support is broken when a proxy is used
    * [TSUN-160] - tsung can sometimes hang at the beginning using distributed setup
    * [TSUN-161] - if statement not allowed in a transaction
1.3.1 -&gt; 1.3.2 Major bugfixes and enhancements (14 Jun 2010)
Bugfix:
    * [TSUN-128] - Apostrophes cause string to convert to deep list in setdynvars with Erlang function.
    * [TSUN-130] - static users starting time is wrong
    * [TSUN-131] - tsung can stop too early when static users are used
    * [TSUN-132] - http cookies: accept domains equals to hostname with a leading "."
    * [TSUN-133] - proxy-recorder with SSL fails on large client packets (multiple TCP packets)
    * [TSUN-138] - when an error occured( for ex a timeout during a request) and a client exits, started transactions are not updated
    * [TSUN-140] - tsung does not honor the Proxy-Connection: keep-Alive or Connection: keep-Alive header if the proxy is HTTP/1.0
    * [TSUN-142] - http recorder can fail with https rewriting and chunked encoding
    * [TSUN-147] - UDP &amp; bidi does not seem to work
    * [TSUN-148] - dynvar not found when used in match
    * [TSUN-149] - tsung doesn't work with Amazon Elastic load balancing
    * [TSUN-151] - tsung_stats.pl produces invalid *.gplot files
Improvements:
    * [TSUN-82]  - XMPP vhost support
    * [TSUN-127] - add ability tu use floats for thinktimes
    * [TSUN-139] - option to set random seed for launchers.
    * [TSUN-141] - add dynamic variable support for postgres
    * [TSUN-146] - New tsplot yfactor configuration support breaks most common configurations
New Features:
    * [TSUN-135] - add support for SASL ANONYMOUS and PLAIN authentication for XMPP
    * [TSUN-136] - add new plugin distributed testing of filesystem (nfs for ex), using a generic mode for executing erlang functions on clients nodes
    * [TSUN-137] - add a way to mix requests types inside a single session
    * [TSUN-143] - global time limit for the load test
    * [TSUN-145] - tsung should support json parsing for dynamic variable
1.3.0 -&gt; 1.3.1 Major bugfixes and enhancements (9 Sep 2009)
Bugfix:
    * [TSUN-92] - the computation of the minimum for sample_counter is wrong
    * [TSUN-93] - maxnumber not respected if several clients are used
    * [TSUN-102] - dyn_variable configuration fails if variable name is not a valid erlang atom
    * [TSUN-103] - Network error handling in munin plugin
    * [TSUN-104] - tsung-plotter can't handle the os_mon statistics
    * [TSUN-108] - Cannot handle complicated dyn_var name
    * [TSUN-109] - Tsung status displays always phase one even if you have more than one phase
    * [TSUN-110] - Cookie header not present if the URL is dynamically generated by a previous redirection (302)
    * [TSUN-117] - Bug in HTTP: empty header can be generated in some case
    * [TSUN-118] - HTTPS proxy recorder: ts_utils:to_https incorrectly handles Content-Length for POST requests
    * [TSUN-119] - tsung can crash when reading empty values from a csv file
    * [TSUN-122] - same http cookie key with different domains don't work
Improvements:
    * [TSUN-47] - ts_mon can be a bottleneck during very high load testing
    * [TSUN-77] - Structural requests or goto-like action for match in HTTP
    * [TSUN-81] - Dynamic variables API
    * [TSUN-83] - file_server using fixed tuple instead of list
    * [TSUN-85] - external entity should be copied into the log directory of a run.
    * [TSUN-87] - add dynamic code evaluation in set_dynvars
    * [TSUN-88] - add mkactivity method support in webdav
    * [TSUN-91] - reduce memory consumption by hibernating client process while in think state
    * [TSUN-97] - disable smp erlang for client beam for performance reason
    * [TSUN-98] - try several times to connect to the server before aborting a session
    * [TSUN-99] - make substitution work in &lt;match&gt;
    * [TSUN-100] - improve scalability of ts_launcher
    * [TSUN-105] - Add load average statistic to server monitoring
    * [TSUN-111] - add option to manually add a cookie in http requests
    * [TSUN-113] - split tsung command into two separate tsung and tsung-recorder commands
    * [TSUN-116] - add ability to run several tsung running in parallel on the same hosts
    * [TSUN-120] - Https recorder: Remove "Secure" from "Set-Cookie" header.
New Features:
    * [TSUN-25] - add a way to start sessions in a specific order at specified times
    * [TSUN-89] - include tsung-plotter into the tsung distribution
    * [TSUN-90] - add support for monitoring server cpu/mem using munin-node
    * [TSUN-94] - add log action for match
    * [TSUN-95] - add a default dyn_variable with a unique tsung_userid
    * [TSUN-107] - add MUC support to the jabber doc/plugin
    * [TSUN-114] - add option to apply function to data before looking for a match
    * [TSUN-115] - add pubsub support to the jabber plugin

1.2.2 -&gt; 1.3.0 Major bugfixes and enhancements (03 Sep 2008)
Bugfix:
    * [TSUN-30] - SNMP monitoring gives an error
    * [TSUN-57] - using -l with a relative path make distributed load fails with timeout error
    * [TSUN-60] - https recorder broken if an HTML document includes absolute urls
    * [TSUN-67] - Typo breaks recording of if-modified-since headers
    * [TSUN-68] - some sites doesn't work with ":443" added in the "Host" header with https
    * [TSUN-71] - Tsung does not work with R12B (httpd_util funs removed)
    * [TSUN-73] - Wrong parsing HTTP multipart/form-data in http request - POST form doesn't work
    * [TSUN-75] - can not define more -pa arguments
    * [TSUN-84] - dyn variables that don't match should be set to an empty string
Improvements:
    * [TSUN-40] - problem to rewrite url for https with gzip-encoded html.
    * [TSUN-48] - tcp/udp buffer size should be customizable in the XML config file.
    * [TSUN-59] - if a User-Agent header is set in &lt;header&gt;, it should override the global one.
    * [TSUN-62] - add abilty to loop back to a previous request in a session
    * [TSUN-63] - check for ssl and crypto application at compile time
    * [TSUN-65] - enhance dynamic variables.
    * [TSUN-66] - add global mean and counter computation and reporting for samples
    * [TSUN-69] - add option to read content of a POST request from an external file
    * [TSUN-79] - setting 'Host' header with http_header doesn't work as expected
New Features:
    * [TSUN-56] - ldap plugin
    * [TSUN-58] - add a new statistics backend to dump all stats in a file
    * [TSUN-61] - add a Webdav plugin
    * [TSUN-64] - add md5 authentication in the pgsql plugin
    * [TSUN-72] - Add support for defining dyn_variables using XPath
    * [TSUN-78] - mysql plugin
    * [TSUN-80] - add random thinktime with in a given range ( [min,max])
Tasks:
    * [TSUN-76] - add explanation for errors name in the documentation

1.2.1 -&gt; 1.2.2 Minor bugfixes and enhancements (23 Feb 2008)
Bugfix:
    * [TSUN-30] - SNMP monitoring gives an error
    * [TSUN-31] - dyn_variable usage
    * [TSUN-35] - udp is not working
    * [TSUN-36] - default regexp for dyn_variable doesn't work in all case
    * [TSUN-38] - server monitoring crash if an ethernet interface's name is more than 6 chars long
    * [TSUN-39] - https recording doesn't work with most browsers
    * [TSUN-43] - session should not terminate if rosterjid is not defined
    * [TSUN-49] - &lt;match&gt; doesn't work with jabber plugin
    * [TSUN-51] - tsung does not work with R12B (httpd_util funs removed)
    * [TSUN-53] - postgresql errors not reported in all cases
    * [TSUN-55] - no error counter when userid_max is reached
Improvements:
    * [TSUN-14] - no_ack messages and asynchronous msg sent by the server are not available in the reports
    * [TSUN-27] - handle bidirectional protocols
    * [TSUN-28] - Refactoring needed to ease the change of the userid / password generation code
    * [TSUN-29] - Multiple file_server support
    * [TSUN-32] - make snmp server options tunable
    * [TSUN-34] - add costum http headers
    * [TSUN-44] - tsung should ignore whitespace keepalive from xmpp server
    * [TSUN-45] - add kernel-poll support for better performance
    * [TSUN-46] - add number of open connections in statistics
    * [TSUN-47] - ts_mon can be a bottleneck during very high load testing
    * [TSUN-50] - use the whole range of Id (from 0 to userid_max) before reusing already used Ids
New Features:
    * [TSUN-26] - Ability to loop on a given sequence of phase
    * [TSUN-52] - Adding comment during script capture
    * [TSUN-41] - add support for parent proxy for http only (not https)

1.2.0 -&gt; 1.2.1 Minor bugfixes and enhancements (07 Oct 2006)
    Bugfix:
    - [TSUN-5]  get traffic from all interfaces instead of only eth0
      in erlang os monitoring (Linux)
    - [TSUN-18 the pgsql recorder fails if the client doesn't try
      first an SSL connection
    - [TSUN-19] a % character in some requests (eg. type=sql for
      pgsql) make the config_server crash.
    - [TSUN-20] pgsql client fails while parsing data from server
    - [TSUN-21] substitution in URL is not working properly when a new server
      or port is set
    - [TSUN-23] set default http version (1.1)
    - [TSUN-24] destination=previous doesn't work (jabber)
    Improvement:
    - [TSUN-15] listen port is now customizable with the command line
    - [TSUN-17] add option to setup postgresql server IP and port at runtime
      for the recorder
    - [TSUN-22] add support for PUT, DELETE and HEAD methods for http

1.1.0 -&gt; 1.2.0 Major feature enhancements (29 May 2006)
    - change name: idx-tsunami is now called tsung
    - add new plugin: pgsql for postgresql load testing
    - new: it's now possible to set multiple servers (selected at runtime
      by round robin)
    - add size_rcv stats
    - fix beams communication problem introduced in new erlang releases.
    - import snmp_mgr src from R9C2 to enable SNMP with R10B
    - rebuild boot scripts if erlang version is different from compile time
    - many DTD improvements
    - improved match: add loop|abort|restart on (no)match behavior,
      multiple match tags is now possible (suggested by msmith@truelink.com)
    - freemem and packet stats for Solaris (jasonwtucker@gmail.com)
    - fix several small problems with 'use_controller_vm' option
    - ip is no more mandatory (default is 0.0.0.0)
    - clients and monitoring can use hosts list defined in environment
      variables, for use with batch schedulers (openpbs/torque, LSF and OAR)
    - performance improvements in stats engine for very high load
      (use session_cache)
    Recorder:
    - add plugin architecture in recorder; add pgsql plugin
    - fix regression in recorder for WWW-Authentication
      (anders.nygren@gmail.com)
    - close client socket when connection:closed is ask by the server
      (this should enable https recording with IE)
    Jabber:
    - fix presence:roster request
    - add presence:directed , presence:broadcast &amp; presence:final requests
      for jabber (jasonwtucker@gmail.com)
    - roster enhancements (jasonwtucker@gmail.com)
    - sip-digest authentication (jasonwtucker@gmail.com)
    - fix online: must use presence:initial to switch to online status
    - add pubsub support (mickael.remond@process-one.net)
    Http:
    - fix single user agent case.
    - minor fixes for HTTP parsing

1.0.3 -&gt; 1.1.0 Major feature enhancements (5 Sep 2005)
    - new feature: HTTP proxy load testing in now possible (set
      http_use_server_as_proxy to true)
    - add dynamic substitution support for jabber
    - add 'raw' type of msg for Jabber (use the new 'data' attribute)
    - add the dynamic variable list to dynamic substitutions
    - UserAgent is now customizable for HTTP testing
    - Add an option to run all components (controller and launcher)
      within a single erlang beam (use_controller_vm). Should ease
      idx-tsunami use for light load tests
    - fix bash script for solaris (jasonwtucker@gmail.com)
    - fix: several 'idx-tsunami status' can be run simultaneously
      (reported by Adam Spotton)
    - internal: Host header is now set during configuration phase
    - fix last phase duration
    - fix recorder: must log absolute url if only the scheme has changed

1.0.2 -&gt; 1.0.3 Minor bugfixes (8 Jul 2005)
    - add ts_file_server module
    - fix broken https recording
    Thx to johann.messner@jku.at for bug reporting :
    - fix: forgot to add "?" when an URL is absolute and had a query
      part
    - fix regression in the recorder (introduced in 1.0.2): must use CAPS
      for method, wrong content-length in recorder causing POST requests
      to silently fail
    - allow multiple 'dyn_variable' in DTD
    - fix Host: header when port is != 80

1.0.1 -&gt; 1.0.2: Minor bugfixes  (6 Jun 2005)
    - fix: the recorder is working now with R10B: replace call to
      httpd_parse:request_header in recorder by an
      internal func (the func was removed in R10B)
    - update configure scripts (should build on RHEL3/x86_64)
    - remote beam startup is now tunable (-r ssh/rsh)
    - internal changes in ts_os_mon (suggested by R. Lenglet)

1.0 -&gt; 1.0.1: Major bugfixes (18 Nov 2004)
    - fix: broken free mem on non linux arch (Matthew Schulkind)
    - add script to convert apache log file (combined) to idx-tsunami XML
    - improved configure: add --with-erlang option and xmerl PATH detection
       idx-tsunami now compiles both with R9C and R10B
    - small fixes to the DTD
    Thx to Jonathan Bresler for testing and bug reporting :
    - fix: broken 'global', 'local' and 'no_ack' requests and size computation
    - fix: broken ids in jabber messages
    - fix: broken online/offline in user_server
    - default thinktime can now be overriden
    - many improvements/fixes in analyse_msg.pl

1.0.beta7 -&gt; 1.0:  Minor bugfixes (13 Aug 2004)
    - fix: broken path when building debian package
    - add rpm target in makefile
    - implement status
    - add 'match' in graph and doc
    - fix add_dynparams for jabber

1.0.beta6 -&gt; 1.0.beta7:  Minor bugfixes (20 Jul 2004)
    - HTTP: really (?) fix parsing of no content-length with connection:close
    - better handling of configure (--prefix is working)
    - add different types of output backend (currently, only 'text'
      works; 'rrdtool' is started but unfinished)
    - fix: ssl_ciphers option is working again

1.0.beta5 -&gt; 1.0.beta6:  Minor feature enhancements (5 May 2004)
    - add a DTD for the configuration file
    - add dynamic request substitution (mickael.remond@erlang-fr)
    - add dynamic variable parsing from response (can be used
      later in the session for request substitution)
    - add response pattern to match (log if not match)
    - HTTP: fix partial header parsing (mickael.remond@erlang-fr.org)
    - HTTP: fix chunk parsing when the chunk-size is split across two packets
    - HTTP: fix parsing of no content-length with connection:close case
    - check for bad input (config file, &lt;client&gt; name)
    - merge client and client_rcv processes into a single process
    - fix: do not connect in init anymore; this fix too long phases when
      connection time is high.
    - connect stat is now for both new connections and reconnections
    - check phase duration in launcher
    - various code cleanup

1.0.beta4 -&gt; 1.0.beta5:  Major Feature enhancements (25 Mar 2004)
    - add SNMP monitoring (not yet customizable)
    - fix remote start: log filename is now encoded to avoid bad
      parsing of log_file by 'erl'
    Patches from mickael.remond@erlang-fr.org :
    - Added ~/.idx-tsunami creation in idx-tsunami script if the directory
      does not already exist
    - Extension of XML attribute entity normalisation
    - HTTP: fix Cookie support: Cookie are not necessarily separated by "; "
    - HTTP: fix long POST request in the recorder: dorecord message
      was missing enclosing curly brackets, and the body length counter
      were mistakenly taking the header size in its total
    - HTTP: Content-type support in the recorder (needed to handle
     non-HTML form encoded posts)
    - add autoconf support to detect Erlang installation path
    - SOAP Support: IDX-Tsunami can now record and replay SOAP HTTP
      scenario. The SOAPAction HTTP header is now recorded
    - Preliminary Windows support: A workaround has been introduced in
      the code to handle behaviour difference between Erlang Un*x and
      Erlang Windows on how the command-line is handled. When an
      assumtion is made on the string type of a parameter, it should be
      check that this is actually a string and not an atom.

1.0.beta3 -&gt; 1.0.beta4:  Minor bugfixes (16 Mar 2004)
    - fix lost cookie when transfer-encoding:chunked is used
    - fix config parsing (the last request of the last page of a
      sesssion was not marked as endpage)
    - don't crash anymore on error during start or stop

1.0.beta2 -&gt; 1.0.beta3:  Minor feature enhancements (24 Feb 2004)
    - fix stupid bug in start script for recorder
    - HTTP: fix '&amp;' writes in the XML recorder for 'content' attribute
    - HTTP: enhanced Cookies parsing ('domain' and 'path' implemented).
    - ssl_ciphers can be customized
    - change log directory structure: all log files in one directory per test
    - add HTML reports  (requires the perl Template toolkit)
    - change stats names:  page_resptime -&gt; page, response_time -&gt; request

1.0.beta1 -&gt; 1.0.beta2:  Minor feature enhancements (11 Feb 2004)
    - reorganise the sources
    - add tools to build a debian package
    - fix documentations
    - add minimalistic man page
    - syntax change: GETIMS +date replace by GET +'if_modified_since'

0.2.1 -&gt; 1.0.beta1:  Major Feature Enhancements (3 Feb 2004)
    - rewrite the configuration engine. Now use an XML file.
    - add recording application: use as a HTTP proxy to record session into XML
      format
    - add support to OS monitoring (cpu, memory, network). Currently, use an
      erlang agent on the remote nodes; SNMP is on the TODO list.
      (mickael.remond@erlang-fr.org)
    - can now use several IPs per client host
    - several arrival phases can be set with different arrival rates and
      duration
    - can set test duration instead of number of users
    - add user defined statistics using a 'transaction' tag
    - HTTP: fix cookies and POST handling (mickael.remond@erlang-fr.org)
    - HTTP: rewrite the parser (faster and cleaner)
    - fix bad timeout computation when close occur for persistent client
    - bugfixes and other enhancements.
    - fix memory leak with ssl (half-closed connections)

0.2.0 -&gt; 0.2.1:  Minor bugfixes and small enhancements (9 Dec 2003)
    - optimize session memory consumption: use an ets table to store session setup
    - HTTP: fix crash when content-length is not set in headers
    - HTTP: fix POST method
    - HTTP: preliminary chunked-encoding support in HTTP/1.1
    - HTTP: Absolute URL are handled (server and port can be overridden )
    - no more .hosts.erlang required
    - add stats on simultaneous users

0.1.1 -&gt; 0.2.0:  Major Feature Enhancements (Aug 2003)
    - add 'realtime' stats
    - add new 'parse' type of protocol
    - add reconnection support (persistent client)
    - add basic HTTP and HTTPS support
    - split the application in two parts: a single controller (tsunami_controller),
      and the clients (tsunami)
    - switch to R9C

0.1.0 -&gt; 0.1.1:  Bugfix realease (Aug 2002)
      - fix config file
    - fix few typos in docs
    - fix init script
    - few optimizations in user_server.erl
    - switch to R8B

0.1.0: Initial release (May 2001)
</I></PRE></TD></TR>
</TABLE></TD></TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0><TR><TD>
</TD></TR>
</TABLE></TD></TR>
</TABLE></TD></TR>
</TABLE><!--BEGIN NOTES document-->
<HR CLASS="footnoterule"><DL CLASS="thefootnotes"><DT CLASS="dt-thefootnotes">
<A NAME="note1" HREF="#text1">1</A></DT><DD CLASS="dd-thefootnotes"><A HREF="http://www.erlang-projects.org/Members/mremond/events/dossier_de_presentat/block_10766817551485/file"><TT>http://www.erlang-projects.org/Members/mremond/events/dossier_de_presentat/block_10766817551485/file</TT></A>
</DD><DT CLASS="dt-thefootnotes"><A NAME="note2" HREF="#text2">2</A></DT><DD CLASS="dd-thefootnotes"><A HREF="http://www.editions-eyrolles.com/php.accueil/Ouvrages/ouvrage.php3?ouv_ean13=9782212110791"><TT>http://www.editions-eyrolles.com/php.accueil/Ouvrages/ouvrage.php3?ouv_ean13=9782212110791</TT></A>
</DD><DT CLASS="dt-thefootnotes"><A NAME="note3" HREF="#text3">3</A></DT><DD CLASS="dd-thefootnotes"><A HREF="http://www.sics.se/~joe/thesis/armstrong_thesis_2003.pdf"><TT>http://www.sics.se/~joe/thesis/armstrong_thesis_2003.pdf</TT></A>
</DD><DT CLASS="dt-thefootnotes"><A NAME="note4" HREF="#text4">4</A></DT><DD CLASS="dd-thefootnotes"><A HREF="mailto:mickael.remond@erlang-fr.org">mickael.remond@erlang-fr.org</A>
</DD></DL>
<!--END NOTES-->
<!--CUT END -->
<!--HTMLFOOT-->


<DIV class="piedpage">
<HR>
<P>  Copyright 2004-2009 &copy; Nicolas Niclausse
</DIV>

<!--ENDHTML-->
<!--FOOTER-->
<HR SIZE=2><BLOCKQUOTE CLASS="quote"><EM>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</EM><A HREF="http://hevea.inria.fr/index.html"><EM>H</EM><EM><FONT SIZE=2><sup>E</sup></FONT></EM><EM>V</EM><EM><FONT SIZE=2><sup>E</sup></FONT></EM><EM>A</EM></A><EM>.</EM></BLOCKQUOTE></BODY>
</HTML>
