


<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>

<HEAD>

<TITLE>Tsung User's manual</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<META name="GENERATOR" content="hevea 1.08">
<STYLE type="text/css">
.toc{list-style:none;}
.title{margin:auto;text-align:center}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
DIV TABLE{margin-left:inherit;margin-right:inherit;}
PRE{text-align:left;margin-left:0ex;margin-right:auto;}
BLOCKQUOTE{margin-left:4ex;margin-right:4ex;text-align:left;}
.part{margin:auto;text-align:center}
</STYLE>

<style type="text/css">
<!--
body        {font-size: 90%; margin-right:40px; margin-left:40px; font-family:Sans-Serif; color:#000000; background-color:#ffffff;}
p, .n       {font-size: 90%; font-family:Sans-Serif; color:#000000; background-color:#ffffff;}
h1          {font-size: 200%; color:#800000; background-color:#ffffff;}
h2          {font-size:150%; color:#000080; background-color:#ffffff;}
h3          {font-family:Sans-Serif; font-size: 120%; font-weight:bold; color:#000080; background-color:#ffffff;}
h4          {font-family:Sans-Serif; font-size:100%; font-weight:bold; color:#000080; background-color:#ffffff;}
h5          {font-family:Sans-Serif; font-size:100%; font-weight:bold; color:#000000;  background-color:#ffffff; margin-bottom: 0;}
form        {margin-bottom:-5px;}
textarea    {color:#333333;  background-color:#ffffff; width:90%;}
table       {font-size:90%;}
dl,ul,ol    {margin-top: 2pt; margin-bottom: 2pt;}
tt, pre     {font-family:monospace; color:#666666; background-color:#ffffff;}
pre {
    background-color: #ffffee;
    white-space:pre;
    border-style:solid;
    border-width:thin;
    border-color:#999999;
    color:#333333;
//    padding:3px;
	margin-bottom: -1pt;
    width:100%;
}

a:link      {color:#800000; background-color: #ffffff;}
a:visited   {color:#006600; background-color: #ffffff;}
a:active    {color:green; background-color: #ffffff;}
a:hover     {background:#ffffaa;}

.piedpage, .entete {
    font-family:Sans-Serif; font-size:90%; font-style:italic; color:#0000ff; background-color: #ffffff;
        text-align: center;
}
-->
</style>
</HEAD>

<BODY >
<!--HEVEA command line is: /usr/bin/hevea -fix -I /home/nniclausse/cvs/projetdoc/common//styles -exec xxdate.exe -pedantic TSUNG.hva user_manual.tex -->
<!--HTMLHEAD-->


  <DIV class="entete">
  &nbsp;<A href="http://tsung.erlang-projects.org/">http://tsung.erlang-projects.org/</A>
  </DIV>
  <HR>
<!--ENDHTML-->
<!--PREFIX <ARG ></ARG>-->
<!--CUT DEF section 1 -->



<H1 ALIGN=center>Tsung User's manual</H1>


<DIV CLASS="center">
 
 <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1>
<TR><TD ALIGN=left NOWRAP bgcolor="#F2F2F2">Version:</TD>
<TD ALIGN=left NOWRAP>703</TD>
</TR>
<TR><TD ALIGN=left NOWRAP bgcolor="#F2F2F2">Date :</TD>
<TD ALIGN=left NOWRAP>						19th												December,&nbsp;2006</TD>
</TR></TABLE>
 </DIV>

<BR>
<DIV CLASS="center">
 <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1>
<TR><TD VALIGN=top ALIGN=left><I>Tsung user's manual</I></TD>
</TR></TABLE>
</DIV>

<!--TOC section Contents-->

<H2 CLASS="section">Contents</H2><!--SEC END -->

<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc1">1&nbsp;&nbsp;Introduction</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc2">1.1&nbsp;&nbsp;What is Tsung ?</A>
<LI CLASS="li-toc"><A HREF="#htoc3">1.2&nbsp;&nbsp;What is Erlang and why is it important for Tsung ?</A>
<LI CLASS="li-toc"><A HREF="#htoc4">1.3&nbsp;&nbsp;Tsung background</A>
</UL>
<LI CLASS="li-toc"><A HREF="#htoc5">2&nbsp;&nbsp;Features</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc6">2.1&nbsp;&nbsp;Tsung main features</A>
<LI CLASS="li-toc"><A HREF="#htoc7">2.2&nbsp;&nbsp;HTTP related features</A>
<LI CLASS="li-toc"><A HREF="#htoc8">2.3&nbsp;&nbsp;Jabber related features</A>
<LI CLASS="li-toc"><A HREF="#htoc9">2.4&nbsp;&nbsp;PostgreSQL related features</A>
<LI CLASS="li-toc"><A HREF="#htoc10">2.5&nbsp;&nbsp;Complete reports set</A>
<LI CLASS="li-toc"><A HREF="#htoc11">2.6&nbsp;&nbsp;Highlights</A>
</UL>
<LI CLASS="li-toc"><A HREF="#htoc12">3&nbsp;&nbsp;Installation</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc13">3.1&nbsp;&nbsp;Dependencies</A>
<LI CLASS="li-toc"><A HREF="#htoc14">3.2&nbsp;&nbsp;Compilation</A>
<LI CLASS="li-toc"><A HREF="#htoc15">3.3&nbsp;&nbsp;Configuration</A>
<LI CLASS="li-toc"><A HREF="#htoc16">3.4&nbsp;&nbsp;Feedback</A>
</UL>
<LI CLASS="li-toc"><A HREF="#htoc17">4&nbsp;&nbsp;HTTP benchmark approach</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc18">4.1&nbsp;&nbsp;benchmarking a Web server</A>
<LI CLASS="li-toc"><A HREF="#htoc19">4.2&nbsp;&nbsp;benchmarking a proxy server</A>
</UL>
<LI CLASS="li-toc"><A HREF="#htoc20">5&nbsp;&nbsp;PostgreSQL benchmark approach</A>
<LI CLASS="li-toc"><A HREF="#htoc21">6&nbsp;&nbsp;Jabber benchmark approach</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc22">6.1&nbsp;&nbsp;Acknowledgements of messages</A>
<LI CLASS="li-toc"><A HREF="#htoc23">6.2&nbsp;&nbsp;Status: Offline, Connected and Online</A>
<LI CLASS="li-toc"><A HREF="#htoc24">6.3&nbsp;&nbsp;Authentication</A>
</UL>
<LI CLASS="li-toc"><A HREF="#htoc25">7&nbsp;&nbsp;Using the proxy recorder</A>
<LI CLASS="li-toc"><A HREF="#htoc26">8&nbsp;&nbsp;Understanding tsung.xml configuration file</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc27">8.1&nbsp;&nbsp;File structure</A>
<LI CLASS="li-toc"><A HREF="#htoc28">8.2&nbsp;&nbsp;Clients and server</A>
<LI CLASS="li-toc"><A HREF="#htoc29">8.3&nbsp;&nbsp;Monitoring</A>
<LI CLASS="li-toc"><A HREF="#htoc30">8.4&nbsp;&nbsp;Defining the load progression</A>
<LI CLASS="li-toc"><A HREF="#htoc31">8.5&nbsp;&nbsp;Setting options</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc32">8.5.1&nbsp;&nbsp;Jabber options</A>
<LI CLASS="li-toc"><A HREF="#htoc33">8.5.2&nbsp;&nbsp;HTTP options</A>
</UL>
<LI CLASS="li-toc"><A HREF="#htoc34">8.6&nbsp;&nbsp;Sessions</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc35">8.6.1&nbsp;&nbsp;HTTP</A>
<LI CLASS="li-toc"><A HREF="#htoc36">8.6.2&nbsp;&nbsp;Jabber</A>
<LI CLASS="li-toc"><A HREF="#htoc37">8.6.3&nbsp;&nbsp;PostgreSQL</A>
<LI CLASS="li-toc"><A HREF="#htoc38">8.6.4&nbsp;&nbsp;Dynamic substitutions</A>
<LI CLASS="li-toc"><A HREF="#htoc39">8.6.5&nbsp;&nbsp;Reading external file</A>
<LI CLASS="li-toc"><A HREF="#htoc40">8.6.6&nbsp;&nbsp;Dynamic variables</A>
<LI CLASS="li-toc"><A HREF="#htoc41">8.6.7&nbsp;&nbsp;Checking the server's response</A>
</UL>
</UL>
<LI CLASS="li-toc"><A HREF="#htoc42">9&nbsp;&nbsp;Statistics and reports</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc43">9.1&nbsp;&nbsp;Available stats</A>
<LI CLASS="li-toc"><A HREF="#htoc44">9.2&nbsp;&nbsp;Design</A>
<LI CLASS="li-toc"><A HREF="#htoc45">9.3&nbsp;&nbsp;Generating the report</A>
<LI CLASS="li-toc"><A HREF="#htoc46">9.4&nbsp;&nbsp;tsung summary</A>
<LI CLASS="li-toc"><A HREF="#htoc47">9.5&nbsp;&nbsp;Graphical overview</A>
</UL>
<LI CLASS="li-toc"><A HREF="#htoc48">10&nbsp;&nbsp;References</A>
<LI CLASS="li-toc"><A HREF="#htoc49">11&nbsp;&nbsp;Acknowledgments</A>
<LI CLASS="li-toc"><A HREF="#htoc50">A&nbsp;&nbsp;Frequently Asked Questions</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc51">A.1&nbsp;&nbsp;Tsung crashes when I start it </A>
<LI CLASS="li-toc"><A HREF="#htoc52">A.2&nbsp;&nbsp;Tsung still doesn't start ...</A>
<LI CLASS="li-toc"><A HREF="#htoc53">A.3&nbsp;&nbsp;Tsung still crashes/fails when I start it !</A>
<LI CLASS="li-toc"><A HREF="#htoc54">A.4&nbsp;&nbsp;What is the format of the stats file tsung.log ?</A>
<LI CLASS="li-toc"><A HREF="#htoc55">A.5&nbsp;&nbsp;How can I specify the number of concurrent users ?</A>
<LI CLASS="li-toc"><A HREF="#htoc56">A.6&nbsp;&nbsp;SNMP monitoring doesn't work ?!</A>
</UL>
</UL>

<!--TOC section Introduction-->

<H2 CLASS="section"><A NAME="htoc1">1</A>&nbsp;&nbsp;Introduction</H2><!--SEC END -->

<!--TOC subsection What is Tsung ?-->

<H3 CLASS="subsection"><A NAME="htoc2">1.1</A>&nbsp;&nbsp;What is Tsung ?</H3><!--SEC END -->

<EM>Tsung</EM> (formerly IDX-Tsunami) is a distributed load testing tool. It is
protocol-independent and can currently be used to stress HTTP, SOAP
PostgreSQL, and Jabber servers.<BR>
<BR>
It is distributed under the GNU General Public License version 2.<BR>
<BR>
<!--TOC subsection What is Erlang and why is it important for Tsung ?-->

<H3 CLASS="subsection"><A NAME="htoc3">1.2</A>&nbsp;&nbsp;What is Erlang and why is it important for Tsung ?</H3><!--SEC END -->

<EM>Tsung's</EM> main strength is its ability to simulate a huge number of
simultaneous user from a single CPU. When used on cluster you can
generate a really impressive load on a server with a modest cluster,
easy to set-up and to maintain.<BR>
<BR>
<EM>Tsung</EM> is developed in Erlang and this is where the power
of <EM>Tsung</EM> resides.<BR>
<BR>
Erlang is a <EM>concurrency-oriented</EM> programming language.
Tsung is based on the Erlang OTP (Open Transaction Platform) and
inherits several characteristics from Erlang: 
<UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Performance</EM>: Erlang has been made to support hundred thousands
of lightweight processes in a single virtual machine. 
<LI CLASS="li-itemize"><EM>Scalability</EM>: Erlang runtime environment is naturally
distributed, promoting the idea of process's location transparency. 
<LI CLASS="li-itemize"><EM>Fault-tolerance</EM>:Erlang has been built to develop robust,
fault-tolerant systems. As such, wrong answer sent from the server
to <EM>Tsung</EM> does not make the whole running benchmark crash. 
</UL>
More informations on Erlang on <A HREF="http://www.erlang.org"><TT>http://www.erlang.org</TT></A> and
<A HREF="http://www.erlang-projects.org/"><TT>http://www.erlang-projects.org/</TT></A><BR>
<BR>
<!--TOC subsection Tsung background-->

<H3 CLASS="subsection"><A NAME="htoc4">1.3</A>&nbsp;&nbsp;Tsung background</H3><!--SEC END -->

History:
<UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Tsung</EM> development was started by Nicolas Niclausse in
 2001 as a distributed jabber load stress tool for internal use at
 <A HREF="http://IDEALX.com/"><TT>http://IDEALX.com/</TT></A>. It has evolved as an open-source
 multi-protocol load testing tool several months later. The HTTP
 support was added in 2003, and this tool has been used for several
 industrial projects. It is now hosted by Erlang-projects, and
 supported by <A HREF="http://process-one.net/"><TT>http://process-one.net/</TT></A>. The list of contributors
 is available in the source archive
 (<A HREF="https://svn.process-one.net/tsung/trunk/CONTRIBUTORS"><TT>https://svn.process-one.net/tsung/trunk/CONTRIBUTORS</TT></A>).<BR>
<BR>
<LI CLASS="li-itemize">It is an industrial strength implementation of a <EM>stochastic model</EM>
for real users simulation. User events distribution is based on a
Poisson Process. More information on this topic in:<BR>
<BR>
Z. Liu, N. Niclausse, et C. Jalpa-Villanueva. <B>Traffic Model
 and Performance Evaluation of Web Servers</B>. <EM>Performance Evaluation,
Volume 46, Issue 2-3, October 2001</EM>.<BR>
<BR>
<LI CLASS="li-itemize">This model has already been tested in the INRIA <EM>WAGON</EM>
 research prototype (Web trAffic GeneratOr and beNchmark). WAGON was
 used in the <A HREF="http://www.vthd.org/"><TT>http://www.vthd.org/</TT></A> project (Very High Broadband
 IP/WDM test platform for new generation Internet applications, 2000-2004).</UL>
<EM>Tsung</EM> has been used for very high load tests:
<UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Jabber</EM> protocol: 
 <UL CLASS="itemize"><LI CLASS="li-itemize">
 90 000 simultaneous jabber users on a
 4-node tsung cluster (3xSun V240 + 1 Sun V440)
<LI CLASS="li-itemize">10 000 simultaneous users.
 <EM>Tsung</EM> was running on a 3-computers cluster (CPU
 800Mhz)
 </UL>
<LI CLASS="li-itemize"><EM>HTTP and HTTPS</EM> protocol:
 <UL CLASS="itemize"><LI CLASS="li-itemize">
 12 000 simultaneous users.
 <EM>Tsung</EM> were running on a 4-computers cluster. The
 tested platform reached 3 000 requests per second.
 </UL>
</UL>
<EM>Tsung</EM> has been used at: 
<UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>DGI</EM> (Direction Générale des impôts): French finance ministry 
<LI CLASS="li-itemize"><EM>Cap Gemini Ernst &amp; Young</EM>
<LI CLASS="li-itemize"><EM>IFP</EM> (Institut Français du Pétrole): French Research Organization
for Petroleum 
<LI CLASS="li-itemize"><EM>LibertySurf</EM>
</UL>
<!--TOC section Features-->

<H2 CLASS="section"><A NAME="htoc5">2</A>&nbsp;&nbsp;Features</H2><!--SEC END -->

<!--TOC subsection Tsung main features-->

<H3 CLASS="subsection"><A NAME="htoc6">2.1</A>&nbsp;&nbsp;Tsung main features</H3><!--SEC END -->

<UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>High Performance</EM>: <EM>Tsung</EM> can simulate a
 huge number of simultaneous users per physical computer: It can
 simulates thousands of users on a single CPU (Note: a simulated user
 is not always active: it can be idle during a <TT>thinktime</TT>
 period). Traditional injection tools can hardly go further than a
 few hundreds (Hint: if all you want to do is requesting a single URL
 in a loop, use <EM>ab</EM>; but if you want to build complex
 scenarios with extended reports, <EM>Tsung</EM> is for you).
<LI CLASS="li-itemize"><EM>Distributed</EM>: the load can be distributed on a cluster of
client machines 
<LI CLASS="li-itemize"><EM>Multi-Protocols</EM> using a plug-in system: HTTP (both standard
web traffic and SOAP), Jabber and Postgresql are currently supported. LDAP and
SMTP are on the TODO list. 
<LI CLASS="li-itemize"><EM>SSL</EM> support 
<LI CLASS="li-itemize"><EM>Several IP addresses</EM> can be used on a single machine using
the underlying OS IP Aliasing 
<LI CLASS="li-itemize"><EM>OS monitoring</EM> (CPU, memory and network traffic) using Erlang
agents on remote servers or <EM>SNMP</EM>
<LI CLASS="li-itemize"><EM>XML configuration system</EM>: complex user's scenarios are written
 in XML. Scenarios can be written with a simple browser using the
 Tsung recorder (HTTP and Postgresql only).
<LI CLASS="li-itemize"><EM>Dynamic scenarios</EM>: You can get dynamic data from the
 server under load (without writing any code) and re-inject it in
 subsequent requests. You can also loop, restart or stop a
 session when a string (or regexp) matches the server response.
<LI CLASS="li-itemize"><EM>Mixed behaviours</EM>: several sessions can be used to simulate
different type of users during the same benchmark. You can define
the proportion of the various behaviours in the benchmark scenario. 
<LI CLASS="li-itemize"><EM>Stochastic processes</EM>: in order to generate a realistic traffic,
user thinktimes and the arrival rate can be randomize using a probability
distribution (currently exponential) 
</UL>
<!--TOC subsection HTTP related features-->

<H3 CLASS="subsection"><A NAME="htoc7">2.2</A>&nbsp;&nbsp;HTTP related features</H3><!--SEC END -->

<UL CLASS="itemize"><LI CLASS="li-itemize">
HTTP/1.0 and HTTP/1.1 support
<LI CLASS="li-itemize">GET, POST, PUT, DELETE and HEAD requests 
<LI CLASS="li-itemize">Cookies: Automatic cookies management 
<LI CLASS="li-itemize"><CODE>'</CODE>GET If-modified since<CODE>'</CODE> type of request 
<LI CLASS="li-itemize">WWW-authentication Basic 
<LI CLASS="li-itemize">Proxy mode to record sessions using a Web browser 
<LI CLASS="li-itemize">SOAP support using the HTTP mode (the SOAPAction HTTP header is
 handled).
<LI CLASS="li-itemize">HTTP server or proxy server load testing.
</UL>
<!--TOC subsection Jabber related features-->

<H3 CLASS="subsection"><A NAME="htoc8">2.3</A>&nbsp;&nbsp;Jabber related features</H3><!--SEC END -->

<UL CLASS="itemize"><LI CLASS="li-itemize">
Authentication (plaintext, digest and sip-digest)
<LI CLASS="li-itemize">presence and register messages 
<LI CLASS="li-itemize">Chat messages to online or offline users 
<LI CLASS="li-itemize">Roster set and get requests 
<LI CLASS="li-itemize">Global users<CODE>'</CODE> synchronization can be set on specific actions
<LI CLASS="li-itemize">raw XML messages
</UL>
<!--TOC subsection PostgreSQL related features-->

<H3 CLASS="subsection"><A NAME="htoc9">2.4</A>&nbsp;&nbsp;PostgreSQL related features</H3><!--SEC END -->

<UL CLASS="itemize"><LI CLASS="li-itemize">
Basic Authentication
<LI CLASS="li-itemize">Basic Queries (Extended queries not yet supported)
<LI CLASS="li-itemize">Proxy mode to record sessions
</UL>
<!--TOC subsection Complete reports set-->

<H3 CLASS="subsection"><A NAME="htoc10">2.5</A>&nbsp;&nbsp;Complete reports set</H3><!--SEC END -->

Measures and statistics produced by Tsung are extremely feature-full.
They are all represented as a graphic. <EM>Tsung</EM> produces
statistics regarding:
<UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Performance</EM>: response time, connection time, decomposition
of the user scenario based on request grouping instruction (called <I>transactions</I>), requests
per second 
<LI CLASS="li-itemize"><EM>Errors</EM>: Statistics on page return code to trace errors 
<LI CLASS="li-itemize"><EM>Target server behaviour</EM>: An Erlang agent can gather information
from the target server(s). Tsung produces graphs for CPU and memory
consumption and network traffic. SNMP is also supported. 
</UL>

Note that <EM>Tsung</EM> takes care of the synchronization process
by itself. Gathered statistics are «synchronized».<BR>
<BR>
It is possible to generate graphs during the benchmark as statistics
are gathered in real-time.<BR>
<BR>
<!--TOC subsection Highlights-->

<H3 CLASS="subsection"><A NAME="htoc11">2.6</A>&nbsp;&nbsp;Highlights</H3><!--SEC END -->

<EM>Tsung</EM> has several advantages over other injection tools: 
<UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>High performance</EM> and <EM>distributed benchmark</EM>: You
 can use Tsung to simulate tens of thousands of virtual users.
<LI CLASS="li-itemize"><EM>Ease of use</EM>: The hard work is already done for all supported
protocol. No need to write complex scripts. Dynamic scenarios only
requires small trivial piece of code.
<LI CLASS="li-itemize"><EM>Multi-protocol support</EM>: <EM>Tsung</EM> is for example one of
the only tool to benchmark SOAP applications 
<LI CLASS="li-itemize"><EM>Monitoring</EM> of the target server(s) to analyze the behaviour
and find bottlenecks. For example, it has been used to analyze cluster
symmetry (is the load properly balanced ?) and to determine the best
combination of machines on the three cluster tiers (Web engine, EJB
engine and database) 
</UL>
<!--TOC section Installation-->

<H2 CLASS="section"><A NAME="htoc12">3</A>&nbsp;&nbsp;Installation</H2><!--SEC END -->

This package has been tested on Linux, FreeBSD and Solaris. It should
work on Erlang supported platforms (Linux, Solaris, *BSD, Win32 and
MacOS-X).<BR>
<BR>
<!--TOC subsection Dependencies-->

<H3 CLASS="subsection"><A NAME="htoc13">3.1</A>&nbsp;&nbsp;Dependencies</H3><!--SEC END -->

<UL CLASS="itemize"><LI CLASS="li-itemize">
Erlang/OTP R10B-0 and up
 (<A HREF="http://www.erlang.org/download.html"><TT>http://www.erlang.org/download.html</TT></A>). RedHat users can
 download a R10B-8 rpm at
 <A HREF="http://tsung.erlang-projects.org/dist/redhat"><TT>http://tsung.erlang-projects.org/dist/redhat</TT></A>. Erlang is now
 part of fedora extra repository.
 <LI CLASS="li-itemize">extended regexp module (used for dynamic variables):
 gregexp.erl available at
 <A HREF="http://www.cellicium.com/erlang/contribs/"><TT>http://www.cellicium.com/erlang/contribs/</TT></A> . The module is
 included in the source and binary distribution of <EM>Tsung</EM>. It
 is released under the EPL License.
 <LI CLASS="li-itemize">pgsql module made by Christian Sunesson (for the postgresql plugin):
 sources available at
 <A HREF="http://jungerl.sourceforge.net/"><TT>http://jungerl.sourceforge.net/</TT></A> . The module is
 included in the source and binary distribution of <EM>Tsung</EM>. It
 is released under the EPL License.
 <LI CLASS="li-itemize">gnuplot and perl5 (optional; for graphical output with
 <TT>tsung_stats.pl</TT> script). The Template Toolkit is used for HTML
 reports (see <A HREF="http://template-toolkit.org/"><TT>http://template-toolkit.org/</TT></A>)
 <LI CLASS="li-itemize">for distributed tests, you need an ssh access to remote
 machines without password (use a RSA/DSA key without pass-phrase or
 ssh-agent) (rsh is also supported)
<LI CLASS="li-itemize">bash
</UL>
<!--TOC subsection Compilation-->

<H3 CLASS="subsection"><A NAME="htoc14">3.2</A>&nbsp;&nbsp;Compilation</H3><!--SEC END -->
<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
./configure
 make
 make install
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><!--TOC subsection Configuration-->

<H3 CLASS="subsection"><A NAME="htoc15">3.3</A>&nbsp;&nbsp;Configuration</H3><!--SEC END -->

The default configuration file is <TT>~/.tsung/tsung.xml</TT> (
there are several sample files in 
<TT>/usr/share/doc/tsung/examples</TT>).<BR>
<BR>
Log files are saved in <TT>~/.tsung/log/</TT> . A new subdirectory
is created for each test using the current date as name
(<TT>~/.tsung/log/20040217-09:40</TT> for ex.)<BR>
<BR>
<!--TOC subsection Feedback-->

<H3 CLASS="subsection"><A NAME="htoc16">3.4</A>&nbsp;&nbsp;Feedback</H3><!--SEC END -->

Use the Tsung mailing list (see
<A HREF="https://lists.process-one.net/mailman/listinfo/tsung-users"><TT>https://lists.process-one.net/mailman/listinfo/tsung-users</TT></A>) if you have
suggestions or questions about <EM>Tsung</EM>.<BR>
<BR>
<!--TOC section HTTP benchmark approach-->

<H2 CLASS="section"><A NAME="htoc17">4</A>&nbsp;&nbsp;HTTP benchmark approach</H2><!--SEC END -->

<!--TOC subsection benchmarking a Web server-->

<H3 CLASS="subsection"><A NAME="htoc18">4.1</A>&nbsp;&nbsp;benchmarking a Web server</H3><!--SEC END -->

<OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Record one or more sessions: start the recorder with: <TT>tsung
 recorder</TT>, and then configure your browser to use Tsung
 proxy recorder (the listen port is 8090). A session file will be
 created. For HTTPS recording, use <FONT COLOR=purple>http://{</FONT> instead of
 <FONT COLOR=purple>https://</FONT> in your browser.
<LI CLASS="li-enumerate">Edit / organize scenario, by adding recorded sessions in the
 configuration file.
<LI CLASS="li-enumerate">Write small code for dynamic parts if needed and place dynamic mark-up
in the scenario.
<LI CLASS="li-enumerate">Test and adjust scenario to have a nice progression of the load. This
is highly dependent of the application and of the size of the target
server(s). Calculate the normal duration of the scenario and use the
interarrival time between users and the duration of the phase to estimate
the number of simultaneous users for each given phase. 
<LI CLASS="li-enumerate">Launch benchmark with your first application parameters set-up:
 <TT>tsung start</TT>
<LI CLASS="li-enumerate">Wait for the end of the test or stop by hand with
 <TT>tsung stop</TT> (reports can also be generated during the
 test (see § <A HREF="#sec:statistics-reports">9</A>) : the statistics are
 updated every 10 seconds). For a brief summary of the current
 activity, use <TT>tsung status</TT>
<LI CLASS="li-enumerate">Analyze results, change parameters and relaunch another benchmark 
</OL>
<!--TOC subsection benchmarking a proxy server-->

<H3 CLASS="subsection"><A NAME="htoc19">4.2</A>&nbsp;&nbsp;benchmarking a proxy server</H3><!--SEC END -->

By default, the HTTP plugin is used to benchmark HTTP servers. But you
can also benchmark HTTP Proxy servers. To do that, you must add in the
<TT>options</TT> section:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;option type="ts_http" name="http_use_server_as_proxy" value="true"&gt;&lt;/option&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC section PostgreSQL benchmark approach-->

<H2 CLASS="section"><A NAME="htoc20">5</A>&nbsp;&nbsp;PostgreSQL benchmark approach</H2><!--SEC END -->

It's the same approach as HTTP: first you start to record one or more
sessions with the recorder: 
<TT>tsung -p pgsql recorder</TT><BR>
<BR>
This will start a proxy listening to port 8090 and will proxy requests
to 127.0.0.0:5432.<BR>
<BR>
To choose another port and/or address:
<TT>tsung -L 5432 -I 10.6.1.1 -P 5433 -p pgsql recorder</TT><BR>
<BR>
This will start a proxy listening to port 5432 and will proxy requests
to 10.6.1.1:5433.<BR>
<BR>
<!--TOC section Jabber benchmark approach-->

<H2 CLASS="section"><A NAME="htoc21">6</A>&nbsp;&nbsp;Jabber benchmark approach</H2><!--SEC END -->

This paragraph explains how to write a session for Jabber.<BR>
<BR>
There are two differences between HTTP and Jabber testing:
<OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
There is no recorder for Jabber, so you have to write your
 sessions by hand (an example is provided in
 <A HREF="#sec:sessions:jabber">8.6.2</A>).
<LI CLASS="li-enumerate">the jabber plugin does not parse XML; instead it uses packet
 acknowledgments. 
</OL>
<!--TOC subsection Acknowledgements of messages-->

<H3 CLASS="subsection"><A NAME="htoc22">6.1</A>&nbsp;&nbsp;Acknowledgements of messages</H3><!--SEC END -->

Since the jabber plugin does not parse XML (historically, it was for
performance reasons), you must have a way to tell when a request is
finished. There are 3 possibilities:
<DL CLASS="description" COMPACT=compact><DT CLASS="dt-description">
 <B>ack=local</B><DD CLASS="dd-description"> as soon as a packet is received from the server, the
request is considered as completed. Hence if you use a local ack with a request
that do not require a response from the server (presence for ex.), it
 will wait forever (or until a timeout is reached).
 <DT CLASS="dt-description"><B>ack=no_ack</B><DD CLASS="dd-description"> as soon as the request is send, it is considered as completed (do
not wait for incoming data)
 <DT CLASS="dt-description"><B>ack=global</B><DD CLASS="dd-description"> synchronized users. its main use is for waiting for all
users to connect before sending messages. To do that, set a request
with global ack (it can be the first presence msg:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
   &lt;request&gt; &lt;jabber type="presence" ack="global"/&gt; &lt;/request&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE>)<BR>
<BR>
You also have to specify the number of users to be connected:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;option type="ts_jabber" name="global_number" value="100"&gt;&lt;/option&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
To be sure that exactly <TT>global_number</TT> users are started, add the
<FONT COLOR=purple>'maxnumber'</FONT> attribute to <TT>'users'</TT><BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
    &lt;users maxnumber="100" interarrival="1.0" unit="second"&gt;&lt;/users&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
If you do not specify maxnumber, the global ack will be reset every
<TT>global_number</TT> users
</DL>
<!--TOC subsection Status: Offline, Connected and Online-->

<H3 CLASS="subsection"><A NAME="htoc23">6.2</A>&nbsp;&nbsp;Status: Offline, Connected and Online</H3><!--SEC END -->

You can send messages to offline or online users. A user is considered
online when he has send a <FONT COLOR=purple>presence:initial</FONT> message (before
this message , the state of the user is <TT>connected</TT>).<BR>
<BR>
If you want to switch back to <TT>connected</TT> before going
<TT>offline</TT>, you can use a <FONT COLOR=purple>presence:final</FONT> message:<BR>
<BR>
<FONT COLOR=purple>presence:final</FONT> does two things:
<OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
It removes the client from the list of Online users, and moves
 them into the list of Connected users.
<LI CLASS="li-enumerate">It sends a broadcast presence update of type='unavailable'.
</OL>
<FONT COLOR=purple>presence:final</FONT> is optional.<BR>
<BR>
<EM>warn:</EM> this is new in <B>1.2.0</B>, in earlier version, only 2
status were available: online and offline; a user was considered
online as soon as it was connected.<BR>
<BR>
<!--TOC subsection Authentication-->

<H3 CLASS="subsection"><A NAME="htoc24">6.3</A>&nbsp;&nbsp;Authentication</H3><!--SEC END -->

Below are configuration examples for the possible authentication
methods. Note: the regular expressions used here are only examples -
they may need to be altered depending on how a particular server
implementation composes messages (see also &nbsp;<A HREF="#sec:jabber-options">8.5.1</A>
for password settings).
<UL CLASS="itemize"><LI CLASS="li-itemize">
<B>plain authentication</B> - sends cleartext passwords:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;session probability="100" name="jabber-plain" type="ts_jabber"&gt;

    &lt;request&gt; &lt;jabber type="connect" ack="no_ack"&gt;&lt;/jabber&gt; &lt;/request&gt;

    &lt;thinktime value="2"&gt;&lt;/thinktime&gt; 

    &lt;transaction name="auth_plain"&gt;
      &lt;request&gt; &lt;jabber type="auth_get" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
      &lt;request&gt; &lt;jabber type="auth_set_plain" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;
    ...
  &lt;/session&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><LI CLASS="li-itemize"><B>digest authentication</B> as described in XMPP JEP-0078: Non-SASL Authentication
 <A HREF="http://www.jabber.org/jeps/jep-0078.html"><TT>http://www.jabber.org/jeps/jep-0078.html</TT></A>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;session probability="100" name="jabber-digest" type="ts_jabber"&gt;

    &lt;!-- regexp captures stream ID returned by server --&gt;
    &lt;request&gt;
      &lt;dyn_variable name="sid" regexp="&amp;lt;stream:stream id=&amp;quot;\(.*\)&amp;quot; xmlns:stream"/&gt;
      &lt;jabber type="connect" ack="local"&gt;&lt;/jabber&gt;
    &lt;/request&gt;

    &lt;thinktime value="2"&gt;&lt;/thinktime&gt;

    &lt;transaction name="auth_digest"&gt;
      &lt;request&gt; &lt;jabber type="auth_get" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
      &lt;request subst='true'&gt; &lt;jabber type="auth_set_digest" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;
    ...
  &lt;/session&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><LI CLASS="li-itemize"><B>sip-digest authentication</B>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;session probability="100" name="jabber-sipdigest" type="ts_jabber"&gt;

    &lt;request&gt; &lt;jabber type="connect" ack="no_ack"&gt;&lt;/jabber&gt; &lt;/request&gt;

    &lt;thinktime value="2"&gt;&lt;/thinktime&gt;

    &lt;transaction name="auth_sipdigest"&gt;
      &lt;!-- regexp captures nonce value returned by server --&gt;
      &lt;request&gt;
        &lt;dyn_variable name="nonce" regexp="&amp;lt;Nonce encoding=&amp;quot;hex&amp;quot;&amp;gt;\(.*\)&amp;lt;\/Nonce&amp;gt;"/&gt;
        &lt;jabber type="auth_get" ack="local"&gt;&lt;/jabber&gt;
      &lt;/request&gt;
      &lt;request subst='true'&gt; &lt;jabber type="auth_set_sip" ack="local"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;
    ...
  &lt;/session&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE></UL>
<!--TOC section Using the proxy recorder-->

<H2 CLASS="section"><A NAME="htoc25">7</A>&nbsp;&nbsp;Using the proxy recorder</H2><!--SEC END -->

The recorder has two plugins: one for HTTP and one for PostgreSQL.<BR>
<BR>
To start it, <TT>tsung -p PLUGIN recorder</TT>. <FONT COLOR=purple>http</FONT> is
the default plugin. For PostgreSQL, use <FONT COLOR=purple>pgsql</FONT>.<BR>
<BR>
The proxy is listening to port 8090. The recorded session is
created as <TT>~/.tsung/tsung_recorderYYYMMDD-HH:MM.xml</TT>; if it doesn't
work, take a look at <TT>~/.tsung/log/tsung.log-tsung_recorder@hostname</TT><BR>
<BR>
To stop it, use <TT>tsung stop_recorder</TT>.<BR>
<BR>
Once a session has been created, you can insert it in your main config
file, either by editing by hand the file, or by using an ENTITY
declaration, like:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;!DOCTYPE tsung SYSTEM "/usr/share/tsung/tsung-1.0.dtd" [
 &lt;!ENTITY mysession1 SYSTEM "/home/nniclausse/.tsung/tsung_recorder20051217-13:11.xml"&gt;
]&gt;
...
&lt;sessions&gt;
  &amp;mysession1;
&lt;/sessions&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC section Understanding tsung.xml configuration file-->

<H2 CLASS="section"><A NAME="htoc26">8</A>&nbsp;&nbsp;Understanding tsung.xml configuration file</H2><!--SEC END -->

The default encoding is utf-8. You can use a different encoding, like in:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
 </PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC subsection File structure-->

<H3 CLASS="subsection"><A NAME="htoc27">8.1</A>&nbsp;&nbsp;File structure</H3><!--SEC END -->

Scenarios are enclosed into Tsung tags:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE tsung SYSTEM "/usr/share/tsung/tsung-1.0.dtd" [] &gt;
&lt;tsung loglevel="info"&gt;
...
&lt;/tsung&gt;
 </PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
 If you add the attribute <FONT COLOR=purple>dumptraffic="true"</FONT>, all the
 traffic will be logged to a file. <EM>Warn:</EM> this will considerably
 slow down Tsung, so use with care. It is useful for debugging
 purpose.<BR>
<BR>
The <TT>loglevel</TT> can also have a great impact on performance:
 For high load, <FONT COLOR=purple>warning</FONT> is recommanded .
 Possible values are:
<UL CLASS="itemize"><LI CLASS="li-itemize">
emergency
<LI CLASS="li-itemize">critical
<LI CLASS="li-itemize">error
<LI CLASS="li-itemize">warning
<LI CLASS="li-itemize">notice (default)
<LI CLASS="li-itemize">info
<LI CLASS="li-itemize">debug
</UL>
For REALLY verbose logging, recompile tsung with <TT>make debug</TT>
and set loglevel to <FONT COLOR=purple>debug</FONT>.<BR>
<BR>
<!--TOC subsection Clients and server-->

<H3 CLASS="subsection"><A NAME="htoc28">8.2</A>&nbsp;&nbsp;Clients and server</H3><!--SEC END -->

Scenarios start with clients (Tsung cluster) and server definitions:<BR>
<BR>
For non distributed load, you can use a basic setup like:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;clients&gt;
     &lt;client host="localhost" use_controller_vm="true"/&gt;
  &lt;/clients&gt;

&lt;servers&gt;
  &lt;server host="192.168.1.1" port="80" type="tcp"&gt;&lt;/server&gt;
&lt;/servers&gt;
 </PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
This will start the load on the same host and on the same Erlang
virtual machine as the controller.<BR>
<BR>
The server is the entry point into the cluster (<B>New in 1.2.0:</B>
if several servers are defined, a round robin algorithm is used to
choose the server).<BR>
<BR>
The next example is a more complex, and use several features for
advanced distributed testing:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;clients&gt;
     &lt;client host="louxor" weight="1" maxusers="800"&gt;
         &lt;ip value="10.9.195.12"&gt;&lt;/ip&gt;
         &lt;ip value="10.9.195.13"&gt;&lt;/ip&gt;
     &lt;/client&gt;
     &lt;client host="memphis" weight="3" maxusers="600" cpu="2"&gt;
         &lt;ip value="10.9.195.14"&gt;&lt;/ip&gt;
     &lt;/client&gt;
  &lt;/clients&gt;

&lt;servers&gt;
  &lt;server host="10.9.195.1" port="8080" type="tcp"&gt;&lt;/server&gt;
&lt;/servers&gt;
 </PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
 
 Several virtual IP can be used to simulate more machines. This is
 very useful when a load-balancer use the client<CODE>'</CODE>s IP to
 distribute the traffic among a cluster of servers. <B>New in
 1.1.1:</B> IP is no longer mandatory. If not specified, the default IP will
 be used.<BR>
<BR>
In this example, a second machine is used in the Tsung cluster,
 with a higher weight, and 2 cpus. Two Erlang virtual machines will be
 used to take advantage of the number of CPU.<BR>
<BR>
By default, the load is distributed uniformly on all CPU (one cpu
 per client by default). The weight parameter (integer) can be used to
 take into account the speed of the client machine. For instance, if
 one real client has a weight of 1 and the other client has a weight
 of 2, the second one will start twice the number of users as the
 first (the proportions will be 1/3 and 2/3). In the earlier example
 where for the second client has 2 CPU and weight=3, the weight is
 equal to 1.5 for each CPU.<BR>
<BR>
<!--TOC subsection Monitoring-->

<H3 CLASS="subsection"><A NAME="htoc29">8.3</A>&nbsp;&nbsp;Monitoring</H3><!--SEC END -->

Scenarios can contain optional monitoring informations. For example,
here is a cluster monitoring definition based on Erlang agents, for
a cluster of 6 computers:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;monitoring&gt;
    &lt;monitor host="geronimo" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="bigfoot-1" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="bigfoot-2" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="f14-1" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="f14-2" type="erlang"&gt;&lt;/monitor&gt;
    &lt;monitor host="db" type="erlang"&gt;&lt;/monitor&gt;
  &lt;/monitoring&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
The type keyword snmp can replace the erlang keyword, if SNMP monitoring
is preferred. They can be mixed. erlang is the default value for
monitoring.<BR>
<BR>
Note: For Erlang monitoring, monitored computers need to be
accessible through the network. SSH (or rsh) needs to be configured to
allow connection without password on. <B>You must use the same
 version of Erlang/OTP on all nodes otherwise it may not work
 properly !</B><BR>
<BR>
<!--TOC subsection Defining the load progression-->

<H3 CLASS="subsection"><A NAME="htoc30">8.4</A>&nbsp;&nbsp;Defining the load progression</H3><!--SEC END -->

The load progression is set-up by defining several arrival phases:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
 &lt;load&gt;
  &lt;arrivalphase phase="1" duration="10" unit="minute"&gt;
    &lt;users interarrival="2" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;

  &lt;arrivalphase phase="2" duration="10" unit="minute"&gt;
    &lt;users interarrival="1" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;

  &lt;arrivalphase phase="3" duration="10" unit="minute"&gt;
    &lt;users interarrival="0.1" unit="second"&gt;&lt;/users&gt;
  &lt;/arrivalphase&gt;
 &lt;/load&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
With this setup, during the first 10 minutes of the test, a new user
will be created every 2 seconds, then during the next 10 minutes, a
new user will be created every second, and for the last 10 minutes,
10 users will be generated every second. The test will finish when
all users have ended their session.<BR>
<BR>
The load generated in terms of HTTP requests / seconds will also
depend on the mean number of requests within a session (if you have a
mean value of 100 requests per session and 10 new users per seconds,
the theoretical average throughput will be 1000 requests/ sec).<BR>
<BR>
<!--TOC subsection Setting options-->

<H3 CLASS="subsection"><A NAME="htoc31">8.5</A>&nbsp;&nbsp;Setting options</H3><!--SEC END -->

Default values can be set-up globally: thinktime between requests
in the scenario and ssl cipher algorithms. These values overrides
those set in session configuration tags if override is true.
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;option name="thinktime" value="3" random="false" override="true"/&gt;
  &lt;option name="ssl_ciphers" 
           value="EXP1024-RC4-SHA,EDH-RSA-DES-CBC3-SHA"/&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC subsubsection Jabber options-->

<H4 CLASS="subsubsection"><A NAME="htoc32">8.5.1</A>&nbsp;&nbsp;Jabber options</H4><!--SEC END -->

<A NAME="sec:jabber-options"></A>
Default values for specific protocols can be defined. Here is an
example of option values for Jabber:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;option type="ts_jabber" name="global_number" value="5" /&gt;
  &lt;option type="ts_jabber" name="userid_max" value="100" /&gt;
  &lt;option type="ts_jabber" name="domain" value="jabber.org" /&gt;
  &lt;option type="ts_jabber" name="username" value="myuser" /&gt;
  &lt;option type="ts_jabber" name="passwd" value="mypasswd" /&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Using these values, users will be <FONT COLOR=purple>myuserXXX</FONT> where XXX is an integer in
the interval [1:userid_max] and passwd <FONT COLOR=purple>mypasswdXXX</FONT><BR>
<BR>
If not set in the configuration file, the values will be set to:
<UL CLASS="itemize"><LI CLASS="li-itemize">
global_number = 10000
<LI CLASS="li-itemize">userid_max = 100
<LI CLASS="li-itemize">domain = erlang-projects.org
<LI CLASS="li-itemize">username = tsunguser
<LI CLASS="li-itemize">passwd = sesame
</UL>
<!--TOC subsubsection HTTP options-->

<H4 CLASS="subsubsection"><A NAME="htoc33">8.5.2</A>&nbsp;&nbsp;HTTP options</H4><!--SEC END -->

For HTTP, you can set the <TT>UserAgent</TT> values
(available since Tsung 1.1.0), using a probability for each
value (the sum of all probabilities must be equal to 100)<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;option type="ts_http" name="user_agent"&gt;
    &lt;user_agent probability="80"&gt;
       Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.8) Gecko/20050513 Galeon/1.3.21
    &lt;/user_agent&gt;
    &lt;user_agent probability="20"&gt;
      Mozilla/5.0 (Windows; U; Windows NT 5.2; fr-FR; rv:1.7.8) Gecko/20050511 Firefox/1.0.4
    &lt;/user_agent&gt;
  &lt;/option&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC subsection Sessions-->

<H3 CLASS="subsection"><A NAME="htoc34">8.6</A>&nbsp;&nbsp;Sessions</H3><!--SEC END -->

Sessions define the content of the scenario itself. They describe
the requests to execute.<BR>
<BR>
Each session has a given probability. This is used to decide which
session a new user will execute. The sum of all session<CODE>'</CODE>s
probabilities must be 100.<BR>
<BR>
A transaction is just a way to have customized statistics. Say if you
want to know the response time of the login page of your website, you
just have to put all the requests of this page (HTML + embedded
pictures) within a transaction. In the example above, the transaction
called <TT>index_request</TT> will gives you in the
statistics/reports the mean response time to get
<FONT COLOR=purple>index.en.html + header.gif</FONT>. Be warn that If you have a
thinktime inside the transaction, the thinktime will be part of the
response time.<BR>
<BR>
<!--TOC subsubsection HTTP-->

<H4 CLASS="subsubsection"><A NAME="htoc35">8.6.1</A>&nbsp;&nbsp;HTTP</H4><!--SEC END -->

This example shows several features of the HTTP protocol support in
Tsung: GET and POST request, basic authentication, transaction for
statistics definition, ...<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;sessions&gt;
  &lt;session name="http-example" probability="70" type="ts_http"&gt;

    &lt;request&gt; &lt;http url="/" method="GET" version="1.1"&gt;
                    &lt;/http&gt; &lt;/request&gt;
    &lt;request&gt; &lt;http url="/images/logo.gif"
               method="GET" version="1.1" 
               if_modified_since="Fri, 14 Nov 2003 02:43:31 GMT"&gt;
              &lt;/http&gt;&lt;/request&gt;

    &lt;thinktime value="20" random="true"&gt;&lt;/thinktime&gt;

    &lt;transaction name="index_request"&gt;
     &lt;request&gt;&lt;http url="/index.en.html"
                          method="GET" version="1.1" &gt;
              &lt;/http&gt; &lt;/request&gt;
     &lt;request&gt;&lt;http url="/images/header.gif"
                          method="GET" version="1.1"&gt;
              &lt;/http&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;thinktime value="60" random="true"&gt;&lt;/thinktime&gt;
    &lt;request&gt;
      &lt;http url="/" method="POST" version="1.1"
               contents="bla=blu"&gt;
      &lt;/http&gt; &lt;/request&gt;
    &lt;request&gt;
       &lt;http url="/bla" method="GET" version="1.1"
             contents="bla=blu&amp;name=glop"&gt;
       &lt;www_authenticate userid="Aladdin"
                         passwd="open sesame"/&gt;&lt;/http&gt;
    &lt;/request&gt;
  &lt;/session&gt;

  &lt;session name="backoffice" probability="30" ...&gt;
  ... &lt;/session&gt;
&lt;/sessions&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC subsubsection Jabber-->

<H4 CLASS="subsubsection"><A NAME="htoc36">8.6.2</A>&nbsp;&nbsp;Jabber</H4><!--SEC END -->

<A NAME="sec:sessions:jabber"></A>

Here is an example of a session definition for the Jabber protocol:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;sessions&gt;
 &lt;session probability="70" name="jabber-example" type="ts_jabber"&gt;

    &lt;request&gt; &lt;jabber type="connect" ack="no_ack" /&gt; &lt;/request&gt;

    &lt;thinktime value="2"&gt;&lt;/thinktime&gt;

    &lt;transaction name="authenticate"&gt;
      &lt;request&gt; &lt;jabber type="authenticate" ack="local"&gt; &lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;request&gt; &lt;jabber type="presence:initial" ack="no_ack"/&gt; &lt;/request&gt;


    &lt;thinktime value="30"&gt;&lt;/thinktime&gt;

    &lt;transaction name="online"&gt;
    &lt;request&gt; &lt;jabber type="chat" ack="no_ack" size="16" destination="online"/&gt;&lt;/request&gt;
    &lt;/transaction&gt;
    &lt;thinktime value="30"&gt;&lt;/thinktime&gt;

    &lt;transaction name="offline"&gt;
      &lt;request&gt; &lt;jabber type="chat" ack="no_ack" size="56" destination="offline"/&gt;&lt;request&gt;
    &lt;/transaction&gt;

    &lt;thinktime value="30"&gt;&lt;/thinktime&gt;

    &lt;transaction name="close"&gt;
      &lt;request&gt; &lt;jabber type="close" ack="local"&gt; &lt;/jabber&gt;&lt;/request&gt;
    &lt;/transaction&gt;
  &lt;/session&gt;
&lt;/sessions&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC paragraph Roster-->

<H5 CLASS="paragraph">Roster</H5><!--SEC END -->

What you can do with rosters using Tsung: <BR>
<BR>
You can
<OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Add a new contact to their roster
 - The new contact is added to the <FONT COLOR=purple>Tsung Group</FONT> group, and their name matches their JID
<LI CLASS="li-enumerate">Send a <FONT COLOR=purple>subscribe</FONT> presence notification to the new contact's JID
 - This results in a <EM>pending</EM> subscription
 <LI CLASS="li-enumerate">Rename a roster contact
 This changes the previously added contact's name from the default JID, to <FONT COLOR=purple>Tsung Testuser</FONT>
 <LI CLASS="li-enumerate">Delete the previously added contact.
</OL>
Note that when you add a new contact, the contact JID is stored and used for the operations that follow. It is recommended that for each session which is configured to perform these operations, only do so once. In other words, you would NOT want to ADD more than one new contact per session. If you want to alter the rate that these roster functions are used during your test, it is best to use the session 'probablity' factor to shape this.<BR>
<BR>
The nice thing about this is that when you test run is complete, your roster tables should look the same as before you started the test. So, if you set it up properly, you can have pre-loaded roster entries before the test, and then use these methods to dynamically add, modify, and remove roster entries during the test as well. <BR>
<BR>
Example roster modification setup:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;session probability="100" name="jabber-rostermod" type="ts_jabber"&gt;

    &lt;!-- connect, authenticate, roster 'get', etc... --&gt;

    &lt;transaction name="rosteradd"&gt;
      &lt;request&gt; &lt;jabber type="iq:roster:add" ack="no_ack" destination="online"&gt;&lt;/jabber&gt; &lt;/request&gt;
      &lt;request&gt; &lt;jabber type="presence:subscribe" ack="no_ack"/&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;!-- ... --&gt;

    &lt;transaction name="rosterrename"&gt;
      &lt;request&gt; &lt;jabber type="iq:roster:rename" ack="no_ack"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;!-- ... --&gt;

    &lt;transaction name="rosterdelete"&gt;
      &lt;request&gt; &lt;jabber type="iq:roster:remove" ack="no_ack"&gt;&lt;/jabber&gt; &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;!-- remainder of session... --&gt;

  &lt;/session&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC paragraph Presence-->

<H5 CLASS="paragraph">Presence</H5><!--SEC END -->

<UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>type</TT> can be either <FONT COLOR=purple>presence:broadcast</FONT> or <FONT COLOR=purple>presence:directed</FONT>.
<LI CLASS="li-itemize"><TT>show</TT> value must be either <FONT COLOR=purple>away</FONT>, <FONT COLOR=purple>chat</FONT>, <FONT COLOR=purple>dnd</FONT>, or <FONT COLOR=purple>xa</FONT>.
<LI CLASS="li-itemize"><TT>status</TT> value can be any text.
</UL>
For more info, see section 2.2 of RFC 3921.<BR>
<BR>
If you omit the <TT>show</TT> or <TT>status</TT> attributes, they default to <FONT COLOR=purple>chat</FONT> and <FONT COLOR=purple>Available</FONT> respectively.<BR>
<BR>
Example of broadcast presence (broadcast to members of your roster):
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
    &lt;request&gt; &lt;jabber type="presence:broadcast" show="away" status="Be right back..." ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:broadcast" show="chat" status="Available to chat" ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:broadcast" show="dnd" status="Don't bother me!" ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:broadcast" show="xa" status="I may never come back..." ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:broadcast" ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Example of directed presence (sent to random <FONT COLOR=purple>online</FONT> users):
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
    &lt;request&gt; &lt;jabber type="presence:directed" show="away" status="Be right back..." ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:directed" show="chat" status="Available to chat" ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:directed" show="dnd" status="Don't bother me!" ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:directed" show="xa" status="I may never come back..." ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;

    &lt;request&gt; &lt;jabber type="presence:directed" ack="no_ack"/&gt; &lt;/request&gt;
    &lt;thinktime value="5"&gt;&lt;/thinktime&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC paragraph raw XML-->

<H5 CLASS="paragraph">raw XML</H5><!--SEC END -->

You can send raw XML date to the server using the <TT>raw</TT> type:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;jabber type="raw" ack="no_ack" data="&amp;lt;stream&amp;gt;foo&amp;lt;/stream&amp;gt;"&gt;&lt;/jabber&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Beware: you must encode XML characters like <FONT COLOR=purple>&lt;</FONT>
,<FONT COLOR=purple>&gt;</FONT>, <FONT COLOR=purple>&amp;</FONT>, etc.<BR>
<BR>
<!--TOC subsubsection PostgreSQL-->

<H4 CLASS="subsubsection"><A NAME="htoc37">8.6.3</A>&nbsp;&nbsp;PostgreSQL</H4><!--SEC END -->

For postgresql, 4 types of requests are available: 
<OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
connect (to a given database with a given username
<LI CLASS="li-enumerate">authenticate (with password or not)
<LI CLASS="li-enumerate">sql
<LI CLASS="li-enumerate">close
</OL>
This example shows most of the features of a PostgreSQL session:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;session probability="100" name="pgsql-example" type="ts_pgsql"&gt;
    &lt;transaction name="connection"&gt;
      &lt;request&gt;
        &lt;pgsql type="connect" database="bench" username="bench" /&gt;
      &lt;/request&gt;
    &lt;/transaction&gt;

    &lt;request&gt;&lt;pgsql type="authenticate" password="sesame"/&gt;&lt;/request&gt;

    &lt;thinktime value="12"/&gt;

    &lt;request&gt;&lt;pgsql type="sql"&gt;SELECT * from accounts;&lt;/pgsql&gt;&lt;/request&gt;

    &lt;thinktime value="20"/&gt;

    &lt;request&gt;&lt;pgsql type="sql"&gt;SELECT * from users;&lt;/pgsql&gt;&lt;/request&gt;

    &lt;request&gt;&lt;pgsql type='sql'&gt;&lt;![CDATA[SELECT n.nspname as "Schema",
  c.relname as "Name",
  CASE c.relkind WHEN 'r' THEN 'table' WHEN 'v' THEN 'view' WHEN 'i' THEN 'index' WHEN 'S' THEN 'sequence' WHEN 's' THEN '%_toto_% END as "Type",
  u.usename as "Owner"
FROM pg_catalog.pg_class c
     LEFT JOIN pg_catalog.pg_user u ON u.usesysid = c.relowner
     LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
WHERE c.relkind IN ('r','v','S','')
      AND n.nspname NOT IN ('pg_catalog', 'pg_toast')
      AND pg_catalog.pg_table_is_visible(c.oid)
ORDER BY 1,2;]]&gt;&lt;/pgsql&gt;&lt;/request&gt;

    &lt;request&gt;&lt;pgsql type="close"&gt;&lt;/pgsql&gt;&lt;/request&gt;

  &lt;/session&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC subsubsection Dynamic substitutions-->

<H4 CLASS="subsubsection"><A NAME="htoc38">8.6.4</A>&nbsp;&nbsp;Dynamic substitutions</H4><!--SEC END -->

Dynamic substitution are mark-up placed in element of the scenario.
For HTTP, this mark-up can be placed in basic authentication (www_authenticate
tag: userid and passwd attributes), URL (to change GET parameter)
and POST content.<BR>
<BR>
Those mark-up are of the form <FONT COLOR=purple>%%Module:Function%%</FONT>.
Substitutions are executed on a request-by-request basis, only if the
request tag has the attribute <FONT COLOR=purple>subst="true"</FONT>.<BR>
<BR>
When a substitution is requested, the substitution mark-up is replaced by
the result of the call to the Erlang function:
<FONT COLOR=purple>Module:Function(Pid, DynData)</FONT> where Pid is the Erlang process
id of the current virtual user and DynData the list of all Dynamic
variables (<B>Warn: before version 1.1.0, the argument was just the
 Pid !</B>).<BR>
<BR>
Here is an example of use of substitution in a Tsung scenario:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;session name="rec20040316-08:47" probability="100" type="ts_http"&gt;
 &lt;request subst="true"&gt;
  &lt;http url="/echo?symbol=%%symbol:new%%" method="GET"&gt;
  &lt;/http&gt;&lt;/request&gt;
&lt;/session&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Here is the Erlang code of the module used for dynamic substitution:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
-module(symbol).
-export([new/1]).

new({Pid, DynData}) -&gt;
    case random:uniform(3) of
        1 -&gt; "IBM";
        2 -&gt; "MSFT";
        3 -&gt; "RHAT"
    end.
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
(use <TT>erlc</TT> to compiled the code, and put the resulting .beam
file in <TT>\$PREFIX/lib/erlang/lib/tsung-X.X.X/ebin/</TT> on all client
machines)<BR>
<BR>
As you can see, writing scenario with dynamic substitution is trivial.<BR>
<BR>
If you want to set unique id, you can use the built-in function
<TT>ts_user_server:get_unique_id</TT>.
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;session name="rec20040316-08:47" probability="100" type="ts_http"&gt;
 &lt;request subst="true"&gt;
  &lt;http url="/echo?id=%%ts_user_server:get_unique_id%%" method="GET"&gt;
  &lt;/http&gt;&lt;/request&gt;
&lt;/session&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC subsubsection Reading external file-->

<H4 CLASS="subsubsection"><A NAME="htoc39">8.6.5</A>&nbsp;&nbsp;Reading external file</H4><!--SEC END -->

<B>New in 1.0.3</B>: A new module <TT>ts_file_server</TT> is available. You
can use it to read external files. For example, if you need to read user
names and passwd from a CSV file, you can do it with it (currently,
you can read only a single file). <EM>Note: Reading usernames and
password from a CSV file is not possible for Jabber.</EM><BR>
<BR>
You have to add this in the xml configuration file:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
 &lt;option name="file_server"  value="/tmp/userlist.csv"&gt;&lt;/option&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Now you can build you own function to use it, for example:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
-module(readcsv).
-export([user/1]).

user({Pid,DynVar})-&gt;
    {ok,Line} = ts_file_server:get_next_line(), 
    [Username, Passwd] = string:tokens(Line,";"),
    "username=" ++ Username ++"&amp;amp;passwd=" ++ Passwd.
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
In your session, use something like: <BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;request subst="true"&gt;
    &lt;http url='/login.cgi' version='1.0' contents='%%readcsv:user%%&amp;amp;op=login'
    content_type='application/x-www-form-urlencoded' method='POST'&gt;
    &lt;/http&gt;
  &lt;/request&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Two functions are available: <TT>ts_file_server:get_next_line</TT>
and <TT>ts_file_server:get_random_line</TT>. For the
<TT>get_next_line</TT> function, when the end of file is reached, the
first line of the file will be the next line.<BR>
<BR>
<!--TOC subsubsection Dynamic variables-->

<H4 CLASS="subsubsection"><A NAME="htoc40">8.6.6</A>&nbsp;&nbsp;Dynamic variables</H4><!--SEC END -->

In some cases, you may want to use a value given by the server in a
response later in the session, and this value is <B>dynamically
generated</B> by the server for each user. For this, you can use
<FONT COLOR=purple>&lt;dyn_variable&gt;</FONT> in the scenario<BR>
<BR>
Let's take an example with HTTP. You can easily grab a value in a HTML
form like:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&lt;form action="go.cgi" method="POST"&gt;
&lt;hidden name="random_num" value="42"&gt;&lt;/form&gt;
&lt;/form&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
with:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
 &lt;request&gt;
   &lt;http url="/testtsung.html" method="GET" version="1.0"&gt;&lt;/http&gt;
   &lt;dyn_variable name="random_num" &gt;&lt;/dyn_variable&gt;
 &lt;/request&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Now <TT>random_num</TT> will be set to 42 during the user's session. It's
value will be replace in all mark-up of the form
<FONT COLOR=purple>%%_random_num%%</FONT> if and only if the <TT>request</TT> tag has the
attribute <FONT COLOR=purple>subst="true"</FONT>, like:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
    &lt;request subst="true"&gt;
      &lt;http url='/go.cgi' version='1.0' 
      contents='username=nic&amp;amp;random_num=%%_random_num%%&amp;amp;op=login' 
      content_type='application/x-www-form-urlencoded' method='POST'&gt;
      &lt;/http&gt;
    &lt;/request&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE>If the dynamic value is not a form variable, you can set a regexp by
hand, for example to get the title of a HTML page:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
    &lt;request&gt;
      &lt;http url="/testtsung.html" method="GET" version="1.0"&gt;&lt;/http&gt;
      &lt;dyn_variable name="mytitlevar" 
                    regexp="&amp;lt;title&amp;gt;\(.*\)&amp;lt;/title&amp;gt;"/&gt;
    &lt;/request&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC subsubsection Checking the server's response-->

<H4 CLASS="subsubsection"><A NAME="htoc41">8.6.7</A>&nbsp;&nbsp;Checking the server's response</H4><!--SEC END -->

With the tag <TT>match</TT> in a <TT>request</TT> tag, you can check
the server's response against a given string, and do some actions
depending on the result. In any case, if it matches, this will
increment the <TT>match</TT> counter, if it does not match, the
<TT>nomatch</TT> counter will be incremented.<BR>
<BR>
For example, let's say you want to test a login page. If the login is
ok, the server will respond with <FONT COLOR=purple>Welcome !</FONT> in the
HTML body, otherwise not. To check that:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
 &lt;request&gt;
      &lt;match do="continue" when="match"&gt;Welcome !&lt;/match&gt;
      &lt;http url='/login.php' version='1.0' method='POST' 
       contents='username=nic&amp;amp;user_password=sesame'
       content_type='application/x-www-form-urlencoded' &gt;
 &lt;/request&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
You can use a regexp instead of a simple string.<BR>
<BR>
The list of available actions to do is:
<UL CLASS="itemize"><LI CLASS="li-itemize">
continue
<LI CLASS="li-itemize">abort : abort the session
<LI CLASS="li-itemize">restart: restart the session. The maximum number of
 restarts is 3 by default.
<LI CLASS="li-itemize">loop: repeat the request, after 5 seconds. The maximum number of
 loops is 20 by default.
</UL>
You can mixed several match tag in a single request:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
 &lt;request&gt;
      &lt;match do="loop" sleep_loop="5" max_loop="10" when="match"&gt;Retry&lt;/match&gt;
      &lt;match do="abort" when="match"&gt;Error&lt;/match&gt;
      &lt;http url='/index.php' method=GET'&gt;
 &lt;/request&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
You can also do the action on "nomatch" instead of "match".<BR>
<BR>
<!--TOC section Statistics and reports-->

<H2 CLASS="section"><A NAME="htoc42">9</A>&nbsp;&nbsp;Statistics and reports</H2><!--SEC END -->

<A NAME="sec:statistics-reports"></A>
<!--TOC subsection Available stats-->

<H3 CLASS="subsection"><A NAME="htoc43">9.1</A>&nbsp;&nbsp;Available stats</H3><!--SEC END -->

<UL CLASS="itemize"><LI CLASS="li-itemize">
request (response time for each request)
<LI CLASS="li-itemize">page (response time for each set of requests (a page is a group
 of request not separated by a thinktime))
<LI CLASS="li-itemize">connect (duration of the connection establishment)
<LI CLASS="li-itemize">reconnect (number of reconnection)
<LI CLASS="li-itemize">size_rcv (size of responses)
<LI CLASS="li-itemize">size_sent (size of requests)
<LI CLASS="li-itemize">session (duration of a user's session)
<LI CLASS="li-itemize">users (number of simultaneous users)
<LI CLASS="li-itemize">custom transactions
</UL>
The mean response time (for requests, page, etc.) is computed every 10
sec (and reset). That's why you have the highest mean and lowest mean
values in the Stats report (the mean for the whole test is not
computed, since it's not very meaningful if you have several phases
with different input rates in your setup).<BR>
<BR>
HTTP specific stats:
<UL CLASS="itemize"><LI CLASS="li-itemize">
counter for each response status (200, 404, etc.)
</UL>
<!--TOC subsection Design-->

<H3 CLASS="subsection"><A NAME="htoc44">9.2</A>&nbsp;&nbsp;Design</H3><!--SEC END -->

A bit of explanation on the design and internals of the statistics engine:<BR>
<BR>
Tsung was designed to handle thousands of requests/sec, for very
long period of times (several hours) so it do not write all data to
the disk (for performance reasons). Instead it computes on the fly an
estimation of the mean and standard variation for each type of data,
and writes these estimations every 10 seconds to the disk (and then
starts a new estimation for the next 10 sec). These computations are
done for two kinds of data:
<UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>sample</TT>, for things like response time
<LI CLASS="li-itemize"><TT>sample_counter</TT> when the input is a cumulative one (number of
packet sent for ex.).
</UL>
There are also two other types of useful data (no averaging is done for
those) :
<UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>counter</TT>: a simple counter, for HTTP status code for ex.
<LI CLASS="li-itemize"><TT>sum</TT> for ex. the cumulative HTTP response's size (it gives an
estimated bandwidth usage).
</UL>
<!--TOC subsection Generating the report-->

<H3 CLASS="subsection"><A NAME="htoc45">9.3</A>&nbsp;&nbsp;Generating the report</H3><!--SEC END -->

cd to the log directory of your test (say
<TT>~/.tsung/log/20040325-16:33/</TT>) and use the script
<TT>tsung_stats.pl</TT>:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
/usr/lib/tsung/bin/tsung_stats.pl
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
(use <FONT COLOR=purple>&ndash;help</FONT> to view all available options)<BR>
<BR>
<!--TOC subsection tsung summary-->

<H3 CLASS="subsection"><A NAME="htoc46">9.4</A>&nbsp;&nbsp;tsung summary</H3><!--SEC END -->

<BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
 <DIV CLASS="center">
 <IMG SRC="images/tsung-report.png" ALT="images/tsung-report.png">
 </DIV>
 <BR>
<BR>
<DIV CLASS="center">Figure 1: Report</DIV><BR>
<BR>

 <A NAME="fig:report"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></BLOCKQUOTE>
<!--TOC subsection Graphical overview-->

<H3 CLASS="subsection"><A NAME="htoc47">9.5</A>&nbsp;&nbsp;Graphical overview</H3><!--SEC END -->

<BLOCKQUOTE CLASS="figure"><DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV>
 <DIV CLASS="center">
 <IMG SRC="images/tsung-graph.png" ALT="images/tsung-graph.png">
 </DIV>
 <BR>
<BR>
<DIV CLASS="center">Figure 2: Graphical output</DIV><BR>
<BR>

 <A NAME="fig:graph"></A>
<DIV CLASS="center"><HR WIDTH="80%" SIZE=2></DIV></BLOCKQUOTE>
<!--TOC section References-->

<H2 CLASS="section"><A NAME="htoc48">10</A>&nbsp;&nbsp;References</H2><!--SEC END -->

<UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Tsung</EM> home page: <A HREF="http://tsung.erlang-projects.org/"><TT>http://tsung.erlang-projects.org/</TT></A>
<LI CLASS="li-itemize"><EM>Tsung</EM> description (French)<SUP><A NAME="text1" HREF="#note1">1</A></SUP>
<LI CLASS="li-itemize">Erlang web site <A HREF="http://www.erlang.org/"><TT>http://www.erlang.org/</TT></A>
<LI CLASS="li-itemize">Erlang programmation, Mickaël Rémond, Editions Eyrolles, 2003
 <SUP><A NAME="text2" HREF="#note2">2</A></SUP>
<LI CLASS="li-itemize"><EM>Making reliable system in presence of software errors</EM>, Doctoral Thesis,
Joe Armstrong, Stockholm, 2003 <SUP><A NAME="text3" HREF="#note3">3</A></SUP>
</UL>
<!--TOC section Acknowledgments-->

<H2 CLASS="section"><A NAME="htoc49">11</A>&nbsp;&nbsp;Acknowledgments</H2><!--SEC END -->

The first version of this document was based on a talk given by Mickael
Rémond<SUP><A NAME="text4" HREF="#note4">4</A></SUP> during an Object
Web benchmarking workshop in April 2004 (more info at
<A HREF="http://jmob.objectweb.org/"><TT>http://jmob.objectweb.org/</TT></A>).<BR>
<BR>
<!--TOC section Frequently Asked Questions-->

<H2 CLASS="section"><A NAME="htoc50">A</A>&nbsp;&nbsp;Frequently Asked Questions</H2><!--SEC END -->

<!--TOC subsection Tsung crashes when I start it -->

<H3 CLASS="subsection"><A NAME="htoc51">A.1</A>&nbsp;&nbsp;Tsung crashes when I start it </H3><!--SEC END -->

Does your Erlang system has ssl support enabled ?<BR>
<BR>
to test it:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &gt; erl
  Eshell V5.2  (abort with ^G)
  1&gt; ssl:start().
  you should see 'ok' 
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--TOC subsection Tsung still doesn't start ...-->

<H3 CLASS="subsection"><A NAME="htoc52">A.2</A>&nbsp;&nbsp;Tsung still doesn't start ...</H3><!--SEC END -->

Most of the time, when a crash happened at startup without any traffic 
generated, the problem arise because the main Erlang controller node cannot 
create a "slave" Erlang virtual machine. The message looks like:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
===============================================
=ERROR REPORT==== 4-May-2004::22:38:26 ===
** Generic server ts_config_server terminating
** Last message in was {'$gen_cast',{newbeam,myshortname,[]}}
** When Server state == {state,{config,
                                     undefined,
                                     5,
                                     full,
                                     undefined,
                                     [{client,
                                          "myshortname",
                                          2.00000,
                                          5,
                                          [{10,68,133,140}]}],
                                     {server,"foo.net",80,gen_tcp},
                                     [],
                                     [{arrivalphase,
                                          1,
                                          60,
                                          undefined,
                                          undefined,
                                          5.00000e-5,
                                          infinity}],
                                     undefined,
                                     [{session,
                                          1,
                                          100,
                                          ts_http,
                                          parse,
                                          true,
                                          undefined}],
                                     14,
                                     3,
                                     7,
                                     6,
                                     "negociate"},
  "/home/username/.tsung/log/20040204-18:32",
                               undefined,
                               0,
                               undefined,
                               2.00000}
** Reason for termination ==
** {{badmatch,{error,timeout}},
    [{ts_config_server,handle_cast,2},
     {gen_server,handle_msg,6},
     {proc_lib,init_p,5}]}
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Tsung launches a new erl virtual machine to do the actual
injection even when you have only one machine in the injection
cluster. This is because it needs to by-pass some limit with the number
of open socket from a single process (1024 most of the time). The idea
is to have several system processes (Erl beam) that can handle only a
small part of the network connection from the given computer. When the
<TT>maxclient</TT> limit (simultaneous) is reach, a new Erlang beam is launched
and the newest connection can be handled by the new beam).<BR>
<BR>
The problem is that the Erlang slave module cannot start a local slave
node. It tries to start it with the short node name
<TT>"myshortname"</TT> (<TT>erl -sname myshortname</TT>).
 If this fails the injection process cannot
start. Most of the time, adding the short name with the correct IP
address in the <TT>/etc/hosts</TT> file is sufficient to make it work.<BR>
<BR>
You can test this using these simple commands:
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&gt;erl -rsh ssh -sname foo -setcookie mycookie

Eshell V5.4.3 (abort with ^G) 
(foo@myhostname)1&gt;slave:start(remotehost,bar,"-setcookie mycookie").
{ok,bar@remotehost}
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
Note that you do not need to use the 127.0.0.1 address in the configuration file. 
It will not work if you use it as the injection interface. The shortname 
of your client machine should not refer to this address.<BR>
<BR>
<B>New in 1.1.0</B>: If you don't use the distributed feature of
Tsung and have trouble to start a remote beam on a local machine,
you can set the <TT>'use_controller_vm'</TT> attribute to true, for ex.:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
  &lt;client host="mymachine" use_controller_vm="true"&gt;
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
You may also have problems due to the sshd configuration:<BR>
<BR>
For example, for SuSE 9.2 sshd is compiled with restricted set of
paths (<I>ie.</I>  when you shell into the account you get the users shell,
when you execute a command via ssh you don't) and this makes it
impossible to start an erlang node (if erlang is installed in
<TT>/usr/local</TT> for example).<BR>
<BR>
Run:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
ssh myhostname erl
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
If the erlang shell doesn't start then check what paths sshd was compiled with 
(in SuSE see <TT>/etc/ssh/sshd_config</TT>) and symlink from one of the approved paths 
to the erlang executable (thanks to Gordon Guthrie for reporting this).<BR>
<BR>
<!--TOC subsection Tsung still crashes/fails when I start it !-->

<H3 CLASS="subsection"><A NAME="htoc53">A.3</A>&nbsp;&nbsp;Tsung still crashes/fails when I start it !</H3><!--SEC END -->

First look at the log file
<TT>~/.tsung/log/XXX/tsung_controller@yourhostname'</TT> to see
if there is a problem. <BR>
<BR>
If the file is not created and a crashed dump file is present, maybe
you are using a binary installation of Tsung not compatible with the
version of erlang you used.<BR>
<BR>
If you see nothing wrong, you can compile <EM>Tsung</EM> with full
debugging: recompile with <TT>make debug</TT> , and
don't forget to set the loglevel to "debug" in the XML file.<BR>
<BR>
To start the debugger or see what happen, start <EM>tsung</EM> with the
<FONT COLOR=purple>debug</FONT> argument instead of <FONT COLOR=purple>start</FONT>. You will have
an erlang shell on the <TT>tsung_controller</TT> node. Use
<TT>toolbar:start().</TT> to launch the graphical tools provided by
Erlang.
<!--TOC subsection What is the format of the stats file tsung.log ?-->

<H3 CLASS="subsection"><A NAME="htoc54">A.4</A>&nbsp;&nbsp;What is the format of the stats file tsung.log ?</H3><!--SEC END -->
<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
# stats: dump at 1083694995
stats: users 11 11
stats: request 41 1.03289 0.125108 1.59802 0.901978
stats: connect 41 0.220170 6.67110e-2 0.494019 0.171997
stats: users_count 11 11
stats: page 24 6.80416 17.2794 80.4609 0.958984
stats: size 26818 26818
stats: 404 7 7
stats: 200 20 20
# stats: dump at 1083695005
stats: users 21 21
stats: request 113 1.03980 0.110650 1.59802 0.791016
stats: connect 118 0.197619 4.26037e-2 0.494019 0.163940
stats: users_count 10 21
stats: page 52 2.72266 1.74204 80.4609 0.791016
stats: size 78060 104878
stats: 404 15 22
stats: 200 51 71
 ...
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
 the format is, for <TT>request</TT>, <TT>page</TT>, <TT>session</TT>:<BR>
<BR>
<TT> # stats:'name' count(during the last 10sec), mean, stdvar,
 max, min</TT><BR>
<BR>
or for HTTP returns code, size ...<BR>
<BR>
<TT> # stats:'name' count(during the last 10sec), totalcount(since the beginning)</TT><BR>
<BR>
<!--TOC subsection How can I specify the number of concurrent users ?-->

<H3 CLASS="subsection"><A NAME="htoc55">A.5</A>&nbsp;&nbsp;How can I specify the number of concurrent users ?</H3><!--SEC END -->

You can't. But it's on purpose: the load generated by
<EM>Tsung</EM> is dependent on the arrival time between new
clients. Indeed, once a client has finished his session in
<EM>tsung</EM>, it stops. So the number of concurrent users is
a function of the arrival rate and the mean session duration.<BR>
<BR>
For example, if your web site has 1000 visits/hour, the arrival rate
is 1000/3600 = 0.2778 visits/second. If you want to simulate the same
load, set the inter-arrival time is to 1/0.27778 = 3.6 <I>sec</I> (<TT>&lt;users
interarrival="3.6" unit="second"&gt;</TT> in the <TT>arrivalphase</TT> node in the
XML config file).<BR>
<BR>
<!--TOC subsection SNMP monitoring doesn't work ?!-->

<H3 CLASS="subsection"><A NAME="htoc56">A.6</A>&nbsp;&nbsp;SNMP monitoring doesn't work ?!</H3><!--SEC END -->

It use SNMP v1 and the 'public' community. It has been tested with
<A HREF="http://net-snmp.sourceforge.net/"><TT>http://net-snmp.sourceforge.net/</TT></A>.<BR>
<BR>
You can try with <TT>snmpwalk</TT> to see if your snmpd config is ok:<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
&gt;snmpwalk -v 1 -c public IP-OF-YOUR-SERVER .1.3.6.1.4.1.2021.4.5.0
UCD-SNMP-MIB::memTotalReal.0 = INTEGER: 1033436
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
SNMP doesn't work with erlang R10B and Tsung older than 1.2.0.<BR>
<BR>
There is a small bug in the <TT>snmp\_mgr</TT> module in old Erlang
release (R9C-0). You have to apply this patch to make it
work. This is fixed in erlang R9C-1 and up.<BR>
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR><TD><TABLE BORDER=0 CELLPADDING=0
 CELLSPACING=0>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
<TD><TABLE BORDER=0 CELLPADDING="1" CELLSPACING=0>
<TR><TD><PRE CLASS="verbatim">
--- lib/snmp-3.4/src/snmp_mgr.erl.orig  2004-03-22 15:21:59.000000000 +0100
+++ lib/snmp-3.4/src/snmp_mgr.erl       2004-03-22 15:23:46.000000000 +0100
@@ -296,6 +296,10 @@
     end;
 is_options_ok([{recbuf,Sz}|Opts]) when 0 &lt; Sz, Sz =&lt; 65535 -&gt;
     is_options_ok(Opts);
+is_options_ok([{receive_type, msg}|Opts]) -&gt;
+    is_options_ok(Opts);
+is_options_ok([{receive_type, pdu}|Opts]) -&gt;
+    is_options_ok(Opts);
 is_options_ok([InvOpt|_]) -&gt;
     {error,{invalid_option,InvOpt}};
 is_options_ok([]) -&gt; true.
</PRE></TD>
</TR></TABLE></TD>
<TD BGCOLOR=black COLSPAN="1"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR>
<TR><TD BGCOLOR=black COLSPAN="3"><TABLE CELLSPACING="1" CELLPADDING=0 BORDER=0>
<TR><TD>
 </TD>
</TR></TABLE></TD>
</TR></TABLE></TD>
</TR></TABLE><BR>
<!--BEGIN NOTES document-->
<HR WIDTH="50%" SIZE=1><DL CLASS="list"><DT CLASS="dt-list"><A NAME="note1" HREF="#text1"><FONT SIZE=5>1</FONT></A><DD CLASS="dd-list"><A HREF="http://www.erlang-projects.org/Members/mremond/events/dossier_de_presentat/block_10766817551485/file"><TT>http://www.erlang-projects.org/Members/mremond/events/dossier_de_presentat/block_10766817551485/file</TT></A>
<DT CLASS="dt-list"><A NAME="note2" HREF="#text2"><FONT SIZE=5>2</FONT></A><DD CLASS="dd-list"><A HREF="http://www.editions-eyrolles.com/php.accueil/Ouvrages/ouvrage.php3?ouv_ean13=9782212110791"><TT>http://www.editions-eyrolles.com/php.accueil/Ouvrages/ouvrage.php3?ouv_ean13=9782212110791</TT></A>
<DT CLASS="dt-list"><A NAME="note3" HREF="#text3"><FONT SIZE=5>3</FONT></A><DD CLASS="dd-list"><A HREF="http://www.sics.se/~joe/thesis/armstrong_thesis_2003.pdf"><TT>http://www.sics.se/~joe/thesis/armstrong_thesis_2003.pdf</TT></A>
<DT CLASS="dt-list"><A NAME="note4" HREF="#text4"><FONT SIZE=5>4</FONT></A><DD CLASS="dd-list"><A HREF="mailto:mickael.remond@erlang-fr.org">mickael.remond@erlang-fr.org</A>
</DL>
<!--END NOTES-->
<!--HTMLFOOT-->


<DIV class="piedpage">
<HR>
<P>  Copyright 2004-2006 &copy; Nicolas Niclausse
</DIV>

<!--ENDHTML-->
<!--FOOTER-->
<HR SIZE=2><BLOCKQUOTE CLASS="quote"><EM>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</EM><A HREF="http://pauillac.inria.fr/~maranget/hevea/index.html"><EM>H<FONT SIZE=2><sup>E</sup></FONT>V<FONT SIZE=2><sup>E</sup></FONT>A</EM></A><EM>.</EM></BLOCKQUOTE></BODY>
</HTML>
